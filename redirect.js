/*! For license information please see redirect.js.LICENSE.txt */
(()=>{"use strict";function e(e){return`See https://aka.ms/msal.js.errors#${e} for details`}class t extends Error{constructor(r,o,n){const i=o||(r?e(r):"");super(i?`${r}: ${i}`:r),Object.setPrototypeOf(this,t.prototype),this.errorCode=r||"",this.errorMessage=i||"",this.subError=n||"",this.name="AuthError"}setCorrelationId(e){this.correlationId=e}}function r(r,o){return new t(r,o||e(r))}class o extends t{constructor(e,t){super(e,t),this.name="ClientAuthError",Object.setPrototypeOf(this,o.prototype)}}function n(e,t){return new o(e,t)}const i="client_info_decoding_error",s="token_parsing_error",a="endpoints_resolution_error",c="invalid_state",h="state_not_found",l="auth_time_not_found",d="empty_input_scopeset",u="no_account_in_silent_request",g="invalid_cache_environment",p="no_account_found",m="no_crypto_object",f="token_refresh_required",y="key_id_missing",w="method_not_implemented";class I extends t{constructor(e,t){super(e,t),this.name="JoseHeaderError",Object.setPrototypeOf(this,I.prototype)}}function C(e){return new I(e)}const v="https://login.microsoftonline.com/common/",k="common",b=`${v}discovery/instance?api-version=1.1&authorization_endpoint=`,T=".ciamlogin.com",A="openid",S="profile",_="offline_access",P="S256",O="Not Available",R="http://169.254.169.254/metadata/instance/compute/location",E=["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],x="POST",M=[A,S,_],q=[...M,"email"],U="Content-Type",N="Retry-After",H="X-AnchorMailbox",L="x-ms-request-id",F="x-ms-httpver",K="active-account-filters",D="common",z="organizations",j="consumers",B="access_token",$="xms_cc",J="login",W="consent",V="none",G="code",Q="query",X="Generic",Y={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"},Z="appmetadata",ee="1",te="authority-metadata",re="config",oe="cache",ne="network",ie="hardcoded_values",se=5,ae="server-telemetry",ce=",",he={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},le="throttling";class de{constructor(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}static getShrHeaderString(e){if(!e.kid)throw C("missing_kid_error");if(!e.alg)throw C("missing_alg_error");const t=new de({typ:e.typ||"pop",kid:e.kid,alg:e.alg});return JSON.stringify(t)}}const ue="standardInteractionClientGetDiscoveredAuthority",ge="nativeInteractionClientAcquireToken",pe="acquireTokenBySilentIframe",me="initializeBaseRequest",fe="silentIframeClientTokenHelper",ye="silentHandlerInitiateAuthRequest",we="silentHandlerMonitorIframeForHash",Ie="standardInteractionClientCreateAuthCodeClient",Ce="standardInteractionClientGetClientConfiguration",ve="standardInteractionClientInitializeAuthorizationRequest",ke="handleResponseEar",be="handleResponsePlatformBroker",Te="handleResponseCode",Ae="deserializeResponse",Se="generatePkceCodes",_e="generateHKDF",Pe="decrypt",Oe="generateEarKey";function Re(e){return encodeURIComponent(xe(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function Ee(e){return Me(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function xe(e){return Me((new TextEncoder).encode(e))}function Me(e){const t=Array.from(e,e=>String.fromCodePoint(e)).join("");return btoa(t)}function qe(e){return`See https://aka.ms/msal.js.errors#${e} for details`}class Ue extends t{constructor(e,t){super(e,qe(e),t),Object.setPrototypeOf(this,Ue.prototype),this.name="BrowserAuthError"}}function Ne(e,t){return new Ue(e,t)}const He="pkce_not_created",Le="ear_jwk_empty",Fe="crypto_nonexistent",Ke="empty_navigate_uri",De="no_state_in_hash",ze="unable_to_parse_state",je="user_cancelled",Be="silent_logout_unsupported",$e="non_browser_environment",Je="database_not_open",We="no_network_connectivity",Ve="failed_to_parse_response",Ge="crypto_key_not_found",Qe="database_unavailable",Xe="native_connection_not_established",Ye="uninitialized_public_client_application",Ze="failed_to_decrypt_ear_response",et="timed_out";function tt(e){return(new TextDecoder).decode(rt(e))}function rt(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw Ne("invalid_base64_string")}const r=atob(t);return Uint8Array.from(r,e=>e.codePointAt(0)||0)}const ot="invalid_grant",nt="msal",it="msal.js.browser",st="53ee284d-920a-4b59-9d30-a60315b26836",at="ppnbnpeolgkicgegkbkbjmhlideopiji",ct="MicrosoftEntra",ht="Handshake",lt="localStorage",dt="sessionStorage",ut="memoryStorage",gt="signin",pt="signout",mt="request.origin",ft="urlHash",yt="request.params",wt="code.verifier",It="interaction.status",Ct="request.native",vt="wrapper.sku",kt="wrapper.version",bt=861,Tt=862,At={861:"acquireTokenRedirect",862:"acquireTokenPopup",863:"ssoSilent",864:"acquireTokenSilent_authCode",865:"handleRedirectPromise",866:"acquireTokenByCode",61:"acquireTokenSilent_silentFlow",961:"logout",962:"logoutPopup",963:"hydrateCache",964:"loadExternalTokens"};var St;!function(e){e.Redirect="redirect",e.Popup="popup",e.Silent="silent",e.None="none"}(St||(St={}));const _t={scopes:M},Pt="msal.db",Ot=`${Pt}.keys`,Rt=[0,5,4],Et="AES-GCM",xt="HKDF",Mt="SHA-256",qt=new Uint8Array([1,0,1]),Ut="0123456789abcdef",Nt=new Uint32Array(1),Ht="raw",Lt="encrypt",Ft="decrypt",Kt={name:"RSASSA-PKCS1-v1_5",hash:Mt,modulusLength:2048,publicExponent:qt};async function Dt(e){const t=(new TextEncoder).encode(e);return window.crypto.subtle.digest(Mt,t)}function zt(e){return window.crypto.getRandomValues(e)}function jt(){return window.crypto.getRandomValues(Nt),Nt[0]}function Bt(){const e=Date.now(),t=1024*jt()+(1023&jt()),r=new Uint8Array(16),o=Math.trunc(t/2**30),n=t&2**30-1,i=jt();r[0]=e/2**40,r[1]=e/2**32,r[2]=e/2**24,r[3]=e/65536,r[4]=e/256,r[5]=e,r[6]=112|o>>>8,r[7]=o,r[8]=128|n>>>24,r[9]=n>>>16,r[10]=n>>>8,r[11]=n,r[12]=i>>>24,r[13]=i>>>16,r[14]=i>>>8,r[15]=i;let s="";for(let e=0;e<r.length;e++)s+=Ut.charAt(r[e]>>>4),s+=Ut.charAt(15&r[e]),3!==e&&5!==e&&7!==e&&9!==e||(s+="-");return s}async function $t(e){return window.crypto.subtle.exportKey("jwk",e)}async function Jt(){const e=await Vt(),t={alg:"dir",kty:"oct",k:Ee(new Uint8Array(e))};return xe(JSON.stringify(t))}async function Wt(e,t){const r=t.split(".");if(5!==r.length)throw Ne(Ze,"jwe_length");const o=await async function(e){const t=tt(e),r=rt(JSON.parse(t).k);return window.crypto.subtle.importKey(Ht,r,Et,!1,[Ft])}(e).catch(()=>{throw Ne(Ze,"import_key")});try{const e=(new TextEncoder).encode(r[0]),t=rt(r[2]),n=rt(r[3]),i=rt(r[4]),s=8*i.byteLength,a=new Uint8Array(n.length+i.length);a.set(n),a.set(i,n.length);const c=await window.crypto.subtle.decrypt({name:Et,iv:t,tagLength:s,additionalData:e},o,a);return(new TextDecoder).decode(c)}catch(e){throw Ne(Ze,"decrypt")}}async function Vt(){const e=await window.crypto.subtle.generateKey({name:Et,length:256},!0,[Lt,Ft]);return window.crypto.subtle.exportKey(Ht,e)}async function Gt(e){return window.crypto.subtle.importKey(Ht,e,xt,!1,["deriveKey"])}async function Qt(e,t,r){return window.crypto.subtle.deriveKey({name:xt,salt:t,hash:Mt,info:(new TextEncoder).encode(r)},e,{name:Et,length:256},!1,[Lt,Ft])}async function Xt(e,t,r){const o=(new TextEncoder).encode(t),n=window.crypto.getRandomValues(new Uint8Array(16)),i=await Qt(e,n,r),s=await window.crypto.subtle.encrypt({name:Et,iv:new Uint8Array(12)},i,o);return{data:Ee(new Uint8Array(s)),nonce:Ee(n)}}async function Yt(e,t,r,o){const n=rt(o),i=await Qt(e,rt(t),r),s=await window.crypto.subtle.decrypt({name:Et,iv:new Uint8Array(12)},i,n);return(new TextDecoder).decode(s)}class Zt{constructor(){this.dbName=Pt,this.version=1,this.tableName=Ot,this.dbOpen=!1}async open(){return new Promise((e,t)=>{const r=window.indexedDB.open(this.dbName,this.version);r.addEventListener("upgradeneeded",e=>{e.target.result.createObjectStore(this.tableName)}),r.addEventListener("success",t=>{const r=t;this.db=r.target.result,this.dbOpen=!0,e()}),r.addEventListener("error",()=>t(Ne(Qe)))})}closeConnection(){const e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)}async validateDbIsOpen(){if(!this.dbOpen)return this.open()}async getItem(e){return await this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r(Ne(Je));const o=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).get(e);o.addEventListener("success",e=>{const r=e;this.closeConnection(),t(r.target.result)}),o.addEventListener("error",e=>{this.closeConnection(),r(e)})})}async setItem(e,t){return await this.validateDbIsOpen(),new Promise((r,o)=>{if(!this.db)return o(Ne(Je));const n=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).put(t,e);n.addEventListener("success",()=>{this.closeConnection(),r()}),n.addEventListener("error",e=>{this.closeConnection(),o(e)})})}async removeItem(e){return await this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r(Ne(Je));const o=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).delete(e);o.addEventListener("success",()=>{this.closeConnection(),t()}),o.addEventListener("error",e=>{this.closeConnection(),r(e)})})}async getKeys(){return await this.validateDbIsOpen(),new Promise((e,t)=>{if(!this.db)return t(Ne(Je));const r=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).getAllKeys();r.addEventListener("success",t=>{const r=t;this.closeConnection(),e(r.target.result)}),r.addEventListener("error",e=>{this.closeConnection(),t(e)})})}async containsKey(e){return await this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r(Ne(Je));const o=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).count(e);o.addEventListener("success",e=>{const r=e;this.closeConnection(),t(1===r.target.result)}),o.addEventListener("error",e=>{this.closeConnection(),r(e)})})}async deleteDatabase(){return this.db&&this.dbOpen&&this.closeConnection(),new Promise((e,t)=>{const r=window.indexedDB.deleteDatabase(Pt),o=setTimeout(()=>t(!1),200);r.addEventListener("success",()=>(clearTimeout(o),e(!0))),r.addEventListener("blocked",()=>(clearTimeout(o),e(!0))),r.addEventListener("error",()=>(clearTimeout(o),t(!1)))})}}class er{constructor(){this.cache=new Map}async initialize(){}getItem(e){return this.cache.get(e)||null}getUserData(e){return this.getItem(e)}setItem(e,t){this.cache.set(e,t)}async setUserData(e,t){this.setItem(e,t)}removeItem(e){this.cache.delete(e)}getKeys(){const e=[];return this.cache.forEach((t,r)=>{e.push(r)}),e}containsKey(e){return this.cache.has(e)}clear(){this.cache.clear()}decryptData(){return Promise.resolve(null)}}class tr{constructor(e){this.inMemoryCache=new er,this.indexedDBCache=new Zt,this.logger=e}handleDatabaseAccessError(e,t){if(!(e instanceof Ue&&e.errorCode===Qe))throw e;this.logger.error("1wx7zz",t)}async getItem(e,t){const r=this.inMemoryCache.getItem(e);if(!r)try{return this.logger.verbose("0naxpl",t),await this.indexedDBCache.getItem(e)}catch(e){this.handleDatabaseAccessError(e,t)}return r}async setItem(e,t,r){this.inMemoryCache.setItem(e,t);try{await this.indexedDBCache.setItem(e,t)}catch(e){this.handleDatabaseAccessError(e,r)}}async removeItem(e,t){this.inMemoryCache.removeItem(e);try{await this.indexedDBCache.removeItem(e)}catch(e){this.handleDatabaseAccessError(e,t)}}async getKeys(e){const t=this.inMemoryCache.getKeys();if(0===t.length)try{return this.logger.verbose("1iqrbq",e),await this.indexedDBCache.getKeys()}catch(t){this.handleDatabaseAccessError(t,e)}return t}async containsKey(e,t){const r=this.inMemoryCache.containsKey(e);if(!r)try{return this.logger.verbose("03zl2j",t),await this.indexedDBCache.containsKey(e)}catch(e){this.handleDatabaseAccessError(e,t)}return r}clearInMemory(e){this.logger.verbose("03r21p",e),this.inMemoryCache.clear(),this.logger.verbose("0uksk1",e)}async clearPersistent(e){try{this.logger.verbose("0rdqut",e);const t=await this.indexedDBCache.deleteDatabase();return t&&this.logger.verbose("149ouc",e),t}catch(t){return this.handleDatabaseAccessError(t,e),!1}}}class rr{constructor(e,t,r){this.logger=e,function(e){if(!window)throw Ne($e);if(!window.crypto)throw Ne(Fe);if(!e&&!window.crypto.subtle)throw Ne(Fe,"crypto_subtle_undefined")}(r??!1),this.cache=new tr(this.logger),this.performanceClient=t}createNewGuid(){return Bt()}base64Encode(e){return xe(e)}base64Decode(e){return tt(e)}base64UrlEncode(e){return Re(e)}encodeKid(e){return this.base64UrlEncode(JSON.stringify({kid:e}))}async getPublicKeyThumbprint(e){const t=this.performanceClient?.startMeasurement("cryptoOptsGetPublicKeyThumbprint",e.correlationId),r=await async function(e,t){return window.crypto.subtle.generateKey(Kt,e,t)}(rr.EXTRACTABLE,rr.POP_KEY_USAGES),o=await $t(r.publicKey),n=or({e:o.e,kty:o.kty,n:o.n}),i=await this.hashString(n),s=await $t(r.privateKey),a=await async function(e){return window.crypto.subtle.importKey("jwk",e,Kt,!1,["sign"])}(s);return await this.cache.setItem(i,{privateKey:a,publicKey:r.publicKey,requestMethod:e.resourceRequestMethod,requestUri:e.resourceRequestUri},e.correlationId),t&&t.end({success:!0}),i}async removeTokenBindingKey(e,t){if(await this.cache.removeItem(e,t),await this.cache.containsKey(e,t))throw n("binding_key_not_removed")}async clearKeystore(e){this.cache.clearInMemory(e);try{return await this.cache.clearPersistent(e),!0}catch(t){return t instanceof Error?this.logger.error("1owpn8",e):this.logger.error("0yrmwo",e),!1}}async signJwt(e,t,r,o){const n=this.performanceClient?.startMeasurement("cryptoOptsSignJwt",o),i=await this.cache.getItem(t,o||"");if(!i)throw Ne(Ge);const s=await $t(i.publicKey),a=or(s),c=Re(JSON.stringify({kid:t})),h=Re(de.getShrHeaderString({...r?.header,alg:s.alg,kid:c}));e.cnf={jwk:JSON.parse(a)};const l=`${h}.${Re(JSON.stringify(e))}`,d=(new TextEncoder).encode(l),u=await async function(e,t){return window.crypto.subtle.sign(Kt,e,t)}(i.privateKey,d),g=`${l}.${Ee(new Uint8Array(u))}`;return n&&n.end({success:!0}),g}async hashString(e){return async function(e){const t=await Dt(e);return Ee(new Uint8Array(t))}(e)}}function or(e){return JSON.stringify(e,Object.keys(e).sort())}rr.POP_KEY_USAGES=["sign","verify"],rr.EXTRACTABLE=!0;const nr={createNewGuid:()=>{throw n(w)},base64Decode:()=>{throw n(w)},base64Encode:()=>{throw n(w)},base64UrlEncode:()=>{throw n(w)},encodeKid:()=>{throw n(w)},async getPublicKeyThumbprint(){throw n(w)},async removeTokenBindingKey(){throw n(w)},async clearKeystore(){throw n(w)},async signJwt(){throw n(w)},async hashString(){throw n(w)}};class ir extends t{constructor(e){super(e),this.name="ClientConfigurationError",Object.setPrototypeOf(this,ir.prototype)}}function sr(e){return new ir(e)}class ar{static isEmptyObj(e){if(e)try{const t=JSON.parse(e);return 0===Object.keys(t).length}catch(e){}return!0}static startsWith(e,t){return 0===e.indexOf(t)}static endsWith(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length}static queryStringToObject(e){const t={},r=e.split("&"),o=e=>decodeURIComponent(e.replace(/\+/g," "));return r.forEach(e=>{if(e.trim()){const[r,n]=e.split(/=(.+)/g,2);r&&n&&(t[o(r)]=o(n))}}),t}static trimArrayEntries(e){return e.map(e=>e.trim())}static removeEmptyStringsFromArray(e){return e.filter(e=>!!e)}static jsonParseHelper(e){try{return JSON.parse(e)}catch(e){return null}}static matchPattern(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)}}const cr="url_parse_error",hr="invalid_claims",lr="pkce_params_missing",dr="invalid_cloud_discovery_metadata",ur="missing_ssh_jwk";class gr{get urlString(){return this._urlString}constructor(e){if(this._urlString=e,!this._urlString)throw sr("empty_url_error");e.includes("#")||(this._urlString=gr.canonicalizeUri(e))}static canonicalizeUri(e){if(e){let t=e.toLowerCase();return ar.endsWith(t,"?")?t=t.slice(0,-1):ar.endsWith(t,"?/")&&(t=t.slice(0,-2)),ar.endsWith(t,"/")||(t+="/"),t}return e}validateAsUri(){let e;try{e=this.getUrlComponents()}catch(e){throw sr(cr)}if(!e.HostNameAndPort||!e.PathSegments)throw sr(cr);if(!e.Protocol||"https:"!==e.Protocol.toLowerCase())throw sr("authority_uri_insecure")}static appendQueryString(e,t){return t?e.indexOf("?")<0?`${e}?${t}`:`${e}&${t}`:e}static removeHashFromUrl(e){return gr.canonicalizeUri(e.split("#")[0])}replaceTenantPath(e){const t=this.getUrlComponents(),r=t.PathSegments;return!e||0===r.length||r[0]!==D&&r[0]!==z||(r[0]=e),gr.constructAuthorityUriFromObject(t)}getUrlComponents(){const e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw sr(cr);const r={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]};let o=r.AbsolutePath.split("/");return o=o.filter(e=>e&&e.length>0),r.PathSegments=o,r.QueryString&&r.QueryString.endsWith("/")&&(r.QueryString=r.QueryString.substring(0,r.QueryString.length-1)),r}static getDomainFromUrl(e){const t=RegExp("^([^:/?#]+://)?([^/?#]*)"),r=e.match(t);if(!r)throw sr(cr);return r[2]}static getAbsoluteUrl(e,t){if("/"===e[0]){const r=new gr(t).getUrlComponents();return r.Protocol+"//"+r.HostNameAndPort+e}return e}static constructAuthorityUriFromObject(e){return new gr(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))}}const pr={endpointMetadata:[{host:"login.microsoftonline.com"},{host:"login.chinacloudapi.cn",issuerHost:"login.partner.microsoftonline.cn"},{host:"login.microsoftonline.us"},{host:"login.sovcloud-identity.fr"},{host:"login.sovcloud-identity.de"},{host:"login.sovcloud-identity.sg"}].reduce((e,{host:t,issuerHost:r})=>(e[t]=function(e,t){return{token_endpoint:`https://${e}/{tenantid}/oauth2/v2.0/token`,jwks_uri:`https://${e}/{tenantid}/discovery/v2.0/keys`,issuer:`https://${t}/{tenantid}/v2.0`,authorization_endpoint:`https://${e}/{tenantid}/oauth2/v2.0/authorize`,end_session_endpoint:`https://${e}/{tenantid}/oauth2/v2.0/logout`}}(t,r||t),e),{}),instanceDiscoveryMetadata:{metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]}},mr=pr.endpointMetadata,fr=pr.instanceDiscoveryMetadata,yr=new Set;function wr(e,t,r,o,n){if(e.trace("1bmquz",t),r&&o){const n=Ir(o,r);if(n)return e.trace("1fotbt",t),n.aliases;e.trace("14avvj",t)}return null}function Ir(e,t){for(let r=0;r<e.length;r++){const o=e[r];if(o.aliases.includes(t))return o}return null}fr.metadata.forEach(e=>{e.aliases.forEach(e=>{yr.add(e)})});const Cr="OIDC",vr="EAR",kr="none",br="refreshTokenClientAcquireTokenWithCachedRefreshToken",Tr="getAuthCodeUrl",Ar="handleCodeResponseFromServer",Sr="popTokenGenerateCnf",_r="handleServerTokenResponse",Pr="authorityUpdateMetadataWithRegionalInformation",Or="regionDiscoveryGetRegionFromIMDS",Rr=(e,t,r,o,n)=>(...i)=>{r.trace("1plfzx",n);const s=o.startMeasurement(t,n);if(n){const e=t+"CallCount";o.incrementFields({[e]:1},n)}try{const t=e(...i);return s.end({success:!0}),r.trace("1g8n6a",n),t}catch(e){r.trace("0cfd8i",n);try{r.trace(JSON.stringify(e),n)}catch(e){r.trace("00dty7",n)}throw s.end({success:!1},e),e}},Er=(e,t,r,o,n)=>(...i)=>{r.trace("1plfzx",n);const s=o.startMeasurement(t,n);if(n){const e=t+"CallCount";o.incrementFields({[e]:1},n)}return e(...i).then(e=>(r.trace("1g8n6a",n),s.end({success:!0}),e)).catch(e=>{r.trace("0cfd8i",n);try{r.trace(JSON.stringify(e),n)}catch(e){r.trace("00dty7",n)}throw s.end({success:!1},e),e})};class xr{constructor(e,t,r,o){this.networkInterface=e,this.logger=t,this.performanceClient=r,this.correlationId=o}async detectRegion(e,t){let r=e;if(r)t.region_source="3";else{const e=xr.IMDS_OPTIONS;try{const o=await Er(this.getRegionFromIMDS.bind(this),Or,this.logger,this.performanceClient,this.correlationId)("2020-06-01",e);if(200===o.status&&(r=o.body,t.region_source="4"),400===o.status){const o=await Er(this.getCurrentVersion.bind(this),"regionDiscoveryGetCurrentVersion",this.logger,this.performanceClient,this.correlationId)(e);if(!o)return t.region_source="1",null;const n=await Er(this.getRegionFromIMDS.bind(this),Or,this.logger,this.performanceClient,this.correlationId)(o,e);200===n.status&&(r=n.body,t.region_source="4")}}catch(e){return t.region_source="1",null}}return r||(t.region_source="1"),r||null}async getRegionFromIMDS(e,t){return this.networkInterface.sendGetRequestAsync(`${R}?api-version=${e}&format=text`,t,2e3)}async getCurrentVersion(e){try{const t=await this.networkInterface.sendGetRequestAsync(`${R}?format=json`,e);return 400===t.status&&t.body&&t.body["newest-versions"]&&t.body["newest-versions"].length>0?t.body["newest-versions"][0]:null}catch(e){return null}}}function Mr(e,t){const r=function(e){if(!e)throw n("null_or_empty_token");const t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(e);if(!t||t.length<4)throw n(s);return t[2]}(e);try{const e=t(r);return JSON.parse(e)}catch(e){throw n(s)}}function qr(e){if(!e.signin_state)return!1;const t=["kmsi","dvc_dmjd"];return e.signin_state.some(e=>t.includes(e.trim().toLowerCase()))}function Ur(e,t){if(0===t||Date.now()-3e5>e+t)throw n("max_age_transpired")}function Nr(){return Math.round((new Date).getTime()/1e3)}function Hr(e){return e.getTime()/1e3}function Lr(e){return e?new Date(1e3*Number(e)):new Date}function Fr(e,t){const r=Number(e)||0;return Nr()+t>r}function Kr(e,t){const r=Number(e)+24*t*60*60*1e3;return Date.now()>r}function Dr(e,t,r,o,n){return{credentialType:Y.ID_TOKEN,homeAccountId:e,environment:t,clientId:o,secret:r,realm:n,lastUpdatedAt:Date.now().toString()}}function zr(e,t,r,o,i,s,a,c,h,l,d,u,g){const p={homeAccountId:e,credentialType:Y.ACCESS_TOKEN,secret:r,cachedAt:Nr().toString(),expiresOn:a.toString(),extendedExpiresOn:c.toString(),environment:t,clientId:o,realm:i,target:s,tokenType:d||he.BEARER,lastUpdatedAt:Date.now().toString()};if(u&&(p.userAssertionHash=u),l&&(p.refreshOn=l.toString()),p.tokenType?.toLowerCase()!==he.BEARER.toLowerCase())switch(p.credentialType=Y.ACCESS_TOKEN_WITH_AUTH_SCHEME,p.tokenType){case he.POP:const e=Mr(r,h);if(!e?.cnf?.kid)throw n("token_claims_cnf_required_for_signedjwt");p.keyId=e.cnf.kid;break;case he.SSH:p.keyId=g}return p}function jr(e){return e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("credentialType")&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("secret")}function Br(e){return!!e&&jr(e)&&e.hasOwnProperty("realm")&&e.hasOwnProperty("target")&&(e.credentialType===Y.ACCESS_TOKEN||e.credentialType===Y.ACCESS_TOKEN_WITH_AUTH_SCHEME)}function $r(e){return!!e&&jr(e)&&e.credentialType===Y.REFRESH_TOKEN}function Jr(){return Nr()+86400}function Wr(e,t,r){e.authorization_endpoint=t.authorization_endpoint,e.token_endpoint=t.token_endpoint,e.end_session_endpoint=t.end_session_endpoint,e.issuer=t.issuer,e.endpointsFromNetwork=r,e.jwks_uri=t.jwks_uri}function Vr(e,t,r){e.aliases=t.aliases,e.preferred_cache=t.preferred_cache,e.preferred_network=t.preferred_network,e.aliasesFromNetwork=r}function Gr(e){return e.expiresAt<=Nr()}xr.IMDS_OPTIONS={headers:{Metadata:"true"}};class Qr{constructor(e,t,r,o,n,i,s,a){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=r,this.authorityOptions=o,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=n,this.performanceClient=s,this.correlationId=i,this.managedIdentity=a||!1,this.regionDiscovery=new xr(t,this.logger,this.performanceClient,this.correlationId)}getAuthorityType(e){if(e.HostNameAndPort.endsWith(T))return 3;const t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case"adfs":return 1;case"dstsv2":return 2}return 0}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(e){this._canonicalAuthority=new gr(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw n(a)}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw n(a)}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw n(a)}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw n("end_session_endpoint_not_supported");return this.replacePath(this.metadata.end_session_endpoint)}throw n(a)}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw n(a)}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw n(a)}canReplaceTenant(e){return 1===e.PathSegments.length&&!Qr.reservedTenantDomains.has(e.PathSegments[0])&&0===this.getAuthorityType(e)&&this.protocolMode!==Cr}replaceTenant(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(e){let t=e;const r=new gr(this.metadata.canonical_authority).getUrlComponents(),o=r.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((e,n)=>{let i=o[n];if(0===n&&this.canReplaceTenant(r)){const e=new gr(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];i!==e&&(this.logger.verbose("1q3g2x",this.correlationId),i=e)}e!==i&&(t=t.replace(`/${i}/`,`/${e}/`))}),this.replaceTenant(t)}get defaultOpenIdConfigurationEndpoint(){const e=this.hostnameAndPort;return this.canonicalAuthority.endsWith("v2.0/")||1===this.authorityType||this.protocolMode===Cr&&!this.isAliasOfKnownMicrosoftAuthority(e)?`${this.canonicalAuthority}.well-known/openid-configuration`:`${this.canonicalAuthority}v2.0/.well-known/openid-configuration`}discoveryComplete(){return!!this.metadata}async resolveEndpointsAsync(){const e=this.getCurrentMetadataEntity(),t=await Er(this.updateCloudDiscoveryMetadata.bind(this),"authorityUpdateCloudDiscoveryMetadata",this.logger,this.performanceClient,this.correlationId)(e);this.canonicalAuthority=this.canonicalAuthority.replace(this.hostnameAndPort,e.preferred_network);const r=await Er(this.updateEndpointMetadata.bind(this),"authorityUpdateEndpointMetadata",this.logger,this.performanceClient,this.correlationId)(e);this.updateCachedMetadata(e,t,{source:r}),this.performanceClient?.addFields({cloudDiscoverySource:t,authorityEndpointSource:r},this.correlationId)}getCurrentMetadataEntity(){let e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort,this.correlationId);return e||(e={aliases:[],preferred_cache:this.hostnameAndPort,preferred_network:this.hostnameAndPort,canonical_authority:this.canonicalAuthority,authorization_endpoint:"",token_endpoint:"",end_session_endpoint:"",issuer:"",aliasesFromNetwork:!1,endpointsFromNetwork:!1,expiresAt:Jr(),jwks_uri:""}),e}updateCachedMetadata(e,t,r){t!==oe&&r?.source!==oe&&(e.expiresAt=Jr(),e.canonical_authority=this.canonicalAuthority);const o=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache,this.correlationId);this.cacheManager.setAuthorityMetadata(o,e,this.correlationId),this.metadata=e}async updateEndpointMetadata(e){const t=this.updateEndpointMetadataFromLocalSources(e);if(t)return t.source===ie&&this.authorityOptions.azureRegionConfiguration?.azureRegion&&t.metadata&&(Wr(e,await Er(this.updateMetadataWithRegionalInformation.bind(this),Pr,this.logger,this.performanceClient,this.correlationId)(t.metadata),!1),e.canonical_authority=this.canonicalAuthority),t.source;let r=await Er(this.getEndpointMetadataFromNetwork.bind(this),"authorityGetEndpointMetadataFromNetwork",this.logger,this.performanceClient,this.correlationId)();if(r)return this.authorityOptions.azureRegionConfiguration?.azureRegion&&(r=await Er(this.updateMetadataWithRegionalInformation.bind(this),Pr,this.logger,this.performanceClient,this.correlationId)(r)),Wr(e,r,!0),ne;throw n("openid_config_error",this.defaultOpenIdConfigurationEndpoint)}updateEndpointMetadataFromLocalSources(e){this.logger.verbose("1fi0kc",this.correlationId);const t=this.getEndpointMetadataFromConfig();if(t)return this.logger.verbose("06t0uj",this.correlationId),Wr(e,t,!1),{source:re};this.logger.verbose("151k0p",this.correlationId);const r=this.getEndpointMetadataFromHardcodedValues();if(r)return Wr(e,r,!1),{source:ie,metadata:r};this.logger.verbose("1imop5",this.correlationId);const o=Gr(e);return this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!o?(this.logger.verbose("16uq31",""),{source:oe}):(o&&this.logger.verbose("0uoibc",""),null)}isAuthoritySameType(e){return new gr(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch(e){throw sr("invalid_authority_metadata")}return null}async getEndpointMetadataFromNetwork(){const e={},t=this.defaultOpenIdConfigurationEndpoint;this.logger.verbose("1y65x6",this.correlationId);try{const r=await this.networkInterface.sendGetRequestAsync(t,e),o=function(e){return e.hasOwnProperty("authorization_endpoint")&&e.hasOwnProperty("token_endpoint")&&e.hasOwnProperty("issuer")&&e.hasOwnProperty("jwks_uri")}(r.body);return o?r.body:(this.logger.verbose("1koyv8",this.correlationId),null)}catch(e){return this.logger.verbose("0a9wik",this.correlationId),null}}getEndpointMetadataFromHardcodedValues(){return this.hostnameAndPort in mr?mr[this.hostnameAndPort]:null}async updateMetadataWithRegionalInformation(e){const t=this.authorityOptions.azureRegionConfiguration?.azureRegion;if(t){if("TryAutoDetect"!==t)return this.regionDiscoveryMetadata.region_outcome="2",this.regionDiscoveryMetadata.region_used=t,Qr.replaceWithRegionalInformation(e,t);const r=await Er(this.regionDiscovery.detectRegion.bind(this.regionDiscovery),"regionDiscoveryDetectRegion",this.logger,this.performanceClient,this.correlationId)(this.authorityOptions.azureRegionConfiguration?.environmentRegion,this.regionDiscoveryMetadata);if(r)return this.regionDiscoveryMetadata.region_outcome="4",this.regionDiscoveryMetadata.region_used=r,Qr.replaceWithRegionalInformation(e,r);this.regionDiscoveryMetadata.region_outcome="5"}return e}async updateCloudDiscoveryMetadata(e){const t=this.updateCloudDiscoveryMetadataFromLocalSources(e);if(t)return t;const r=await Er(this.getCloudDiscoveryMetadataFromNetwork.bind(this),"authorityGetCloudDiscoveryMetadataFromNetwork",this.logger,this.performanceClient,this.correlationId)();if(r)return Vr(e,r,!0),ne;throw sr("untrusted_authority")}updateCloudDiscoveryMetadataFromLocalSources(e){this.logger.verbose("0jhlgt",this.correlationId),this.logger.verbosePii("1fy7uz",this.correlationId),this.logger.verbosePii("08zabj",this.correlationId),this.logger.verbosePii("1o1kv3",this.correlationId);const t=this.getCloudDiscoveryMetadataFromConfig();if(t)return this.logger.verbose("1nakio",this.correlationId),Vr(e,t,!1),re;this.logger.verbose("1x74aj",this.correlationId);const r=(o=this.hostnameAndPort,Ir(fr.metadata,o));var o;if(r)return this.logger.verbose("0by47c",this.correlationId),Vr(e,r,!1),ie;this.logger.verbose("0r2fzy",this.correlationId);const n=Gr(e);return this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!n?(this.logger.verbose("1uffgh",""),oe):(n&&this.logger.verbose("0uoibc",""),null)}getCloudDiscoveryMetadataFromConfig(){if(3===this.authorityType)return this.logger.verbose("04y84h",this.correlationId),Qr.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("0gszr3",this.correlationId);try{this.logger.verbose("1iifkx",this.correlationId);const e=Ir(JSON.parse(this.authorityOptions.cloudDiscoveryMetadata).metadata,this.hostnameAndPort);if(this.logger.verbose("0q67e3",""),e)return this.logger.verbose("0hzfao",this.correlationId),e;this.logger.verbose("1ajz3u",this.correlationId)}catch(e){throw this.logger.verbose("1wq5tu",this.correlationId),sr(dr)}}return this.isInKnownAuthorities()?(this.logger.verbose("0mt9al",this.correlationId),Qr.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}async getCloudDiscoveryMetadataFromNetwork(){const e=`${b}${this.canonicalAuthority}oauth2/v2.0/authorize`,r={};let o=null;try{const t=await this.networkInterface.sendGetRequestAsync(e,r);let n,i;if(function(e){return e.hasOwnProperty("tenant_discovery_endpoint")&&e.hasOwnProperty("metadata")}(t.body))n=t.body,i=n.metadata,this.logger.verbosePii("1vglyt",this.correlationId);else{if(!function(e){return e.hasOwnProperty("error")&&e.hasOwnProperty("error_description")}(t.body))return this.logger.error("0768g0",this.correlationId),null;if(this.logger.warning("062uto",this.correlationId),n=t.body,"invalid_instance"===n.error)return this.logger.error("1x90tm",this.correlationId),null;this.logger.warning("0wchdm",this.correlationId),this.logger.warning("1s5mpv",this.correlationId),this.logger.warning("1yhqpw",this.correlationId),i=[]}this.logger.verbose("1lrobr",this.correlationId),o=Ir(i,this.hostnameAndPort)}catch(e){return e instanceof t?this.logger.error("0vwhc7",this.correlationId):this.logger.error("0s2z41",this.correlationId),null}return o||(this.logger.warning("0jp28q",this.correlationId),this.logger.verbose("130sd8",this.correlationId),o=Qr.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)),o}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter(e=>e&&gr.getDomainFromUrl(e).toLowerCase()===this.hostnameAndPort).length>0}static generateAuthority(e,t){let r;if(t&&t.azureCloudInstance!==kr){const e=t.tenant?t.tenant:k;r=`${t.azureCloudInstance}/${e}/`}return r||e}static createCloudDiscoveryMetadataFromHost(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}}getPreferredCache(){if(this.managedIdentity)return"login.microsoftonline.com";if(this.discoveryComplete())return this.metadata.preferred_cache;throw n(a)}isAlias(e){return this.metadata.aliases.indexOf(e)>-1}isAliasOfKnownMicrosoftAuthority(e){return yr.has(e)}static isPublicCloudAuthority(e){return E.indexOf(e)>=0}static buildRegionalAuthorityString(e,t,r){const o=new gr(e);o.validateAsUri();const n=o.getUrlComponents();let i=`${t}.${n.HostNameAndPort}`;this.isPublicCloudAuthority(n.HostNameAndPort)&&(i=`${t}.login.microsoft.com`);const s=gr.constructAuthorityUriFromObject({...o.getUrlComponents(),HostNameAndPort:i}).urlString;return r?`${s}?${r}`:s}static replaceWithRegionalInformation(e,t){const r={...e};return r.authorization_endpoint=Qr.buildRegionalAuthorityString(r.authorization_endpoint,t),r.token_endpoint=Qr.buildRegionalAuthorityString(r.token_endpoint,t),r.end_session_endpoint&&(r.end_session_endpoint=Qr.buildRegionalAuthorityString(r.end_session_endpoint,t)),r}static transformCIAMAuthority(e){let t=e;const r=new gr(e).getUrlComponents();return 0===r.PathSegments.length&&r.HostNameAndPort.endsWith(T)&&(t=`${t}${r.HostNameAndPort.split(".")[0]}.onmicrosoft.com`),t}}function Xr(e){return e.endsWith("/")?e:`${e}/`}Qr.reservedTenantDomains=new Set(["{tenant}","{tenantid}",D,j,z]);const Yr="no_tokens_found",Zr="refresh_token_expired",eo="ux_not_allowed",to="bad_token",ro=["interaction_required","consent_required","login_required",to,eo],oo=["message_only","additional_action","basic_action","user_password_expired","consent_required","bad_token","ux_not_allowed"];class no extends t{constructor(e,t,r,o,n,i,s,a){super(e,t,r),Object.setPrototypeOf(this,no.prototype),this.timestamp=o||"",this.traceId=n||"",this.correlationId=i||"",this.claims=s||"",this.name="InteractionRequiredAuthError",this.errorNo=a}}function io(e,t,r){const o=!!e&&ro.indexOf(e)>-1,n=!!r&&oo.indexOf(r)>-1,i=!!t&&ro.some(e=>t.indexOf(e)>-1);return o||i||n}function so(e,t){return new no(e,t)}function ao(e,t){if(!e)throw n("client_info_empty_error");try{const r=t(e);return JSON.parse(r)}catch(e){throw n(i)}}function co(e){if(!e)throw n(i);const t=e.split(".",2);return{uid:t[0],utid:t.length<2?"":t[1]}}function ho(e,t){return!!e&&!!t&&e===t.split(".")[1]}function lo(e,t,r,o){if(o){const{oid:t,sub:r,tid:n,name:i,tfp:s,acr:a,preferred_username:c,upn:h,login_hint:l}=o,d=n||s||a||"";return{tenantId:d,localAccountId:t||r||"",name:i,username:c||h||"",loginHint:l,isHomeTenant:ho(d,e)}}return{tenantId:r,localAccountId:t,username:"",isHomeTenant:ho(r,e)}}function uo(e,t,r,o){let n=e;if(t){const{isHomeTenant:r,...o}=t;n={...e,...o}}if(r){const{isHomeTenant:t,...i}=lo(e.homeAccountId,e.localAccountId,e.tenantId,r);return n={...n,...i,idTokenClaims:r,idToken:o},n}return n}function go(e){return e&&(e.tid||e.tfp||e.acr)||null}function po(e){const t=e.tenantProfiles||[];return 0===t.length&&e.realm&&e.localAccountId&&t.push(lo(e.homeAccountId,e.localAccountId,e.realm)),{homeAccountId:e.homeAccountId,environment:e.environment,tenantId:e.realm,username:e.username,localAccountId:e.localAccountId,loginHint:e.loginHint,name:e.name,nativeAccountId:e.nativeAccountId,authorityType:e.authorityType,tenantProfiles:new Map(t.map(e=>[e.tenantId,e])),dataBoundary:e.dataBoundary}}function mo(e,t,r,o,n,i){if(1!==t&&2!==t){if(e)try{const t=ao(e,o.base64Decode);if(t.uid&&t.utid)return`${t.uid}.${t.utid}`}catch(e){}r.warning("1ub6wv",n)}return i?.sub||""}function fo(e,t,r){return{clientId:e,authority:t.authority,scopes:t.scopes,homeAccountIdentifier:r,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid,embeddedClientId:t.embeddedClientId||t.extraParameters?.clientId}}const yo="acquireTokenRedirect";class wo{constructor(e){const t=e?ar.trimArrayEntries([...e]):[],r=t?ar.removeEmptyStringsFromArray(t):[];if(!r||!r.length)throw sr("empty_input_scopes_error");this.scopes=new Set,r.forEach(e=>this.scopes.add(e))}static fromString(e){const t=(e||"").split(" ");return new wo(t)}static createSearchScopes(e){const t=e&&e.length>0?e:[...M],r=new wo(t);return r.containsOnlyOIDCScopes()?r.removeScope(_):r.removeOIDCScopes(),r}containsScope(e){const t=this.printScopesLowerCase().split(" "),r=new wo(t);return!!e&&r.scopes.has(e.toLowerCase())}containsScopeSet(e){return!(!e||e.scopes.size<=0)&&this.scopes.size>=e.scopes.size&&e.asArray().every(e=>this.containsScope(e))}containsOnlyOIDCScopes(){let e=0;return q.forEach(t=>{this.containsScope(t)&&(e+=1)}),this.scopes.size===e}appendScope(e){e&&this.scopes.add(e.trim())}appendScopes(e){try{e.forEach(e=>this.appendScope(e))}catch(e){throw n("cannot_append_scopeset")}}removeScope(e){if(!e)throw n("cannot_remove_empty_scope");this.scopes.delete(e.trim())}removeOIDCScopes(){q.forEach(e=>{this.scopes.delete(e)})}unionScopeSets(e){if(!e)throw n(d);const t=new Set;return e.scopes.forEach(e=>t.add(e.toLowerCase())),this.scopes.forEach(e=>t.add(e.toLowerCase())),t}intersectingScopeSets(e){if(!e)throw n(d);e.containsOnlyOIDCScopes()||e.removeOIDCScopes();const t=this.unionScopeSets(e),r=e.getScopeCount(),o=this.getScopeCount();return t.size<o+r}getScopeCount(){return this.scopes.size}asArray(){const e=[];return this.scopes.forEach(t=>e.push(t)),e}printScopes(){return this.scopes?this.asArray().join(" "):""}printScopesLowerCase(){return this.printScopes().toLowerCase()}}const Io="@azure/msal-common",Co="16.0.3",vo="cache_quota_exceeded";class ko extends Error{constructor(t,r){const o=r||e(t);super(o),Object.setPrototypeOf(this,ko.prototype),this.name="CacheError",this.errorCode=t,this.errorMessage=o}}function bo(e){return e instanceof Error?"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name||e.message.includes("exceeded the quota")?new ko(vo):new ko(e.name,e.message):new ko("cache_error_unknown")}class To{constructor(e,t,r,o,n){this.clientId=e,this.cryptoImpl=t,this.commonLogger=r.clone(Io,Co),this.staticAuthorityOptions=n,this.performanceClient=o}getAllAccounts(e={},t){return this.buildTenantProfiles(this.getAccountsFilteredBy(e,t),t,e)}getAccountInfoFilteredBy(e,t){const r=this.getAllAccounts(e,t);return r.length>1?r.sort(e=>e.idTokenClaims?-1:1)[0]:1===r.length?r[0]:null}getBaseAccountInfo(e,t){const r=this.getAccountsFilteredBy(e,t);return r.length>0?po(r[0]):null}buildTenantProfiles(e,t,r){return e.flatMap(e=>this.getTenantProfilesFromAccountEntity(e,t,r?.tenantId,r))}getTenantedAccountInfoByFilter(e,t,r,o,n){let i,s=null;if(n&&!this.tenantProfileMatchesFilter(r,n))return null;const a=this.getIdToken(e,o,t,r.tenantId);return a&&(i=Mr(a.secret,this.cryptoImpl.base64Decode),!this.idTokenClaimsMatchTenantProfileFilter(i,n))?null:(s=uo(e,r,i,a?.secret),s)}getTenantProfilesFromAccountEntity(e,t,r,o){const n=po(e);let i=n.tenantProfiles||new Map;const s=this.getTokenKeys();if(r){const e=i.get(r);if(!e)return[];i=new Map([[r,e]])}const a=[];return i.forEach(e=>{const r=this.getTenantedAccountInfoByFilter(n,s,e,t,o);r&&a.push(r)}),a}tenantProfileMatchesFilter(e,t){return!(t.localAccountId&&!this.matchLocalAccountIdFromTenantProfile(e,t.localAccountId)||t.name&&e.name!==t.name||void 0!==t.isHomeTenant&&e.isHomeTenant!==t.isHomeTenant)}idTokenClaimsMatchTenantProfileFilter(e,t){if(t){if(t.localAccountId&&!this.matchLocalAccountIdFromTokenClaims(e,t.localAccountId))return!1;if(t.loginHint&&!this.matchLoginHintFromTokenClaims(e,t.loginHint))return!1;if(t.username&&!this.matchUsername(e.preferred_username,t.username))return!1;if(t.name&&!this.matchName(e,t.name))return!1;if(t.sid&&!this.matchSid(e,t.sid))return!1}return!0}async saveCacheRecord(e,r,o,i,s){if(!e)throw n("invalid_cache_record");try{e.account&&await this.setAccount(e.account,r,o,i),e.idToken&&!1!==s?.idToken&&await this.setIdTokenCredential(e.idToken,r,o),e.accessToken&&!1!==s?.accessToken&&await this.saveAccessToken(e.accessToken,r,o),e.refreshToken&&!1!==s?.refreshToken&&await this.setRefreshTokenCredential(e.refreshToken,r,o),e.appMetadata&&this.setAppMetadata(e.appMetadata,r)}catch(e){throw this.commonLogger?.error("0j476p",r),e instanceof t?e:bo(e)}}async saveAccessToken(e,t,r){const o={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType},n=this.getTokenKeys(),i=wo.fromString(e.target);n.accessToken.forEach(e=>{if(!this.accessTokenKeyMatchesFilter(e,o,!1))return;const r=this.getAccessTokenCredential(e,t);r&&this.credentialMatchesFilter(r,o,t)&&wo.fromString(r.target).intersectingScopeSets(i)&&this.removeAccessToken(e,t)}),await this.setAccessTokenCredential(e,t,r)}getAccountsFilteredBy(e,t){const r=this.getAccountKeys(),o=[];return r.forEach(r=>{const n=this.getAccount(r,t);if(!n)return;if(e.homeAccountId&&!this.matchHomeAccountId(n,e.homeAccountId))return;if(e.username&&!this.matchUsername(n.username,e.username))return;if(e.environment&&!this.matchEnvironment(n,e.environment,t))return;if(e.realm&&!this.matchRealm(n,e.realm))return;if(e.nativeAccountId&&!this.matchNativeAccountId(n,e.nativeAccountId))return;if(e.authorityType&&!this.matchAuthorityType(n,e.authorityType))return;const i={localAccountId:e?.localAccountId,name:e?.name},s=n.tenantProfiles?.filter(e=>this.tenantProfileMatchesFilter(e,i));s&&0===s.length||o.push(n)}),o}credentialMatchesFilter(e,t,r){if(t.clientId&&!this.matchClientId(e,t.clientId))return!1;if(t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash))return!1;if("string"==typeof t.homeAccountId&&!this.matchHomeAccountId(e,t.homeAccountId))return!1;if(t.environment&&!this.matchEnvironment(e,t.environment,r))return!1;if(t.realm&&!this.matchRealm(e,t.realm))return!1;if(t.credentialType&&!this.matchCredentialType(e,t.credentialType))return!1;if(t.familyId&&!this.matchFamilyId(e,t.familyId))return!1;if(t.target&&!this.matchTarget(e,t.target))return!1;if(e.credentialType===Y.ACCESS_TOKEN_WITH_AUTH_SCHEME){if(t.tokenType&&!this.matchTokenType(e,t.tokenType))return!1;if(t.tokenType===he.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId))return!1}return!0}getAppMetadataFilteredBy(e,t){const r=this.getKeys(),o={};return r.forEach(r=>{if(!this.isAppMetadata(r))return;const n=this.getAppMetadata(r,t);n&&(e.environment&&!this.matchEnvironment(n,e.environment,t)||e.clientId&&!this.matchClientId(n,e.clientId)||(o[r]=n))}),o}getAuthorityMetadataByAlias(e,t){const r=this.getAuthorityMetadataKeys();let o=null;return r.forEach(r=>{if(!this.isAuthorityMetadata(r)||-1===r.indexOf(this.clientId))return;const n=this.getAuthorityMetadata(r,t);n&&-1!==n.aliases.indexOf(e)&&(o=n)}),o}removeAllAccounts(e){this.getAllAccounts({},e).forEach(t=>{this.removeAccount(t,e)})}removeAccount(e,t){this.removeAccountContext(e,t),this.getAccountKeys().filter(t=>t.includes(e.homeAccountId)&&t.includes(e.environment)).forEach(e=>{this.removeItem(e,t),this.performanceClient.incrementFields({accountsRemoved:1},t)})}removeAccountContext(e,t){const r=this.getTokenKeys(),o=t=>t.includes(e.homeAccountId)&&t.includes(e.environment);r.idToken.filter(o).forEach(e=>{this.removeIdToken(e,t)}),r.accessToken.filter(o).forEach(e=>{this.removeAccessToken(e,t)}),r.refreshToken.filter(o).forEach(e=>{this.removeRefreshToken(e,t)})}removeAccessToken(e,t){const r=this.getAccessTokenCredential(e,t);if(r&&(this.removeItem(e,t),this.performanceClient.incrementFields({accessTokensRemoved:1},t),r.credentialType.toLowerCase()===Y.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()&&r.tokenType===he.POP)){const e=r.keyId;e&&this.cryptoImpl.removeTokenBindingKey(e,t).catch(()=>{this.commonLogger.error("0cx291",t),this.performanceClient?.incrementFields({removeTokenBindingKeyFailure:1},t)})}}removeAppMetadata(e){return this.getKeys().forEach(t=>{this.isAppMetadata(t)&&this.removeItem(t,e)}),!0}getIdToken(e,t,r,o){this.commonLogger.trace("1drz22",t);const n={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:Y.ID_TOKEN,clientId:this.clientId,realm:o},i=this.getIdTokensByFilter(n,t,r),s=i.size;if(s<1)return this.commonLogger.info("1atvtd",t),null;if(s>1){let r=i;if(!o){const o=new Map;i.forEach((t,r)=>{t.realm===e.tenantId&&o.set(r,t)});const n=o.size;if(n<1)return this.commonLogger.info("0ooalx",t),i.values().next().value;if(1===n)return this.commonLogger.info("1eq2vc",t),o.values().next().value;r=o}return this.commonLogger.info("1ws328",t),r.forEach((e,r)=>{this.removeIdToken(r,t)}),this.performanceClient.addFields({multiMatchedID:i.size},t),null}return this.commonLogger.info("1sm769",t),i.values().next().value}getIdTokensByFilter(e,t,r){const o=r&&r.idToken||this.getTokenKeys().idToken,n=new Map;return o.forEach(r=>{if(!this.idTokenKeyMatchesFilter(r,{clientId:this.clientId,...e}))return;const o=this.getIdTokenCredential(r,t);o&&this.credentialMatchesFilter(o,e,t)&&n.set(r,o)}),n}idTokenKeyMatchesFilter(e,t){const r=e.toLowerCase();return!(t.clientId&&-1===r.indexOf(t.clientId.toLowerCase())||t.homeAccountId&&-1===r.indexOf(t.homeAccountId.toLowerCase()))}removeIdToken(e,t){this.removeItem(e,t)}removeRefreshToken(e,t){this.removeItem(e,t)}getAccessToken(e,t,r,o){const n=t.correlationId;this.commonLogger.trace("1t7hz1",n);const i=wo.createSearchScopes(t.scopes),s=t.authenticationScheme||he.BEARER,a=s&&s.toLowerCase()!==he.BEARER.toLowerCase()?Y.ACCESS_TOKEN_WITH_AUTH_SCHEME:Y.ACCESS_TOKEN,c={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:a,clientId:this.clientId,realm:o||e.tenantId,target:i,tokenType:s,keyId:t.sshKid},h=r&&r.accessToken||this.getTokenKeys().accessToken,l=[];h.forEach(e=>{if(this.accessTokenKeyMatchesFilter(e,c,!0)){const t=this.getAccessTokenCredential(e,n);t&&this.credentialMatchesFilter(t,c,n)&&l.push(t)}});const d=l.length;return d<1?(this.commonLogger.info("1nckna",n),null):d>1?(this.commonLogger.info("1wkfwp",n),l.forEach(e=>{this.removeAccessToken(this.generateCredentialKey(e),n)}),this.performanceClient.addFields({multiMatchedAT:l.length},n),null):(this.commonLogger.info("06yt98",n),l[0])}accessTokenKeyMatchesFilter(e,t,r){const o=e.toLowerCase();if(t.clientId&&-1===o.indexOf(t.clientId.toLowerCase()))return!1;if(t.homeAccountId&&-1===o.indexOf(t.homeAccountId.toLowerCase()))return!1;if(t.realm&&-1===o.indexOf(t.realm.toLowerCase()))return!1;if(t.target){const e=t.target.asArray();for(let t=0;t<e.length;t++){if(r&&!o.includes(e[t].toLowerCase()))return!1;if(!r&&o.includes(e[t].toLowerCase()))return!0}}return!0}getAccessTokensByFilter(e,t){const r=this.getTokenKeys(),o=[];return r.accessToken.forEach(r=>{if(!this.accessTokenKeyMatchesFilter(r,e,!0))return;const n=this.getAccessTokenCredential(r,t);n&&this.credentialMatchesFilter(n,e,t)&&o.push(n)}),o}getRefreshToken(e,t,r,o){this.commonLogger.trace("0x53vi",r);const n=t?ee:void 0,i={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:Y.REFRESH_TOKEN,clientId:this.clientId,familyId:n},s=o&&o.refreshToken||this.getTokenKeys().refreshToken,a=[];s.forEach(e=>{if(this.refreshTokenKeyMatchesFilter(e,i)){const t=this.getRefreshTokenCredential(e,r);t&&this.credentialMatchesFilter(t,i,r)&&a.push(t)}});const c=a.length;return c<1?(this.commonLogger.info("0dlw11",r),null):(c>1&&this.performanceClient.addFields({multiMatchedRT:c},r),this.commonLogger.info("0wcnep",r),a[0])}refreshTokenKeyMatchesFilter(e,t){const r=e.toLowerCase();return!(t.familyId&&-1===r.indexOf(t.familyId.toLowerCase())||!t.familyId&&t.clientId&&-1===r.indexOf(t.clientId.toLowerCase())||t.homeAccountId&&-1===r.indexOf(t.homeAccountId.toLowerCase()))}readAppMetadataFromCache(e,t){const r={environment:e,clientId:this.clientId},o=this.getAppMetadataFilteredBy(r,t),i=Object.keys(o).map(e=>o[e]),s=i.length;if(s<1)return null;if(s>1)throw n("multiple_matching_appMetadata");return i[0]}isAppMetadataFOCI(e,t){const r=this.readAppMetadataFromCache(e,t);return!(!r||r.familyId!==ee)}matchHomeAccountId(e,t){return!("string"!=typeof e.homeAccountId||t!==e.homeAccountId)}matchLocalAccountIdFromTokenClaims(e,t){return t===(e.oid||e.sub)}matchLocalAccountIdFromTenantProfile(e,t){return e.localAccountId===t}matchName(e,t){return!(t.toLowerCase()!==e.name?.toLowerCase())}matchUsername(e,t){return!(!e||"string"!=typeof e||t?.toLowerCase()!==e.toLowerCase())}matchUserAssertionHash(e,t){return!(!e.userAssertionHash||t!==e.userAssertionHash)}matchEnvironment(e,t,r){if(this.staticAuthorityOptions){const o=function(e,t,r){let o;const n=e.canonicalAuthority;if(n){const i=new gr(n).getUrlComponents().HostNameAndPort;o=wr(t,r,i,e.cloudDiscoveryMetadata?.metadata)||wr(t,r,i,fr.metadata)||e.knownAuthorities}return o||[]}(this.staticAuthorityOptions,this.commonLogger,r);if(o.includes(t)&&o.includes(e.environment))return!0}const o=this.getAuthorityMetadataByAlias(t,r);return!!(o&&o.aliases.indexOf(e.environment)>-1)}matchCredentialType(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()}matchClientId(e,t){return!(!e.clientId||t!==e.clientId)}matchFamilyId(e,t){return!(!e.familyId||t!==e.familyId)}matchRealm(e,t){return!(e.realm?.toLowerCase()!==t.toLowerCase())}matchNativeAccountId(e,t){return!(!e.nativeAccountId||t!==e.nativeAccountId)}matchLoginHintFromTokenClaims(e,t){return e.login_hint===t||e.preferred_username===t||e.upn===t}matchSid(e,t){return e.sid===t}matchAuthorityType(e,t){return!(!e.authorityType||t.toLowerCase()!==e.authorityType.toLowerCase())}matchTarget(e,t){return!(e.credentialType!==Y.ACCESS_TOKEN&&e.credentialType!==Y.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target)&&wo.fromString(e.target).containsScopeSet(t)}matchTokenType(e,t){return!(!e.tokenType||e.tokenType!==t)}matchKeyId(e,t){return!(!e.keyId||e.keyId!==t)}isAppMetadata(e){return-1!==e.indexOf(Z)}isAuthorityMetadata(e){return-1!==e.indexOf(te)}generateAuthorityMetadataCacheKey(e){return`${te}-${this.clientId}-${e}`}static toObject(e,t){for(const r in t)e[r]=t[r];return e}}class Ao extends To{async setAccount(){throw n(w)}getAccount(){throw n(w)}async setIdTokenCredential(){throw n(w)}getIdTokenCredential(){throw n(w)}async setAccessTokenCredential(){throw n(w)}getAccessTokenCredential(){throw n(w)}async setRefreshTokenCredential(){throw n(w)}getRefreshTokenCredential(){throw n(w)}setAppMetadata(){throw n(w)}getAppMetadata(){throw n(w)}setServerTelemetry(){throw n(w)}getServerTelemetry(){throw n(w)}setAuthorityMetadata(){throw n(w)}getAuthorityMetadata(){throw n(w)}getAuthorityMetadataKeys(){throw n(w)}setThrottlingCache(){throw n(w)}getThrottlingCache(){throw n(w)}removeItem(){throw n(w)}getKeys(){throw n(w)}getAccountKeys(){throw n(w)}getTokenKeys(){throw n(w)}generateCredentialKey(){throw n(w)}generateAccountKey(){throw n(w)}}const So="msal",_o="browser",Po=`${So}.${_o}.log.level`,Oo=`${So}.${_o}.log.pii`,Ro=`${So}.${_o}.platform.auth.dom`,Eo=`${So}.version`,xo="account.keys",Mo="token.keys";function qo(e=2){return e<1?`${So}.${xo}`:`${So}.${e}.${xo}`}function Uo(e,t=2){return t<1?`${So}.${Mo}.${e}`:`${So}.${t}.${Mo}.${e}`}class No extends t{constructor(e,t){super(e,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,No.prototype)}}function Ho(e){return new No(e,qe(e))}const Lo="None";class Fo{initialize(){return Promise.resolve()}getItem(e){const t=`${encodeURIComponent(e)}`,r=document.cookie.split(";");for(let e=0;e<r.length;e++){const o=r[e],[n,...i]=decodeURIComponent(o).trim().split("="),s=i.join("=");if(n===t)return s}return""}getUserData(){throw n(w)}setItem(e,t,r,o=!0,n="Lax"){let i=`${encodeURIComponent(e)}=${encodeURIComponent(t)};path=/;SameSite=${n};`;if(r){const e=function(e){const t=new Date;return new Date(t.getTime()+864e5*e).toUTCString()}(r);i+=`expires=${e};`}(o||n===Lo)&&(i+="Secure;"),document.cookie=i}async setUserData(){return Promise.reject(n(w))}removeItem(e){this.setItem(e,"",-1)}getKeys(){const e=document.cookie.split(";"),t=[];return e.forEach(e=>{const r=decodeURIComponent(e).trim().split("=");t.push(r[0])}),t}containsKey(e){return this.getKeys().includes(e)}decryptData(){return Promise.resolve(null)}}function Ko(e,t){const r=e.getItem(qo(t));return r?JSON.parse(r):[]}function Do(e,t,r){const o=t.getItem(Uo(e,r));if(o){const e=JSON.parse(o);if(e&&e.hasOwnProperty("idToken")&&e.hasOwnProperty("accessToken")&&e.hasOwnProperty("refreshToken"))return e}return{idToken:[],accessToken:[],refreshToken:[]}}function zo(e){return e.hasOwnProperty("id")&&e.hasOwnProperty("nonce")&&e.hasOwnProperty("data")}const jo="storage_not_supported",Bo="msal.cache.encryption";class $o{constructor(e,t,r){if(!window.localStorage)throw Ho(jo);this.memoryStorage=new er,this.initialized=!1,this.clientId=e,this.logger=t,this.performanceClient=r,this.broadcast=new BroadcastChannel("msal.broadcast.cache")}async initialize(e){const t=new Fo,r=t.getItem(Bo);let o={key:"",id:""};if(r)try{o=JSON.parse(r)}catch(e){}if(o.key&&o.id){const t=Rr(rt,"base64Decode",this.logger,this.performanceClient,e)(o.key);this.encryptionCookie={id:o.id,key:await Er(Gt,_e,this.logger,this.performanceClient,e)(t)}}else{const r=Bt(),o=await Er(Vt,"generateBaseKey",this.logger,this.performanceClient,e)(),n=Rr(Ee,"urlEncodeArr",this.logger,this.performanceClient,e)(new Uint8Array(o));this.encryptionCookie={id:r,key:await Er(Gt,_e,this.logger,this.performanceClient,e)(o)};const i={id:r,key:n};t.setItem(Bo,JSON.stringify(i),0,!0,Lo)}await Er(this.importExistingCache.bind(this),"importExistingCache",this.logger,this.performanceClient,e)(e),this.broadcast.addEventListener("message",t=>{this.updateCache(t,e)}),this.initialized=!0}getItem(e){return window.localStorage.getItem(e)}getUserData(e){if(!this.initialized)throw Ne(Ye);return this.memoryStorage.getItem(e)}async decryptData(e,t,r){if(!this.initialized||!this.encryptionCookie)throw Ne(Ye);if(t.id!==this.encryptionCookie.id)return this.performanceClient.incrementFields({encryptedCacheExpiredCount:1},r),null;const o=await Er(Yt,Pe,this.logger,this.performanceClient,r)(this.encryptionCookie.key,t.nonce,this.getContext(e),t.data);if(!o)return null;try{return{...JSON.parse(o),lastUpdatedAt:t.lastUpdatedAt}}catch(e){return this.performanceClient.incrementFields({encryptedCacheCorruptionCount:1},r),null}}setItem(e,t){window.localStorage.setItem(e,t)}async setUserData(e,t,r,o,n){if(!this.initialized||!this.encryptionCookie)throw Ne(Ye);if(n)this.setItem(e,t);else{const{data:n,nonce:i}=await Er(Xt,"encrypt",this.logger,this.performanceClient,r)(this.encryptionCookie.key,t,this.getContext(e)),s={id:this.encryptionCookie.id,nonce:i,data:n,lastUpdatedAt:o};this.setItem(e,JSON.stringify(s))}this.memoryStorage.setItem(e,t),this.broadcast.postMessage({key:e,value:t,context:this.getContext(e)})}removeItem(e){this.memoryStorage.containsKey(e)&&(this.memoryStorage.removeItem(e),this.broadcast.postMessage({key:e,value:null,context:this.getContext(e)})),window.localStorage.removeItem(e)}getKeys(){return Object.keys(window.localStorage)}containsKey(e){return window.localStorage.hasOwnProperty(e)}clear(){this.memoryStorage.clear(),Ko(this).forEach(e=>this.removeItem(e));const e=Do(this.clientId,this);e.idToken.forEach(e=>this.removeItem(e)),e.accessToken.forEach(e=>this.removeItem(e)),e.refreshToken.forEach(e=>this.removeItem(e)),this.getKeys().forEach(e=>{(e.startsWith(So)||-1!==e.indexOf(this.clientId))&&this.removeItem(e)})}async importExistingCache(e){if(!this.encryptionCookie)return;let t=Ko(this);t=await this.importArray(t,e),t.length?this.setItem(qo(),JSON.stringify(t)):this.removeItem(qo());const r=Do(this.clientId,this);r.idToken=await this.importArray(r.idToken,e),r.accessToken=await this.importArray(r.accessToken,e),r.refreshToken=await this.importArray(r.refreshToken,e),r.idToken.length||r.accessToken.length||r.refreshToken.length?this.setItem(Uo(this.clientId),JSON.stringify(r)):this.removeItem(Uo(this.clientId))}async getItemFromEncryptedCache(e,t){if(!this.encryptionCookie)return null;const r=this.getItem(e);if(!r)return null;let o;try{o=JSON.parse(r)}catch(e){return null}return zo(o)?o.id!==this.encryptionCookie.id?(this.performanceClient.incrementFields({encryptedCacheExpiredCount:1},t),null):(this.performanceClient.incrementFields({encryptedCacheCount:1},t),Er(Yt,Pe,this.logger,this.performanceClient,t)(this.encryptionCookie.key,o.nonce,this.getContext(e),o.data)):(this.performanceClient.incrementFields({unencryptedCacheCount:1},t),r)}async importArray(e,t){const r=[],o=[];return e.forEach(e=>{const n=this.getItemFromEncryptedCache(e,t).then(t=>{t?(this.memoryStorage.setItem(e,t),r.push(e)):this.removeItem(e)});o.push(n)}),await Promise.all(o),r}getContext(e){let t="";return e.includes(this.clientId)&&(t=this.clientId),t}updateCache(e,t){this.logger.trace("17cxcm",t);const r=this.performanceClient.startMeasurement("localStorageUpdated");r.add({isBackground:!0});const{key:o,value:n,context:i}=e.data;return o?i&&i!==this.clientId?(this.logger.trace("04rtdy",t),void r.end({success:!1,errorCode:"contextMismatch"})):(n?(this.memoryStorage.setItem(o,n),this.logger.verbose("1vzsgt",t)):(this.memoryStorage.removeItem(o),this.logger.verbose("04ypih",t)),void r.end({success:!0})):(this.logger.error("0e10qr",t),void r.end({success:!1,errorCode:"noKey"}))}}class Jo{constructor(){if(!window.sessionStorage)throw Ho(jo)}async initialize(){}getItem(e){return window.sessionStorage.getItem(e)}getUserData(e){return this.getItem(e)}setItem(e,t){window.sessionStorage.setItem(e,t)}async setUserData(e,t){this.setItem(e,t)}removeItem(e){window.sessionStorage.removeItem(e)}getKeys(){return Object.keys(window.sessionStorage)}containsKey(e){return window.sessionStorage.hasOwnProperty(e)}decryptData(){return Promise.resolve(null)}}const Wo="msal:initializeEnd",Vo="msal:activeAccountChanged",Go="msal:loginSuccess",Qo="msal:acquireTokenStart",Xo="msal:acquireTokenSuccess",Yo="msal:acquireTokenFailure",Zo="msal:handleRedirectEnd",en="msal:popupOpened",tn="msal:logoutStart",rn="msal:logoutSuccess",on="msal:logoutFailure",nn="msal:logoutEnd";function sn(e,t){if(!e)throw n(m);if(!t)throw n(c);try{const r=t.split("|"),o=r[0],n=r.length>1?r.slice(1).join("|"):"",i=e(o);return{userRequestState:n||"",libraryState:JSON.parse(i)}}catch(e){throw n(c)}}function an(e){if(!e)return e;let t=e.toLowerCase();return ar.endsWith(t,"?")?t=t.slice(0,-1):ar.endsWith(t,"?/")&&(t=t.slice(0,-2)),ar.endsWith(t,"/")||(t+="/"),t}function cn(e){return e.startsWith("#/")?e.substring(2):e.startsWith("#")||e.startsWith("?")?e.substring(1):e}function hn(e){if(!e||e.indexOf("=")<0)return null;try{const t=cn(e),r=Object.fromEntries(new URLSearchParams(t));if(r.code||r.ear_jwe||r.error||r.error_description||r.state)return r}catch(e){throw n("hash_not_deserialized")}return null}function ln(e){const t=new Array;return e.forEach((e,r)=>{t.push(`${r}=${encodeURIComponent(e)}`)}),t.join("&")}function dn(e){if(!e)return e;const t=e.split("#")[0];try{const e=new URL(t);return an(e.origin+e.pathname+e.search)}catch(e){return an(t)}}const un="client_id",gn="redirect_uri",pn="token_type",mn="req_cnf",fn="return_spa_code",yn="x-client-xtra-sku",wn="brk_client_id",In="brk_redirect_uri",Cn="instance_aware";function vn(e,t,r){if(!t)return;const o=e.get(un);o&&e.has(wn)&&r?.addFields({embeddedClientId:o,embeddedRedirectUri:e.get(gn)},t)}function kn(e,t){e.set("response_type",t)}function bn(e,t,r=!0,o=M){!r||o.includes("openid")||t.includes("openid")||o.push("openid");const n=r?[...t||[],...o]:t||[],i=new wo(n);e.set("scope",i.printScopes())}function Tn(e,t){e.set(un,t)}function An(e,t){e.set(gn,t)}function Sn(e,t){e.set("login_hint",t)}function _n(e,t){e.set(H,`UPN:${t}`)}function Pn(e,t){e.set(H,`Oid:${t.uid}@${t.utid}`)}function On(e,t){e.set("sid",t)}function Rn(e,t,r){const o=function(e,t){let r;if(e)try{r=JSON.parse(e)}catch(e){throw sr(hr)}else r={};return t&&t.length>0&&(r.hasOwnProperty(B)||(r[B]={}),r[B][$]={values:t}),JSON.stringify(r)}(t,r);try{JSON.parse(o)}catch(e){throw sr(hr)}e.set("claims",o)}function En(e,t){e.set("client-request-id",t)}function xn(e,t){e.set("x-client-SKU",t.sku),e.set("x-client-VER",t.version),t.os&&e.set("x-client-OS",t.os),t.cpu&&e.set("x-client-CPU",t.cpu)}function Mn(e,t){t?.appName&&e.set("x-app-name",t.appName),t?.appVersion&&e.set("x-app-ver",t.appVersion)}function qn(e,t){t&&e.set("state",t)}function Un(e,t,r){if(!t||!r)throw sr(lr);e.set("code_challenge",t),e.set("code_challenge_method",r)}function Nn(e,t){e.set("client_secret",t)}function Hn(e,t){t&&e.set("client_assertion",t)}function Ln(e,t){t&&e.set("client_assertion_type",t)}function Fn(e,t){e.set("grant_type",t)}function Kn(e){e.set("client_info","1")}function Dn(e){e.has(Cn)||e.set(Cn,"true")}function zn(e,t){Object.entries(t).forEach(([t,r])=>{!e.has(t)&&r&&e.set(t,r)})}function jn(e,t){t&&(e.set(pn,he.POP),e.set(mn,t))}function Bn(e,t){t&&(e.set(pn,he.SSH),e.set(mn,t))}function $n(e,t){e.set("x-client-current-telemetry",t.generateCurrentRequestHeaderValue()),e.set("x-client-last-telemetry",t.generateLastRequestHeaderValue())}function Jn(e){e.set("x-ms-lib-capability","retry-after, h429")}function Wn(e,t,r){e.has(wn)||e.set(wn,t),e.has(In)||e.set(In,r)}function Vn(e){e.location.hash="","function"==typeof e.history.replaceState&&e.history.replaceState(null,"",`${e.location.origin}${e.location.pathname}${e.location.search}`)}function Gn(){return window.parent!==window}let Qn=null;async function Xn(e,t,r,o){return new Promise((n,i)=>{t.verbose("1rf6em",o.correlationId);const{libraryState:s}=sn(r.base64Decode,o.state||""),a=new BroadcastChannel(s.id);let c;const h=window.setTimeout(()=>{Qn=null,a.close(),i(Ne(et,"redirect_bridge_timeout"))},e);Qn={timeoutId:h,channel:a,reject:i},a.onmessage=e=>{c=e.data.payload,Qn=null,clearTimeout(h),a.close(),c?n(c):i(Ne("redirect_bridge_empty_response"))}})}function Yn(){return"undefined"!=typeof window&&window.location?window.location.href.split("?")[0].split("#")[0]:""}function Zn(){if("undefined"==typeof window)throw Ne($e)}function ei(e){if(!e)throw Ne(Ye)}function ti(e){Zn(),function(){if(hn(window.location.hash)&&Gn())throw Ne("block_iframe_reload")}(),function(){if(function(){if(Gn())return!1;try{const{libraryState:e}=function(){const e=window.location.hash,t=window.location.search;let r,o=!1,n=!1,i="";if(e&&e.length>1){const t="#"===e.charAt(0)?e.substring(1):e,n=new URLSearchParams(t);n.has("state")&&(o=!0,i=t,r=n)}if(t&&t.length>1){const e="?"===t.charAt(0)?t.substring(1):t,o=new URLSearchParams(e);o.has("state")&&(n=!0,i=e,r=o)}if(o&&n&&(i=`${"?"===t.charAt(0)?t.substring(1):t}${"#"===e.charAt(0)?e.substring(1):e}`,r=new URLSearchParams(i)),!i||!r)throw Ne("empty_response");const s=r.get("state");if(!s)throw Ne(De);const{libraryState:a}=sn(tt,s),{id:c,meta:h}=a;if(!c||!h)throw Ne(ze,"missing_library_state");return{params:r,payload:i,urlHash:e,urlQuery:t,hasResponseInHash:o,hasResponseInQuery:n,libraryState:{id:c,meta:h}}}(),{meta:t}=e;return t.interactionType===St.Popup}catch(e){return!1}}())throw Ne("block_nested_popups")}(),ei(e)}function ri(e,t){if(ti(e),function(e){if(Gn()&&!e)throw Ne("redirect_in_iframe")}(t.system.allowRedirectInIframe),t.cache.cacheLocation===ut)throw Ho("in_mem_redirect_unavailable")}function oi(e){const t=document.createElement("link");t.rel="preconnect",t.href=new URL(e).origin,t.crossOrigin="anonymous",document.head.appendChild(t),window.setTimeout(()=>{try{document.head.removeChild(t)}catch{}},1e4)}function ni(){return Bt()}const ii="5.1.0";function si(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}class ai extends To{constructor(e,t,r,o,n,i,s){super(e,r,o,n,s),this.cacheConfig=t,this.logger=o,this.internalStorage=new er,this.browserStorage=ci(e,t.cacheLocation,o,n),this.temporaryCacheStorage=ci(e,dt,o,n),this.cookieStorage=new Fo,this.eventHandler=i}async initialize(e){this.performanceClient.addFields({cacheLocation:this.cacheConfig.cacheLocation,cacheRetentionDays:this.cacheConfig.cacheRetentionDays},e),await this.browserStorage.initialize(e),await this.migrateExistingCache(e),this.trackVersionChanges(e)}async migrateExistingCache(e){let t=Ko(this.browserStorage),r=Do(this.clientId,this.browserStorage);this.performanceClient.addFields({preMigrateAcntCount:t.length,preMigrateATCount:r.accessToken.length,preMigrateITCount:r.idToken.length,preMigrateRTCount:r.refreshToken.length},e);for(let t=0;t<2;t++){const r=t;await this.removeStaleAccounts(t,r,e)}for(let t=0;t<2;t++){const r=t;await this.migrateIdTokens(t,r,e)}const o=this.getKMSIValues();for(let t=0;t<2;t++)await this.migrateAccessTokens(t,o,e),await this.migrateRefreshTokens(t,o,e);t=Ko(this.browserStorage),r=Do(this.clientId,this.browserStorage),this.performanceClient.addFields({postMigrateAcntCount:t.length,postMigrateATCount:r.accessToken.length,postMigrateITCount:r.idToken.length,postMigrateRTCount:r.refreshToken.length},e)}async updateOldEntry(e,t){const r=this.browserStorage.getItem(e),o=this.validateAndParseJson(r||"");if(!o)return this.browserStorage.removeItem(e),null;if(o.lastUpdatedAt){if(Kr(o.lastUpdatedAt,this.cacheConfig.cacheRetentionDays))return this.browserStorage.removeItem(e),this.performanceClient.incrementFields({expiredCacheRemovedCount:1},t),null}else o.lastUpdatedAt=Date.now().toString(),this.setItem(e,JSON.stringify(o),t);const n=zo(o)?await this.browserStorage.decryptData(e,o,t):o;return n&&jr(n)?(Br(n)||$r(n))&&n.expiresOn&&Fr(n.expiresOn,300)?(this.browserStorage.removeItem(e),this.performanceClient.incrementFields({expiredCacheRemovedCount:1},t),null):n:(this.performanceClient.incrementFields({invalidCacheCount:1},t),null)}async removeStaleAccounts(e,t,r){const o=Ko(this.browserStorage,e);if(0!==o.length){for(const e of[...o]){this.performanceClient.incrementFields({oldAcntCount:1},r);const n=this.browserStorage.getItem(e),i=this.validateAndParseJson(n||"");i?i.lastUpdatedAt?Kr(i.lastUpdatedAt,this.cacheConfig.cacheRetentionDays)&&(await this.removeAccountOldSchema(e,i,t,r),si(o,e)):(i.lastUpdatedAt=Date.now().toString(),this.setItem(e,JSON.stringify(i),r)):si(o,e)}this.setAccountKeys(o,r,e)}}async removeAccountOldSchema(e,t,r,o){const n=zo(t)?await this.browserStorage.decryptData(e,t,o):t,i=n?.homeAccountId;if(i){const e=this.getTokenKeys(r);[...e.idToken].filter(e=>e.includes(i)).forEach(t=>{this.browserStorage.removeItem(t),si(e.idToken,t)}),[...e.accessToken].filter(e=>e.includes(i)).forEach(t=>{this.browserStorage.removeItem(t),si(e.accessToken,t)}),[...e.refreshToken].filter(e=>e.includes(i)).forEach(t=>{this.browserStorage.removeItem(t),si(e.refreshToken,t)}),this.setTokenKeys(e,o,r)}this.performanceClient.incrementFields({expiredAcntRemovedCount:1},o),this.browserStorage.removeItem(e)}getKMSIValues(){const e={},t=this.getTokenKeys().idToken;for(const r of t){const t=this.browserStorage.getUserData(r);if(t){const r=JSON.parse(t),o=Mr(r.secret,tt);o&&(e[r.homeAccountId]=qr(o))}}return e}async migrateIdTokens(e,t,r){const o=Do(this.clientId,this.browserStorage,e);if(0===o.idToken.length)return;const n=Do(this.clientId,this.browserStorage,2),i=Ko(this.browserStorage),s=Ko(this.browserStorage,t);for(const e of[...o.idToken]){this.performanceClient.incrementFields({oldITCount:1},r);const t=await this.updateOldEntry(e,r);if(!t){si(o.idToken,e);continue}const a=i.find(e=>e.includes(t.homeAccountId)),c=s.find(e=>e.includes(t.homeAccountId));let h=null;if(a)h=this.getAccount(a,r);else if(c){const e=this.browserStorage.getItem(c),t=this.validateAndParseJson(e||"");h=t&&zo(t)?await this.browserStorage.decryptData(c,t,r):t}if(!h){this.performanceClient.incrementFields({skipITMigrateCount:1},r);continue}const l=Mr(t.secret,tt),d=this.generateCredentialKey(t),u=this.getIdTokenCredential(d,r),g=Object.keys(l).includes("signin_state"),p=u&&Object.keys(Mr(u.secret,tt)||{}).includes("signin_state");if(!u||t.lastUpdatedAt>u.lastUpdatedAt&&(g||!p)){const e=h.tenantProfiles||[],o=go(l)||h.realm;if(o&&!e.find(e=>e.tenantId===o)){const t=lo(h.homeAccountId,h.localAccountId,o,l);e.push(t)}h.tenantProfiles=e;const s=this.generateAccountKey(po(h)),a=qr(l);await this.setUserData(s,JSON.stringify(h),r,h.lastUpdatedAt,a),i.includes(s)||i.push(s),await this.setUserData(d,JSON.stringify(t),r,t.lastUpdatedAt,a),this.performanceClient.incrementFields({migratedITCount:1},r),n.idToken.push(d)}}this.setTokenKeys(o,r,e),this.setTokenKeys(n,r),this.setAccountKeys(i,r)}async migrateAccessTokens(e,t,r){const o=Do(this.clientId,this.browserStorage,e);if(0===o.accessToken.length)return;const n=Do(this.clientId,this.browserStorage,2);for(const e of[...o.accessToken]){this.performanceClient.incrementFields({oldATCount:1},r);const i=await this.updateOldEntry(e,r);if(!i){si(o.accessToken,e);continue}if(!(i.homeAccountId in t)){this.performanceClient.incrementFields({skipATMigrateCount:1},r);continue}const s=this.generateCredentialKey(i),a=t[i.homeAccountId];if(n.accessToken.includes(s)){const e=this.getAccessTokenCredential(s,r);(!e||i.lastUpdatedAt>e.lastUpdatedAt)&&(await this.setUserData(s,JSON.stringify(i),r,i.lastUpdatedAt,a),this.performanceClient.incrementFields({migratedATCount:1},r))}else await this.setUserData(s,JSON.stringify(i),r,i.lastUpdatedAt,a),this.performanceClient.incrementFields({migratedATCount:1},r),n.accessToken.push(s)}this.setTokenKeys(o,r,e),this.setTokenKeys(n,r)}async migrateRefreshTokens(e,t,r){const o=Do(this.clientId,this.browserStorage,e);if(0===o.refreshToken.length)return;const n=Do(this.clientId,this.browserStorage,2);for(const e of[...o.refreshToken]){this.performanceClient.incrementFields({oldRTCount:1},r);const i=await this.updateOldEntry(e,r);if(!i){si(o.refreshToken,e);continue}if(!(i.homeAccountId in t)){this.performanceClient.incrementFields({skipRTMigrateCount:1},r);continue}const s=this.generateCredentialKey(i),a=t[i.homeAccountId];if(n.refreshToken.includes(s)){const e=this.getRefreshTokenCredential(s,r);(!e||i.lastUpdatedAt>e.lastUpdatedAt)&&(await this.setUserData(s,JSON.stringify(i),r,i.lastUpdatedAt,a),this.performanceClient.incrementFields({migratedRTCount:1},r))}else await this.setUserData(s,JSON.stringify(i),r,i.lastUpdatedAt,a),this.performanceClient.incrementFields({migratedRTCount:1},r),n.refreshToken.push(s)}this.setTokenKeys(o,r,e),this.setTokenKeys(n,r)}trackVersionChanges(e){const t=this.browserStorage.getItem(Eo);t&&(this.logger.info("1wuc87",e),this.performanceClient.addFields({previousLibraryVersion:t},e)),t!==ii&&this.setItem(Eo,ii,e)}validateAndParseJson(e){if(!e)return null;try{const t=JSON.parse(e);return t&&"object"==typeof t?t:null}catch(e){return null}}setItem(e,t,r){const o=new Array(3).fill(0),n=[];for(let i=0;i<=20;i++)try{if(this.browserStorage.setItem(e,t),i>0)for(let e=0;e<=2;e++){const t=o.slice(0,e).reduce((e,t)=>e+t,0);if(t>=i)break;const s=i>t+o[e]?t+o[e]:i;i>t&&o[e]>0&&this.removeAccessTokenKeys(n.slice(t,s),r,e)}break}catch(s){const a=bo(s);if(!(a.errorCode===vo&&i<20))throw a;if(!n.length)for(let r=0;r<=2;r++)if(e===Uo(this.clientId,r)){const e=JSON.parse(t).accessToken;n.push(...e),o[r]=e.length}else{const e=this.getTokenKeys(r).accessToken;n.push(...e),o[r]=e.length}if(n.length<=i)throw a;this.removeAccessToken(n[i],r,!1)}}async setUserData(e,t,r,o,n){const i=new Array(3).fill(0),s=[];for(let a=0;a<=20;a++)try{if(await Er(this.browserStorage.setUserData.bind(this.browserStorage),"setUserData",this.logger,this.performanceClient,r)(e,t,r,o,n),a>0)for(let e=0;e<=2;e++){const t=i.slice(0,e).reduce((e,t)=>e+t,0);if(t>=a)break;const o=a>t+i[e]?t+i[e]:a;a>t&&i[e]>0&&this.removeAccessTokenKeys(s.slice(t,o),r,e)}break}catch(e){const t=bo(e);if(!(t.errorCode===vo&&a<20))throw t;if(!s.length)for(let e=0;e<=2;e++){const t=this.getTokenKeys(e).accessToken;s.push(...t),i[e]=t.length}if(s.length<=a)throw t;this.removeAccessToken(s[a],r,!1)}}getAccount(e,t){this.logger.trace("1lfvm6",t);const r=this.browserStorage.getUserData(e);if(!r)return this.removeAccountKeyFromMap(e,t),null;const o=this.validateAndParseJson(r);if(!(o&&(n=o,n&&n.hasOwnProperty("homeAccountId")&&n.hasOwnProperty("environment")&&n.hasOwnProperty("realm")&&n.hasOwnProperty("localAccountId")&&n.hasOwnProperty("username")&&n.hasOwnProperty("authorityType"))))return null;var n;const i=To.toObject({},o);var s;return this.performanceClient.addFields({accountCachedBy:(s=i.cachedByApiId,"number"==typeof s&&s in At?At[s]:"unknown")},t),i}async setAccount(e,t,r,o){this.logger.trace("1bz3wr",t);const n=this.generateAccountKey(po(e)),i=Date.now().toString();e.lastUpdatedAt=i,e.cachedByApiId=o,await this.setUserData(n,JSON.stringify(e),t,i,r),this.addAccountKeyToMap(n,t),this.performanceClient.addFields({kmsi:r},t)}setAccountKeys(e,t,r=2){0===e.length?this.removeItem(qo(r)):this.setItem(qo(r),JSON.stringify(e),t)}getAccountKeys(){return Ko(this.browserStorage)}addAccountKeyToMap(e,t){this.logger.trace("0rb85k",t),this.logger.tracePii("1l9bdo",t);const r=this.getAccountKeys();return-1===r.indexOf(e)?(r.push(e),this.setItem(qo(),JSON.stringify(r),t),this.logger.verbose("0xia39",t),!0):(this.logger.verbose("0161kk",t),!1)}removeAccountKeyFromMap(e,t){this.logger.trace("1jpigu",t),this.logger.tracePii("1xzspl",t);const r=this.getAccountKeys(),o=r.indexOf(e);o>-1?(r.splice(o,1),this.setAccountKeys(r,t)):this.logger.trace("1dytu2",t)}removeAccount(e,t){const r=this.getActiveAccount(t);r?.homeAccountId===e.homeAccountId&&r?.environment===e.environment&&this.setActiveAccount(null,t),super.removeAccount(e,t),this.removeAccountKeyFromMap(this.generateAccountKey(e),t),this.browserStorage.getKeys().forEach(t=>{t.includes(e.homeAccountId)&&t.includes(e.environment)&&this.browserStorage.removeItem(t)})}removeIdToken(e,t){super.removeIdToken(e,t);const r=this.getTokenKeys(),o=r.idToken.indexOf(e);o>-1&&(this.logger.info("05udv9",t),r.idToken.splice(o,1),this.setTokenKeys(r,t))}removeAccessToken(e,t,r=!0){super.removeAccessToken(e,t),r&&this.removeAccessTokenKeys([e],t)}removeAccessTokenKeys(e,t,r=2){this.logger.trace("17o18n",t);const o=this.getTokenKeys(r);let n=0;if(e.forEach(e=>{const t=o.accessToken.indexOf(e);t>-1&&(o.accessToken.splice(t,1),n++)}),n>0)return this.logger.info("15i5d5",t),void this.setTokenKeys(o,t,r)}removeRefreshToken(e,t){super.removeRefreshToken(e,t);const r=this.getTokenKeys(),o=r.refreshToken.indexOf(e);o>-1&&(this.logger.info("1f4fq3",t),r.refreshToken.splice(o,1),this.setTokenKeys(r,t))}getTokenKeys(e=2){return Do(this.clientId,this.browserStorage,e)}setTokenKeys(e,t,r=2){0!==e.idToken.length||0!==e.accessToken.length||0!==e.refreshToken.length?this.setItem(Uo(this.clientId,r),JSON.stringify(e),t):this.removeItem(Uo(this.clientId,r))}getIdTokenCredential(e,t){const r=this.browserStorage.getUserData(e);if(!r)return this.logger.trace("1jukz6",t),this.removeIdToken(e,t),null;const o=this.validateAndParseJson(r);return o&&(n=o)&&jr(n)&&n.hasOwnProperty("realm")&&n.credentialType===Y.ID_TOKEN?(this.logger.trace("01ju66",t),o):(this.logger.trace("1jukz6",t),null);var n}async setIdTokenCredential(e,t,r){this.logger.trace("13hjll",t);const o=this.generateCredentialKey(e),n=Date.now().toString();e.lastUpdatedAt=n,await this.setUserData(o,JSON.stringify(e),t,n,r);const i=this.getTokenKeys();-1===i.idToken.indexOf(o)&&(this.logger.info("07jy92",t),i.idToken.push(o),this.setTokenKeys(i,t))}getAccessTokenCredential(e,t){const r=this.browserStorage.getUserData(e);if(!r)return this.logger.trace("0bqvx8",t),this.removeAccessTokenKeys([e],t),null;const o=this.validateAndParseJson(r);return o&&Br(o)?(this.logger.trace("1o81rl",t),o):(this.logger.trace("0bqvx8",t),null)}async setAccessTokenCredential(e,t,r){this.logger.trace("1pondb",t);const o=this.generateCredentialKey(e),n=Date.now().toString();e.lastUpdatedAt=n,await this.setUserData(o,JSON.stringify(e),t,n,r);const i=this.getTokenKeys(),s=i.accessToken.indexOf(o);-1!==s&&i.accessToken.splice(s,1),this.logger.trace("1onhey",t),i.accessToken.push(o),this.setTokenKeys(i,t)}getRefreshTokenCredential(e,t){const r=this.browserStorage.getUserData(e);if(!r)return this.logger.trace("0jlizt",t),this.removeRefreshToken(e,t),null;const o=this.validateAndParseJson(r);return o&&$r(o)?(this.logger.trace("0nokxi",t),o):(this.logger.trace("0jlizt",t),null)}async setRefreshTokenCredential(e,t,r){this.logger.trace("0tcg8d",t);const o=this.generateCredentialKey(e),n=Date.now().toString();e.lastUpdatedAt=n,await this.setUserData(o,JSON.stringify(e),t,n,r);const i=this.getTokenKeys();-1===i.refreshToken.indexOf(o)&&(this.logger.info("0eckjs",t),i.refreshToken.push(o),this.setTokenKeys(i,t))}getAppMetadata(e,t){const r=this.browserStorage.getItem(e);if(!r)return this.logger.trace("1q101h",t),null;const o=this.validateAndParseJson(r);return o&&((n=o)&&0===e.indexOf(Z)&&n.hasOwnProperty("clientId")&&n.hasOwnProperty("environment"))?(this.logger.trace("19pvg2",t),o):(this.logger.trace("1q101h",t),null);var n}setAppMetadata(e,t){this.logger.trace("0cyma6",t);const r=function({environment:e,clientId:t}){return[Z,e,t].join("-").toLowerCase()}(e);this.setItem(r,JSON.stringify(e),t)}getServerTelemetry(e,t){const r=this.browserStorage.getItem(e);if(!r)return this.logger.trace("0jk19c",t),null;const o=this.validateAndParseJson(r);return o&&function(e,t){const r=0===e.indexOf(ae);let o=!0;return t&&(o=t.hasOwnProperty("failedRequests")&&t.hasOwnProperty("errors")&&t.hasOwnProperty("cacheHits")),r&&o}(e,o)?(this.logger.trace("12jguk",t),o):(this.logger.trace("0jk19c",t),null)}setServerTelemetry(e,t,r){this.logger.trace("1poh61",r),this.setItem(e,JSON.stringify(t),r)}getAuthorityMetadata(e,t){const r=this.internalStorage.getItem(e);if(!r)return this.logger.trace("1r39oe",t),null;const o=this.validateAndParseJson(r);return o&&function(e,t){return!!t&&0===e.indexOf(te)&&t.hasOwnProperty("aliases")&&t.hasOwnProperty("preferred_cache")&&t.hasOwnProperty("preferred_network")&&t.hasOwnProperty("canonical_authority")&&t.hasOwnProperty("authorization_endpoint")&&t.hasOwnProperty("token_endpoint")&&t.hasOwnProperty("issuer")&&t.hasOwnProperty("aliasesFromNetwork")&&t.hasOwnProperty("endpointsFromNetwork")&&t.hasOwnProperty("expiresAt")&&t.hasOwnProperty("jwks_uri")}(e,o)?(this.logger.trace("1ohvk3",t),o):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter(e=>this.isAuthorityMetadata(e))}setWrapperMetadata(e,t){this.internalStorage.setItem(vt,e),this.internalStorage.setItem(kt,t)}getWrapperMetadata(){return[this.internalStorage.getItem(vt)||"",this.internalStorage.getItem(kt)||""]}setAuthorityMetadata(e,t,r){this.logger.trace("07w8n2",r),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(e){const t=this.generateCacheKey(K),r=this.browserStorage.getItem(t);if(!r)return this.logger.trace("08gw0e",e),null;const o=this.validateAndParseJson(r);return o?(this.logger.trace("1t3ch7",e),this.getAccountInfoFilteredBy({homeAccountId:o.homeAccountId,localAccountId:o.localAccountId,tenantId:o.tenantId},e)):(this.logger.trace("0me1up",e),null)}setActiveAccount(e,t){const r=this.generateCacheKey(K);if(e){this.logger.verbose("0rsj80",t);const o={homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,tenantId:e.tenantId};this.setItem(r,JSON.stringify(o),t)}else this.logger.verbose("1bp5z5",t),this.browserStorage.removeItem(r);this.eventHandler.emitEvent(Vo)}getThrottlingCache(e,t){const r=this.browserStorage.getItem(e);if(!r)return this.logger.trace("1h4wa6",t),null;const o=this.validateAndParseJson(r);return o&&function(e,t){let r=!1;e&&(r=0===e.indexOf(le));let o=!0;return t&&(o=t.hasOwnProperty("throttleTime")),r&&o}(e,o)?(this.logger.trace("0of6n8",t),o):(this.logger.trace("1h4wa6",t),null)}setThrottlingCache(e,t,r){this.logger.trace("0wfgh6",r),this.setItem(e,JSON.stringify(t),r)}getTemporaryCache(e,t,r){const o=r?this.generateCacheKey(e):e,n=this.temporaryCacheStorage.getItem(o);if(!n){if(this.cacheConfig.cacheLocation===lt){const e=this.browserStorage.getItem(o);if(e)return this.logger.trace("1yt61y",t),e}return this.logger.trace("1qhy81",t),null}return n}setTemporaryCache(e,t,r){const o=r?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(o,t)}removeItem(e){this.browserStorage.removeItem(e)}removeTemporaryItem(e){this.temporaryCacheStorage.removeItem(e)}getKeys(){return this.browserStorage.getKeys()}clear(e){this.removeAllAccounts(e),this.removeAppMetadata(e),this.temporaryCacheStorage.getKeys().forEach(e=>{-1===e.indexOf(So)&&-1===e.indexOf(this.clientId)||this.removeTemporaryItem(e)}),this.browserStorage.getKeys().forEach(e=>{-1===e.indexOf(So)&&-1===e.indexOf(this.clientId)||this.browserStorage.removeItem(e)}),this.internalStorage.clear()}generateCacheKey(e){return ar.startsWith(e,So)?e:`${So}.${this.clientId}.${e}`}generateCredentialKey(e){const t=e.credentialType===Y.REFRESH_TOKEN&&e.familyId||e.clientId,r=e.tokenType&&e.tokenType.toLowerCase()!==he.BEARER.toLowerCase()?e.tokenType.toLowerCase():"";return[`${So}.2`,e.homeAccountId,e.environment,e.credentialType,t,e.realm||"",e.target||"",r].join("|").toLowerCase()}generateAccountKey(e){const t=e.homeAccountId.split(".")[1];return[`${So}.2`,e.homeAccountId,e.environment,t||e.tenantId||""].join("|").toLowerCase()}resetRequestCache(e){this.logger.trace("0h0ynu",e),this.removeTemporaryItem(this.generateCacheKey(yt)),this.removeTemporaryItem(this.generateCacheKey(wt)),this.removeTemporaryItem(this.generateCacheKey(mt)),this.removeTemporaryItem(this.generateCacheKey(ft)),this.removeTemporaryItem(this.generateCacheKey(Ct)),this.setInteractionInProgress(!1,void 0)}cacheAuthorizeRequest(e,t,r){this.logger.trace("1tzef5",t);const o=xe(JSON.stringify(e));if(this.setTemporaryCache(yt,o,!0),r){const e=xe(r);this.setTemporaryCache(wt,e,!0)}}getCachedRequest(e){this.logger.trace("0uen20",e);const t=this.getTemporaryCache(yt,e,!0);if(!t)throw Ne("no_token_request_cache_error");const r=this.getTemporaryCache(wt,e,!0);let o,n="";try{o=JSON.parse(tt(t)),r&&(n=tt(r))}catch(t){throw this.logger.errorPii("0ewsey",e),this.logger.error("0tvdic",e),Ne("unable_to_parse_token_request_cache_error")}return[o,n]}getCachedNativeRequest(){this.logger.trace("1yxcdm","");const e=this.getTemporaryCache(Ct,"",!0);if(!e)return this.logger.trace("0mnxd4",""),null;return this.validateAndParseJson(e)||(this.logger.error("0rrkip",""),null)}isInteractionInProgress(e){const t=this.getInteractionInProgress()?.clientId;return e?t===this.clientId:!!t}getInteractionInProgress(){const e=`${So}.${It}`,t=this.getTemporaryCache(e,"",!1);try{return t?JSON.parse(t):null}catch(t){return this.logger.error("0jjyys",""),this.removeTemporaryItem(e),this.resetRequestCache(""),Vn(window),null}}setInteractionInProgress(e,t=gt,r=!1,o=""){const n=`${So}.${It}`;if(e){if(this.getInteractionInProgress()){if(!r)throw Ne("interaction_in_progress");this.logger.warning("1pmscr",o),function(e,t){Qn&&(e.verbose("18y01k",t),clearTimeout(Qn.timeoutId),Qn.channel.close(),Qn.reject(Ne("interaction_in_progress_cancelled")),Qn=null)}(this.logger,o),this.removeTemporaryItem(n)}this.setTemporaryCache(n,JSON.stringify({clientId:this.clientId,type:t}),!1)}else e||this.getInteractionInProgress()?.clientId!==this.clientId||this.removeTemporaryItem(n)}async hydrateCache(e,t){const r={idToken:Dr(e.account.homeAccountId,e.account.environment,e.idToken,this.clientId,e.tenantId),accessToken:zr(e.account.homeAccountId,e.account.environment,e.accessToken,this.clientId,e.tenantId,e.scopes.join(" "),e.expiresOn?Hr(e.expiresOn):0,e.extExpiresOn?Hr(e.extExpiresOn):0,tt,void 0,e.tokenType,void 0,t.sshKid)};return this.saveCacheRecord(r,e.correlationId,qr(Mr(e.idToken,tt)),963)}async saveCacheRecord(e,t,r,o,n){try{await super.saveCacheRecord(e,t,r,o,n)}catch(e){if(e instanceof ko&&this.performanceClient&&t)try{const e=this.getTokenKeys();this.performanceClient.addFields({cacheRtCount:e.refreshToken.length,cacheIdCount:e.idToken.length,cacheAtCount:e.accessToken.length},t)}catch(e){}throw e}}}function ci(e,t,r,o){try{switch(t){case lt:return new $o(e,r,o);case dt:return new Jo}}catch(e){r.error(e,"")}return new er}var hi;!function(e){e[e.Error=0]="Error",e[e.Warning=1]="Warning",e[e.Info=2]="Info",e[e.Verbose=3]="Verbose",e[e.Trace=4]="Trace"}(hi||(hi={}));const li=new Map;class di{constructor(e,t,r){this.level=hi.Info;const o=e||di.createDefaultLoggerOptions();this.localCallback=o.loggerCallback||(()=>{}),this.piiLoggingEnabled=o.piiLoggingEnabled||!1,this.level="number"==typeof o.logLevel?o.logLevel:hi.Info,this.packageName=t||"",this.packageVersion=r||""}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:hi.Info}}clone(e,t){return new di({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level},e,t)}logMessage(e,t){const r=t.correlationId;if(function(e){if(6!==e.length)return!1;for(let t=0;t<e.length;t++){const r=e[t];if(!(r>="a"&&r<="z"||r>="A"&&r<="Z"||r>="0"&&r<="9"))return!1}return!0}(e)&&function(e,t){const r=Date.now();let o=li.get(e);if(o)!function(e,t){li.delete(e),li.set(e,t)}(e,o);else if(o={logs:[],firstEventTime:r},li.set(e,o),li.size>50){const e=li.keys().next().value;e&&li.delete(e)}o.logs.push({...t,milliseconds:r-o.firstEventTime}),o.logs.length>500&&o.logs.shift()}(r,{hash:e,level:t.logLevel,containsPii:t.containsPii||!1,milliseconds:0}),t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)return;const o=`[${(new Date).toUTCString()}] : [${r}] : ${this.packageName}@${this.packageVersion} : ${hi[t.logLevel]} - ${e}`;this.executeCallback(t.logLevel,o,t.containsPii||!1)}executeCallback(e,t,r){this.localCallback&&this.localCallback(e,t,r)}error(e,t){this.logMessage(e,{logLevel:hi.Error,containsPii:!1,correlationId:t})}errorPii(e,t){this.logMessage(e,{logLevel:hi.Error,containsPii:!0,correlationId:t})}warning(e,t){this.logMessage(e,{logLevel:hi.Warning,containsPii:!1,correlationId:t})}warningPii(e,t){this.logMessage(e,{logLevel:hi.Warning,containsPii:!0,correlationId:t})}info(e,t){this.logMessage(e,{logLevel:hi.Info,containsPii:!1,correlationId:t})}infoPii(e,t){this.logMessage(e,{logLevel:hi.Info,containsPii:!0,correlationId:t})}verbose(e,t){this.logMessage(e,{logLevel:hi.Verbose,containsPii:!1,correlationId:t})}verbosePii(e,t){this.logMessage(e,{logLevel:hi.Verbose,containsPii:!0,correlationId:t})}trace(e,t){this.logMessage(e,{logLevel:hi.Trace,containsPii:!1,correlationId:t})}tracePii(e,t){this.logMessage(e,{logLevel:hi.Trace,containsPii:!0,correlationId:t})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}}class ui{constructor(e){this.eventCallbacks=new Map,this.logger=e||new di({}),"undefined"!=typeof BroadcastChannel&&(this.broadcastChannel=new BroadcastChannel("msal.broadcast.event")),this.invokeCrossTabCallbacks=this.invokeCrossTabCallbacks.bind(this)}addEventCallback(e,t,r){if("undefined"!=typeof window){const o=r||ni();return this.eventCallbacks.has(o)?(this.logger.error("1578i0",""),null):(this.eventCallbacks.set(o,[e,t||[]]),this.logger.verbose("1cnec4",""),o)}return null}removeEventCallback(e){this.eventCallbacks.delete(e),this.logger.verbose("12zotd","")}emitEvent(e,t,r,o){const n={eventType:e,interactionType:t||null,payload:r||null,error:o||null,timestamp:Date.now()};switch(e){case Go:case rn:case Vo:this.broadcastChannel?.postMessage(n)}this.invokeCallbacks(n)}invokeCallbacks(e){this.eventCallbacks.forEach(([t,r],o)=>{(0===r.length||r.includes(e.eventType))&&(this.logger.verbose("15jpwk",""),t.apply(null,[e]))})}invokeCrossTabCallbacks(e){const t=e.data;this.invokeCallbacks(t)}subscribeCrossTab(){this.broadcastChannel?.addEventListener("message",this.invokeCrossTabCallbacks)}unsubscribeCrossTab(){this.broadcastChannel?.removeEventListener("message",this.invokeCrossTabCallbacks)}}new Set(["accessTokenSize","durationMs","idTokenSize","matsSilentStatus","matsHttpStatus","refreshTokenSize","startTimeMs","status","multiMatchedAT","multiMatchedID","multiMatchedRT","unencryptedCacheCount","encryptedCacheExpiredCount","oldAccountCount","oldAccessCount","oldIdCount","oldRefreshCount","currAccountCount","currAccessCount","currIdCount","currRefreshCount","expiredCacheRemovedCount","upgradedCacheCount"]);class gi{generateId(){return"callback-id"}startMeasurement(e,t){return{end:()=>null,discard:()=>{},add:()=>{},increment:()=>{},event:{eventId:this.generateId(),status:1,authority:"",libraryName:"",libraryVersion:"",clientId:"",name:e,startTimeMs:Date.now(),correlationId:t||""}}}endMeasurement(){return null}discardMeasurements(){}removePerformanceCallback(){return!0}addPerformanceCallback(){return""}emitEvents(){}addFields(){}incrementFields(){}cacheEventByCorrelationId(){}}const pi={tokenRenewalOffsetSeconds:300,preventCorsPreflight:!1},mi={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:hi.Info,correlationId:""},fi={async sendGetRequestAsync(){throw n(w)},async sendPostRequestAsync(){throw n(w)}},yi={sku:"msal.js.common",version:Co,cpu:"",os:""},wi={clientSecret:"",clientAssertion:void 0},Ii={azureCloudInstance:kr,tenant:`${k}`},Ci={application:{appName:"",appVersion:""}};function vi({authOptions:e,systemOptions:t,loggerOptions:r,storageInterface:o,networkInterface:n,cryptoInterface:i,clientCredentials:s,libraryInfo:a,telemetry:c,serverTelemetryManager:h,persistencePlugin:l,serializableCache:d}){const u={...mi,...r};return{authOptions:(g=e,{clientCapabilities:[],azureCloudOptions:Ii,instanceAware:!1,...g}),systemOptions:{...pi,...t},loggerOptions:u,storageInterface:o||new Ao(e.clientId,nr,new di(u),new gi),networkInterface:n||fi,cryptoInterface:i||nr,clientCredentials:s||wi,libraryInfo:{...yi,...a},telemetry:{...Ci,...c},serverTelemetryManager:h||null,persistencePlugin:l||null,serializableCache:d||null};var g}function ki(e){return e.authOptions.authority.options.protocolMode===Cr}class bi extends t{constructor(e,t,r,o,n){super(e,t,r),this.name="ServerError",this.errorNo=o,this.status=n,Object.setPrototypeOf(this,bi.prototype)}}class Ti{constructor(e,t){this.cryptoUtils=e,this.performanceClient=t}async generateCnf(e,t){const r=await Er(this.generateKid.bind(this),Sr,t,this.performanceClient,e.correlationId)(e),o=this.cryptoUtils.base64UrlEncode(JSON.stringify(r));return{kid:r.kid,reqCnfString:o}}async generateKid(e){return{kid:await this.cryptoUtils.getPublicKeyThumbprint(e),xms_ksl:"sw"}}async signPopToken(e,t,r){return this.signPayload(e,t,r)}async signPayload(e,t,r,o){const{resourceRequestMethod:n,resourceRequestUri:i,shrClaims:s,shrNonce:a,shrOptions:c}=r,h=i?new gr(i):void 0,l=h?.getUrlComponents();return this.cryptoUtils.signJwt({at:e,ts:Nr(),m:n?.toUpperCase(),u:l?.HostNameAndPort,nonce:a||this.cryptoUtils.createNewGuid(),p:l?.AbsolutePath,q:l?.QueryString?[[],l.QueryString]:void 0,client_claims:s||void 0,...o},t,c,r.correlationId)}}class Ai{constructor(e,t){this.cache=e,this.hasChanged=t}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}}class Si{constructor(e,t,r,o,n,i,s){this.clientId=e,this.cacheStorage=t,this.cryptoObj=r,this.logger=o,this.performanceClient=n,this.serializableCache=i,this.persistencePlugin=s}validateTokenResponse(e,t,r){if(e.error||e.error_description||e.suberror){const o=`Error(s): ${e.error_codes||O} - Timestamp: ${e.timestamp||O} - Description: ${e.error_description||O} - Correlation ID: ${e.correlation_id||O} - Trace ID: ${e.trace_id||O}`,n=e.error_codes?.length?e.error_codes[0]:void 0,i=new bi(e.error,o,e.suberror,n,e.status);if(r&&e.status&&e.status>=500&&e.status<=599)return void this.logger.warning("16ks7j",t);if(r&&e.status&&e.status>=400&&e.status<=499)return void this.logger.warning("0g61x3",t);if(io(e.error,e.error_description,e.suberror))throw new no(e.error,e.error_description,e.suberror,e.timestamp||"",e.trace_id||"",e.correlation_id||"",e.claims||"",n);throw i}}async handleServerTokenResponse(e,t,r,o,i,s,a,c,h,d){let u,g;if(e.id_token){if(u=Mr(e.id_token||"",this.cryptoObj.base64Decode),s&&s.nonce&&u.nonce!==s.nonce)throw n("nonce_mismatch");if(o.maxAge||0===o.maxAge){const e=u.auth_time;if(!e)throw n(l);Ur(e,o.maxAge)}}this.homeAccountIdentifier=mo(e.client_info||"",t.authorityType,this.logger,this.cryptoObj,o.correlationId,u),s&&s.state&&(g=sn(this.cryptoObj.base64Decode,s.state)),e.key_id=e.key_id||o.sshKid||void 0;const p=this.generateCacheRecord(e,t,r,o,u,a,s);let m;try{if(this.persistencePlugin&&this.serializableCache&&(this.logger.verbose("0jbz5k",o.correlationId),m=new Ai(this.serializableCache,!0),await this.persistencePlugin.beforeCacheAccess(m)),c&&!h&&p.account&&this.cacheStorage.getAllAccounts({homeAccountId:p.account.homeAccountId,environment:p.account.environment},o.correlationId).length<1)return this.logger.warning("1gmt66",o.correlationId),this.performanceClient?.addFields({acntLoggedOut:!0},o.correlationId),await Si.generateAuthenticationResult(this.cryptoObj,t,p,!1,o,this.performanceClient,u,g,void 0,d);await this.cacheStorage.saveCacheRecord(p,o.correlationId,qr(u||{}),i,o.storeInCache)}finally{this.persistencePlugin&&this.serializableCache&&m&&(this.logger.verbose("1bh17u",o.correlationId),await this.persistencePlugin.afterCacheAccess(m))}return Si.generateAuthenticationResult(this.cryptoObj,t,p,!1,o,this.performanceClient,u,g,e,d)}generateCacheRecord(e,t,r,o,i,s,a){const c=t.getPreferredCache();if(!c)throw n(g);const h=go(i);let l,d;e.id_token&&i&&(l=Dr(this.homeAccountIdentifier,c,e.id_token,this.clientId,h||""),d=_i(this.cacheStorage,t,this.homeAccountIdentifier,this.cryptoObj.base64Decode,o.correlationId,i,e.client_info,c,h,a,void 0,this.logger));let u=null;if(e.access_token){const n=e.scope?wo.fromString(e.scope):new wo(o.scopes||[]),i=("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0,a=("string"==typeof e.ext_expires_in?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,l=("string"==typeof e.refresh_in?parseInt(e.refresh_in,10):e.refresh_in)||void 0,d=r+i,g=d+a,p=l&&l>0?r+l:void 0;u=zr(this.homeAccountIdentifier,c,e.access_token,this.clientId,h||t.tenant||"",n.printScopes(),d,g,this.cryptoObj.base64Decode,p,e.token_type,s,e.key_id)}let p=null;if(e.refresh_token){let t;e.refresh_token_expires_in&&(t=r+("string"==typeof e.refresh_token_expires_in?parseInt(e.refresh_token_expires_in,10):e.refresh_token_expires_in),this.performanceClient?.addFields({ntwkRtExpiresOnSeconds:t},o.correlationId)),p=function(e,t,r,o,n,i,s){const a={credentialType:Y.REFRESH_TOKEN,homeAccountId:e,environment:t,clientId:o,secret:r,lastUpdatedAt:Date.now().toString()};return i&&(a.userAssertionHash=i),n&&(a.familyId=n),s&&(a.expiresOn=s.toString()),a}(this.homeAccountIdentifier,c,e.refresh_token,this.clientId,e.foci,s,t)}let m=null;return e.foci&&(m={clientId:this.clientId,environment:c,familyId:e.foci}),{account:d,idToken:l,accessToken:u,refreshToken:p,appMetadata:m}}static async generateAuthenticationResult(e,t,r,o,i,s,a,c,h,l){let d,u,g="",p=[],m=null,f="";if(r.accessToken){if(r.accessToken.tokenType!==he.POP||i.popKid)g=r.accessToken.secret;else{const t=new Ti(e,s),{secret:o,keyId:a}=r.accessToken;if(!a)throw n(y);g=await t.signPopToken(o,a,i)}p=wo.fromString(r.accessToken.target).asArray(),m=Lr(r.accessToken.expiresOn),d=Lr(r.accessToken.extendedExpiresOn),r.accessToken.refreshOn&&(u=Lr(r.accessToken.refreshOn))}r.appMetadata&&(f=r.appMetadata.familyId===ee?ee:"");const w=a?.oid||a?.sub||"",I=a?.tid||"";h?.spa_accountid&&r.account&&(r.account.nativeAccountId=h?.spa_accountid);const C=r.account?uo(po(r.account),void 0,a,r.idToken?.secret):null;return{authority:t.canonicalAuthority,uniqueId:w,tenantId:I,scopes:p,account:C,idToken:r?.idToken?.secret||"",idTokenClaims:a||{},accessToken:g,fromCache:o,expiresOn:m,extExpiresOn:d,refreshOn:u,correlationId:i.correlationId,requestId:l||"",familyId:f,tokenType:r.accessToken?.tokenType||"",state:c?c.userRequestState:"",cloudGraphHostName:r.account?.cloudGraphHostName||"",msGraphHost:r.account?.msGraphHost||"",code:h?.spa_code,fromPlatformBroker:!1}}}function _i(e,t,r,o,i,s,a,c,h,l,d,u){u?.verbose("09jz0t",i);const p=e.getAccountKeys().find(e=>e.startsWith(r));let m=null;p&&(m=e.getAccount(p,i));const f=m||function(e,t,r){let o,i,s;o=1===t.authorityType?"ADFS":t.protocolMode===Cr?X:"MSSTS",e.clientInfo&&r&&(i=ao(e.clientInfo,r),i.xms_tdbr&&(s="EU"===i.xms_tdbr?"EU":"None"));const a=e.environment||t&&t.getPreferredCache();if(!a)throw n(g);const c=e.idTokenClaims?.preferred_username||e.idTokenClaims?.upn,h=e.idTokenClaims?.emails?e.idTokenClaims.emails[0]:null,l=c||h||"",d=e.idTokenClaims?.login_hint,u=i?.utid||go(e.idTokenClaims)||"",p=i?.uid||e.idTokenClaims?.oid||e.idTokenClaims?.sub||"";let m;return m=e.tenantProfiles?e.tenantProfiles:[lo(e.homeAccountId,p,u,e.idTokenClaims)],{homeAccountId:e.homeAccountId,environment:a,realm:u,localAccountId:p,username:l,authorityType:o,loginHint:d,clientInfo:e.clientInfo,name:e.idTokenClaims?.name||"",lastModificationTime:void 0,lastModificationApp:void 0,cloudGraphHostName:e.cloudGraphHostName,msGraphHost:e.msGraphHost,nativeAccountId:e.nativeAccountId,tenantProfiles:m,dataBoundary:s}}({homeAccountId:r,idTokenClaims:s,clientInfo:a,environment:c,cloudGraphHostName:l?.cloud_graph_host_name,msGraphHost:l?.msgraph_host,nativeAccountId:d},t,o),y=f.tenantProfiles||[],w=h||f.realm;if(w&&!y.find(e=>e.tenantId===w)){const e=lo(r,f.localAccountId,w,s);y.push(e)}return f.tenantProfiles=y,f}const Pi="home_account_id",Oi="UPN";async function Ri(e,t,r){return"string"==typeof e?e:e({clientId:t,tokenEndpoint:r})}class Ei{static generateThrottlingStorageKey(e){return`${le}.${JSON.stringify(e)}`}static preProcess(e,t,r){const o=Ei.generateThrottlingStorageKey(t),n=e.getThrottlingCache(o,r);if(n){if(n.throttleTime<Date.now())return void e.removeItem(o,r);throw new bi(n.errorCodes?.join(" ")||"",n.errorMessage,n.subError)}}static postProcess(e,t,r,o){if(Ei.checkResponseStatus(r)||Ei.checkResponseForRetryAfter(r)){const n={throttleTime:Ei.calculateThrottleTime(parseInt(r.headers[N])),error:r.body.error,errorCodes:r.body.error_codes,errorMessage:r.body.error_description,subError:r.body.suberror};e.setThrottlingCache(Ei.generateThrottlingStorageKey(t),n,o)}}static checkResponseStatus(e){return 429===e.status||e.status>=500&&e.status<600}static checkResponseForRetryAfter(e){return!!e.headers&&e.headers.hasOwnProperty(N)&&(e.status<200||e.status>=300)}static calculateThrottleTime(e){const t=e<=0?0:e,r=Date.now()/1e3;return Math.floor(1e3*Math.min(r+(t||60),r+3600))}static removeThrottle(e,t,r,o){const n=fo(t,r,o),i=this.generateThrottlingStorageKey(n);e.removeItem(i,r.correlationId)}}class xi extends t{constructor(e,t,r){super(e.errorCode,e.errorMessage,e.subError),Object.setPrototypeOf(this,xi.prototype),this.name="NetworkError",this.error=e,this.httpStatus=t,this.responseHeaders=r}}function Mi(e,t,r,o){return e.errorMessage=`${e.errorMessage}, additionalErrorInfo: error.name:${o?.name}, error.message:${o?.message}`,new xi(e,t,r)}function qi(e,t,r){const o={};if(o[U]="application/x-www-form-urlencoded;charset=utf-8",!t&&r)switch(r.type){case Pi:try{const e=co(r.credential);o[H]=`Oid:${e.uid}@${e.utid}`}catch(t){e.verbose("1qhtee","")}break;case Oi:o[H]=`UPN: ${r.credential}`}return o}function Ui(e,t,r,o){const n=new Map;return e.embeddedClientId&&Wn(n,t,r),e.extraQueryParameters&&zn(n,e.extraQueryParameters),En(n,e.correlationId),vn(n,e.correlationId,o),ln(n)}async function Ni(e,r,o,i,s,a,c,h,l,d){const u=await async function(e,r,o,i,s,a,c,h){let l;Ei.preProcess(s,e,i);try{l=await Er(a.sendPostRequestAsync.bind(a),"networkClientSendPostRequestAsync",c,h,i)(r,o);const e=l.headers||{};h?.addFields({refreshTokenSize:l.body.refresh_token?.length||0,httpVerToken:e[F]||"",requestId:e[L]||""},i)}catch(e){if(e instanceof xi){const t=e.responseHeaders;throw t&&h?.addFields({httpVerToken:t[F]||"",requestId:t[L]||"",contentTypeHeader:t[U]||void 0,contentLengthHeader:t["Content-Length"]||void 0,httpStatus:e.httpStatus},i),e.error}throw e instanceof t?e:n("network_error")}return Ei.postProcess(s,e,l,i),l}(i,e,{body:r,headers:o},s,a,c,h,l);return d&&u.status<500&&429!==u.status&&d.clearTelemetryCache(),u}async function Hi(e,t,r,o,i,s,c){const h=Qr.transformCIAMAuthority(Xr(e)),l=new Qr(h,t,r,o,i,s,c);try{return await Er(l.resolveEndpointsAsync.bind(l),"authorityResolveEndpointsAsync",i,c,s)(),l}catch(e){throw n(a)}}class Li{constructor(e,t){this.includeRedirectUri=!0,this.config=vi(e),this.logger=new di(this.config.loggerOptions,Io,Co),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t,this.oidcDefaultScopes=this.config.authOptions.authority.options.OIDCOptions?.defaultScopes}async acquireToken(e,t,r){if(!e.code)throw n("request_cannot_be_made");r&&r.cloud_instance_host_name&&await Er(this.updateTokenEndpointAuthority.bind(this),"updateTokenEndpointAuthority",this.logger,this.performanceClient,e.correlationId)(r.cloud_instance_host_name,e.correlationId);const o=Nr(),i=await Er(this.executeTokenRequest.bind(this),"authClientExecuteTokenRequest",this.logger,this.performanceClient,e.correlationId)(this.authority,e,this.serverTelemetryManager),s=i.headers?.[L],a=new Si(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.performanceClient,this.config.serializableCache,this.config.persistencePlugin);return a.validateTokenResponse(i.body,e.correlationId),Er(a.handleServerTokenResponse.bind(a),_r,this.logger,this.performanceClient,e.correlationId)(i.body,this.authority,o,e,t,r,void 0,void 0,void 0,s)}getLogoutUri(e){if(!e)throw sr("logout_request_empty");const t=this.createLogoutUrlQueryString(e);return gr.appendQueryString(this.authority.endSessionEndpoint,t)}async executeTokenRequest(e,t,r){const o=Ui(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri,this.performanceClient),n=gr.appendQueryString(e.tokenEndpoint,o),i=await Er(this.createTokenRequestBody.bind(this),"authClientCreateTokenRequestBody",this.logger,this.performanceClient,t.correlationId)(t);let s;if(t.clientInfo)try{const e=ao(t.clientInfo,this.cryptoUtils.base64Decode);s={credential:`${e.uid}.${e.utid}`,type:Pi}}catch(e){this.logger.verbose("0wznt3",t.correlationId)}const a=qi(this.logger,this.config.systemOptions.preventCorsPreflight,s||t.ccsCredential),c=fo(this.config.authOptions.clientId,t);return Er(Ni,"authorizationCodeClientExecutePostToTokenEndpoint",this.logger,this.performanceClient,t.correlationId)(n,i,a,c,t.correlationId,this.cacheManager,this.networkClient,this.logger,this.performanceClient,r)}async createTokenRequestBody(e){const t=new Map;if(Tn(t,e.embeddedClientId||e.extraParameters?.[un]||this.config.authOptions.clientId),this.includeRedirectUri)An(t,e.redirectUri);else if(!e.redirectUri)throw sr("redirect_uri_empty");if(bn(t,e.scopes,!0,this.oidcDefaultScopes),function(e,t){e.set("code",t)}(t,e.code),xn(t,this.config.libraryInfo),Mn(t,this.config.telemetry.application),Jn(t),this.serverTelemetryManager&&!ki(this.config)&&$n(t,this.serverTelemetryManager),e.codeVerifier&&function(e,t){e.set("code_verifier",t)}(t,e.codeVerifier),this.config.clientCredentials.clientSecret&&Nn(t,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const r=this.config.clientCredentials.clientAssertion;Hn(t,await Ri(r.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),Ln(t,r.assertionType)}if(Fn(t,"authorization_code"),Kn(t),e.authenticationScheme===he.POP){const r=new Ti(this.cryptoUtils,this.performanceClient);let o;o=e.popKid?this.cryptoUtils.encodeKid(e.popKid):(await Er(r.generateCnf.bind(r),Sr,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,jn(t,o)}else if(e.authenticationScheme===he.SSH){if(!e.sshJwk)throw sr(ur);Bn(t,e.sshJwk)}let r;if((!ar.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&Rn(t,e.claims,this.config.authOptions.clientCapabilities),e.clientInfo)try{const t=ao(e.clientInfo,this.cryptoUtils.base64Decode);r={credential:`${t.uid}.${t.utid}`,type:Pi}}catch(t){this.logger.verbose("0wznt3",e.correlationId)}else r=e.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&r)switch(r.type){case Pi:try{Pn(t,co(r.credential))}catch(t){this.logger.verbose("1qhtee",e.correlationId)}break;case Oi:_n(t,r.credential)}return e.embeddedClientId&&Wn(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.extraParameters&&zn(t,e.extraParameters),!e.enableSpaAuthorizationCode||e.extraParameters&&e.extraParameters[fn]||zn(t,{[fn]:"1"}),vn(t,e.correlationId,this.performanceClient),ln(t)}createLogoutUrlQueryString(e){const t=new Map;return e.postLogoutRedirectUri&&function(e,t){e.set("post_logout_redirect_uri",t)}(t,e.postLogoutRedirectUri),e.correlationId&&En(t,e.correlationId),e.idTokenHint&&function(e,t){e.set("id_token_hint",t)}(t,e.idTokenHint),e.state&&qn(t,e.state),e.logoutHint&&function(e,t){e.set("logout_hint",t)}(t,e.logoutHint),e.extraQueryParameters&&zn(t,e.extraQueryParameters),this.config.authOptions.instanceAware&&Dn(t),ln(t)}async updateTokenEndpointAuthority(e,t){const r=`https://${e}/${this.authority.tenant}/`,o=await Hi(r,this.networkClient,this.cacheManager,this.authority.options,this.logger,t,this.performanceClient);this.authority=o}}class Fi{constructor(e,t){this.cacheOutcome="0",this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||"",this.wrapperVer=e.wrapperVer||"",this.telemetryCacheKey=ae+"-"+e.clientId}generateCurrentRequestHeaderValue(){const e=`${this.apiId}${ce}${this.cacheOutcome}`,t=[this.wrapperSKU,this.wrapperVer],r=this.getNativeBrokerErrorCode();r?.length&&t.push(`broker_error=${r}`);const o=t.join(ce),n=[e,this.getRegionDiscoveryFields()].join(ce);return[se,n,o].join("|")}generateLastRequestHeaderValue(){const e=this.getLastRequests(),t=Fi.maxErrorsToSend(e),r=e.failedRequests.slice(0,2*t).join(ce),o=e.errors.slice(0,t).join(ce),n=e.errors.length,i=[n,t<n?"1":"0"].join(ce);return[se,e.cacheHits,r,o,i].join("|")}cacheFailedRequest(e){const r=this.getLastRequests();r.errors.length>=50&&(r.failedRequests.shift(),r.failedRequests.shift(),r.errors.shift()),r.failedRequests.push(this.apiId,this.correlationId),e instanceof Error&&e&&e.toString()?e instanceof t?e.subError?r.errors.push(e.subError):e.errorCode?r.errors.push(e.errorCode):r.errors.push(e.toString()):r.errors.push(e.toString()):r.errors.push("unknown_error"),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,r,this.correlationId)}incrementCacheHits(){const e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId),e.cacheHits}getLastRequests(){return this.cacheManager.getServerTelemetry(this.telemetryCacheKey,this.correlationId)||{failedRequests:[],errors:[],cacheHits:0}}clearTelemetryCache(){const e=this.getLastRequests(),t=Fi.maxErrorsToSend(e);if(t===e.errors.length)this.cacheManager.removeItem(this.telemetryCacheKey,this.correlationId);else{const r={failedRequests:e.failedRequests.slice(2*t),errors:e.errors.slice(t),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,r,this.correlationId)}}static maxErrorsToSend(e){let t,r=0,o=0;const n=e.errors.length;for(t=0;t<n;t++){const n=e.failedRequests[2*t]||"",i=e.failedRequests[2*t+1]||"",s=e.errors[t]||"";if(o+=n.toString().length+i.toString().length+s.length+3,!(o<330))break;r+=1}return r}getRegionDiscoveryFields(){const e=[];return e.push(this.regionUsed||""),e.push(this.regionSource||""),e.push(this.regionOutcome||""),e.join(",")}updateRegionDiscoveryMetadata(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome}setCacheOutcome(e){this.cacheOutcome=e}setNativeBrokerErrorCode(e){const t=this.getLastRequests();t.nativeBrokerErrorCode=e,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}getNativeBrokerErrorCode(){return this.getLastRequests().nativeBrokerErrorCode}clearNativeBrokerErrorCode(){const e=this.getLastRequests();delete e.nativeBrokerErrorCode,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId)}static makeExtraSkuString(e){return function(e){const{skus:t,libraryName:r,libraryVersion:o,extensionName:n,extensionVersion:i}=e,s=new Map([[0,[r,o]],[2,[n,i]]]);let a=[];if(t?.length){if(a=t.split(","),a.length<4)return t}else a=Array.from({length:4},()=>"|");return s.forEach((e,t)=>{2===e.length&&e[0]?.length&&e[1]?.length&&function(e){const{skuArr:t,index:r,skuName:o,skuVersion:n}=e;r>=t.length||(t[r]=[o,n].join("|"))}({skuArr:a,index:t,skuName:e[0],skuVersion:e[1]})}),a.join(",")}(e)}}class Ki{constructor(e,t,r,o,n,i,s,a,c){this.config=e,this.browserStorage=t,this.browserCrypto=r,this.networkClient=this.config.system.networkClient,this.eventHandler=n,this.navigationClient=i,this.platformAuthProvider=c,this.correlationId=a,this.logger=o.clone(it,ii),this.performanceClient=s}}function Di(e,t,r,o){r.verbose("0bd1la",o);const n=e||t||"";return gr.getAbsoluteUrl(n,Yn())}function zi(e,t,r,o,n,i){n.verbose("1p12tq",r);const s={clientId:t,correlationId:r,apiId:e,forceRefresh:!1,wrapperSKU:o.getWrapperMetadata()[0],wrapperVer:o.getWrapperMetadata()[1]};return new Fi(s,o)}async function ji(e,t,r,o,n,i,s,a,c){const h=a&&a.hasOwnProperty("instance_aware")?a.instance_aware:void 0,l={protocolMode:e.system.protocolMode,OIDCOptions:e.auth.OIDCOptions,knownAuthorities:e.auth.knownAuthorities,cloudDiscoveryMetadata:e.auth.cloudDiscoveryMetadata,authorityMetadata:e.auth.authorityMetadata},d=i||e.auth.authority,u=h?.length?"true"===h:e.auth.instanceAware,g=c&&u?e.auth.authority.replace(gr.getDomainFromUrl(d),c.environment):d,p=Qr.generateAuthority(g,s||e.auth.azureCloudOptions),m=await Er(Hi,"authorityFactoryCreateDiscoveredInstance",n,r,t)(p,e.system.networkClient,o,l,n,t,r);if(c&&!m.isAlias(c.environment))throw sr("authority_mismatch");return m}async function Bi(e,t,r,o,n){if(n)try{e.removeAccount(n,o),r.verbose("0s4z6h",o)}catch(e){r.error("0mgg1d",o)}else try{r.verbose("0zj631",o),e.clear(o),await t.clearKeystore(o)}catch(e){r.error("12ih0c",o)}}async function $i(e,t,r,o,n){const i=e.authority||t.auth.authority,s=[...e&&e.scopes||[]],a={...e,correlationId:e.correlationId,authority:i,scopes:s};if(a.authenticationScheme){if(a.authenticationScheme===he.SSH){if(!e.sshJwk)throw sr(ur);if(!e.sshKid)throw sr("missing_ssh_kid")}o.verbose("1ecmns",n)}else a.authenticationScheme=he.BEARER,o.verbose("1l4fwv",n);return a}async function Ji(e,t,r,o,n){const i=await Er($i,me,n,o,e.correlationId)(e,r,o,n,e.correlationId);return{...e,...i,account:t,forceRefresh:e.forceRefresh||!1}}function Wi(e,t){let r;const o=e.httpMethod;if(t===vr){if(o&&o!==x)throw sr("invalid_request_method_for_EAR");r=x}else r=o||"GET";return r}class Vi extends Ki{initializeLogoutRequest(e){this.logger.verbose("0546u4",this.correlationId);const t={correlationId:this.correlationId,...e};if(e)if(e.logoutHint)this.logger.verbose("12k4l4",this.correlationId);else if(e.account){const r=this.getLogoutHintFromIdTokenClaims(e.account);r&&(this.logger.verbose("0st5di",this.correlationId),t.logoutHint=r)}else this.logger.verbose("0pdtc3",this.correlationId);else this.logger.verbose("07ndze",this.correlationId);return e&&null===e.postLogoutRedirectUri?this.logger.verbose("0ljv63",t.correlationId):e&&e.postLogoutRedirectUri?(this.logger.verbose("1vamm6",t.correlationId),t.postLogoutRedirectUri=gr.getAbsoluteUrl(e.postLogoutRedirectUri,Yn())):null===this.config.auth.postLogoutRedirectUri?this.logger.verbose("15m5g7",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("1f4xlz",t.correlationId),t.postLogoutRedirectUri=gr.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,Yn())):(this.logger.verbose("17s5rf",t.correlationId),t.postLogoutRedirectUri=gr.getAbsoluteUrl(Yn(),Yn())),t}getLogoutHintFromIdTokenClaims(e){const t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("0mvp54",this.correlationId)}else this.logger.verbose("1e7bdp",this.correlationId);return null}async createAuthCodeClient(e){const t=await Er(this.getClientConfiguration.bind(this),Ce,this.logger,this.performanceClient,this.correlationId)(e);return new Li(t,this.performanceClient)}async getClientConfiguration(e){const{serverTelemetryManager:t,requestAuthority:r,requestAzureCloudOptions:o,requestExtraQueryParameters:n,account:i}=e,s=e.authority||await Er(ji,ue,this.logger,this.performanceClient,this.correlationId)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,r,o,n,i),a=this.config.system.loggerOptions;return{authOptions:{clientId:this.config.auth.clientId,authority:s,clientCapabilities:this.config.auth.clientCapabilities,redirectUri:this.config.auth.redirectUri},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:a.loggerCallback,piiLoggingEnabled:a.piiLoggingEnabled,logLevel:a.logLevel,correlationId:this.correlationId},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:t,libraryInfo:{sku:it,version:ii,cpu:"",os:""},telemetry:this.config.telemetry}}}async function Gi(e,t,r,o,i,s,a,c){const h=Di(e.redirectUri,r.auth.redirectUri,s,c),l={interactionType:t},d=function(e,t,r){const o=function(e,t){if(!e)throw n(m);const r={id:e.createNewGuid()};t&&(r.meta=t);const o=JSON.stringify(r);return e.base64Encode(o)}(e,r);return t?`${o}|${t}`:o}(o,e&&e.state||"",l),u={...await Er($i,me,s,a,c)({...e,correlationId:c},r,a,s,c),redirectUri:h,state:d,nonce:e.nonce||Bt(),responseMode:r.auth.OIDCOptions.responseMode},g={...u,httpMethod:Wi(u,r.system.protocolMode)};if(e.loginHint||e.sid)return g;const p=e.account||i.getActiveAccount(c);return p&&(s.verbose("1eqlb3",c),s.verbosePii("0tf99t",c),g.account=p),g}function Qi(e,t,r,o){const n=hn(e);if(!n)throw cn(e)?(r.error("13pl0s",o),r.errorPii("1097vx",o),Ne("hash_does_not_contain_known_properties")):(r.error("18h0l1",o),Ne("hash_empty_error"));return n}function Xi(e,t){const r=ln(t);return gr.appendQueryString(e.authorizationEndpoint,r)}function Yi(e,t){if(!e.state||!t)throw e.state?n(h,"Cached State"):n(h,"Server State");let r,o;try{r=decodeURIComponent(e.state)}catch(t){throw n(c,e.state)}try{o=decodeURIComponent(t)}catch(t){throw n(c,e.state)}if(r!==o)throw n("state_mismatch");if(e.error||e.error_description||e.suberror){const t=function(e){const t="code=",r=e.error_uri?.lastIndexOf(t);return r&&r>=0?e.error_uri?.substring(r+5):void 0}(e);if(io(e.error,e.error_description,e.suberror))throw new no(e.error||"",e.error_description,e.suberror,e.timestamp||"",e.trace_id||"",e.correlation_id||"",e.claims||"",t);throw new bi(e.error||"",e.error_description,e.suberror,t)}}class Zi{constructor(e,t,r,o,n){this.authModule=e,this.browserStorage=t,this.authCodeRequest=r,this.logger=o,this.performanceClient=n}async handleCodeResponse(e,t,r){let o;try{o=function(e,t){if(Yi(e,t),!e.code)throw n("authorization_code_missing_from_server_response");return e}(e,t.state)}catch(e){throw e instanceof bi&&e.subError===je?Ne(je):e}return Er(this.handleCodeResponseFromServer.bind(this),Ar,this.logger,this.performanceClient,t.correlationId)(o,t,r)}async handleCodeResponseFromServer(e,t,r,o=!0){if(this.logger.trace("0mf2hb",t.correlationId),this.authCodeRequest.code=e.code,o&&(e.nonce=t.nonce||void 0),e.state=t.state,e.client_info)this.authCodeRequest.clientInfo=e.client_info;else{const e=this.createCcsCredentials(t);e&&(this.authCodeRequest.ccsCredential=e)}return await Er(this.authModule.acquireToken.bind(this.authModule),"authClientAcquireToken",this.logger,this.performanceClient,t.correlationId)(this.authCodeRequest,r,e)}createCcsCredentials(e){return e.account?{credential:e.account.homeAccountId,type:Pi}:e.loginHint?{credential:e.loginHint,type:Oi}:null}}class es extends t{constructor(e,t,r){super(e,t||qe(e)),Object.setPrototypeOf(this,es.prototype),this.name="NativeAuthError",this.ext=r}}function ts(e){if(e.ext&&e.ext.status&&("PERSISTENT_ERROR"===e.ext.status||"DISABLED"===e.ext.status))return!0;if(e.ext&&e.ext.error&&-2147186943===e.ext.error)return!0;switch(e.errorCode){case"ContentError":case"PageException":return!0;default:return!1}}function rs(e,t,r){if(r&&r.status)switch(r.status){case"ACCOUNT_UNAVAILABLE":return so("native_account_unavailable",qe(e));case"USER_INTERACTION_REQUIRED":return new no(e,t);case"USER_CANCEL":return Ne(je);case"NO_NETWORK":return Ne(We);case"UX_NOT_ALLOWED":return so(eo)}return new es(e,t,r)}class os{constructor(e,t){this.config=vi(e),this.logger=new di(this.config.loggerOptions,Io,Co),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}async acquireCachedToken(e){let t="0";if(e.forceRefresh||!ar.isEmptyObj(e.claims))throw this.setCacheOutcome("1",e.correlationId),n(f);if(!e.account)throw n(u);const r=e.account.tenantId||function(e){const t=new gr(e).getUrlComponents(),r=t.PathSegments.slice(-1)[0]?.toLowerCase();switch(r){case D:case z:case j:return;default:return r}}(e.authority),o=this.cacheManager.getTokenKeys(),i=this.cacheManager.getAccessToken(e.account,e,o,r);if(!i)throw this.setCacheOutcome("2",e.correlationId),n(f);if(s=i.cachedAt,Number(s)>Nr()||Fr(i.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw this.setCacheOutcome("3",e.correlationId),n(f);var s;i.refreshOn&&Fr(i.refreshOn,0)&&(t="4");const a=e.authority||this.authority.getPreferredCache(),c={account:this.cacheManager.getAccount(this.cacheManager.generateAccountKey(e.account),e.correlationId),accessToken:i,idToken:this.cacheManager.getIdToken(e.account,e.correlationId,o,r),refreshToken:null,appMetadata:this.cacheManager.readAppMetadataFromCache(a,e.correlationId)};return this.setCacheOutcome(t,e.correlationId),this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),[await Er(this.generateResultFromCacheRecord.bind(this),"silentFlowClientGenerateResultFromCacheRecord",this.logger,this.performanceClient,e.correlationId)(c,e),t]}setCacheOutcome(e,t){this.serverTelemetryManager?.setCacheOutcome(e),this.performanceClient?.addFields({cacheOutcome:e},t),"0"!==e&&this.logger.info("09ingz",t)}async generateResultFromCacheRecord(e,t){let r;if(e.idToken&&(r=Mr(e.idToken.secret,this.config.cryptoInterface.base64Decode)),t.maxAge||0===t.maxAge){const e=r?.auth_time;if(!e)throw n(l);Ur(e,t.maxAge)}return Si.generateAuthenticationResult(this.cryptoUtils,this.authority,e,!0,t,this.performanceClient,r)}}class ns extends Vi{async acquireToken(e){const t=zi(61,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger),r=await Er(this.getClientConfiguration.bind(this),Ce,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:t,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}),o=new os(r,this.performanceClient);this.logger.verbose("0wa871",this.correlationId);try{const t=(await Er(o.acquireCachedToken.bind(o),"silentFlowClientAcquireCachedToken",this.logger,this.performanceClient,e.correlationId)(e))[0];return this.performanceClient.addFields({fromCache:!0},e.correlationId),t}catch(e){throw e instanceof Ue&&e.errorCode===Ge&&this.logger.verbose("06wena",this.correlationId),e}}logout(e){this.logger.verbose("1rkurh",this.correlationId);const t=this.initializeLogoutRequest(e);return Bi(this.browserStorage,this.browserCrypto,this.logger,this.correlationId,t.account)}}class is extends Ki{constructor(e,t,r,o,n,i,s,a,c,h,l,d){super(e,t,r,o,n,i,a,d,c),this.apiId=s,this.accountId=h,this.platformAuthProvider=c,this.nativeStorageManager=l,this.silentCacheClient=new ns(e,this.nativeStorageManager,r,o,n,i,a,d,c);const u=this.platformAuthProvider.getExtensionName();this.skus=Fi.makeExtraSkuString({libraryName:it,libraryVersion:ii,extensionName:u,extensionVersion:this.platformAuthProvider.getExtensionVersion()})}addRequestSKUs(e){e.extraParameters={...e.extraParameters,[yn]:this.skus}}async acquireToken(e,t){this.logger.trace("03qeos",this.correlationId);const r=this.performanceClient.startMeasurement(ge,e.correlationId),o=Nr(),n=zi(this.apiId,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger);try{const i=await this.initializeNativeRequest(e);try{const e=await this.acquireTokensFromCache(this.accountId,i);return r.end({success:!0,isNativeBroker:!1,fromCache:!0}),e}catch(e){if(1===t)throw this.logger.info("0eitbc",this.correlationId),e;this.logger.info("0957j1",this.correlationId)}const s=await this.platformAuthProvider.sendMessage(i);return await this.handleNativeResponse(s,i,o).then(e=>(r.end({success:!0,isNativeBroker:!0,requestId:e.requestId}),n.clearNativeBrokerErrorCode(),e)).catch(e=>{throw r.end({success:!1,errorCode:e.errorCode,subErrorCode:e.subError,isNativeBroker:!0}),e})}catch(e){throw e instanceof es&&n.setNativeBrokerErrorCode(e.errorCode),e}}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:wo.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}async acquireTokensFromCache(e,t){if(!e)throw this.logger.warning("1ndf3e",this.correlationId),n(p);const r=this.browserStorage.getBaseAccountInfo({nativeAccountId:e},t.correlationId);if(!r)throw n(p);try{const e=this.createSilentCacheRequest(t,r),o=await this.silentCacheClient.acquireToken(e),n={...r,idTokenClaims:o?.idTokenClaims,idToken:o?.idToken};return{...o,account:n}}catch(e){throw e}}async acquireTokenRedirect(e,t,r){this.logger.trace("0luikq",this.correlationId);const o=await this.initializeNativeRequest(e),n=r?.navigateToLoginRequestUrl??!0;try{await this.platformAuthProvider.sendMessage(o)}catch(e){if(e instanceof es&&(zi(this.apiId,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger).setNativeBrokerErrorCode(e.errorCode),ts(e)))throw e}this.browserStorage.setTemporaryCache(Ct,JSON.stringify(o),!0);const i={apiId:bt,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},s=n?window.location.href:Di(e.redirectUri,this.config.auth.redirectUri,this.logger,this.correlationId);t.end({success:!0}),await this.navigationClient.navigateExternal(s,i)}async handleRedirectPromise(e,t){if(this.logger.trace("1c5lhw",this.correlationId),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("0le6uv",this.correlationId),null;const r=this.browserStorage.getCachedNativeRequest();if(!r)return this.logger.verbose("0a6zjb",this.correlationId),e&&t&&e?.addFields({errorCode:"no_cached_request"},t),null;const{prompt:o,...n}=r;o&&this.logger.verbose("0ac34v",this.correlationId),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(Ct));const i=Nr();try{this.logger.verbose("003x5a",this.correlationId);const e=await this.platformAuthProvider.sendMessage(n),t=await this.handleNativeResponse(e,n,i);return zi(this.apiId,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger).clearNativeBrokerErrorCode(),t}catch(e){throw e}}logout(){return this.logger.trace("0u2sjm",this.correlationId),Promise.reject("Logout not implemented yet")}async handleNativeResponse(e,t,r){this.logger.trace("1bojln",this.correlationId);const o=Mr(e.id_token,tt),n=this.createHomeAccountIdentifier(e,o),i=this.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t.accountId},this.correlationId)?.homeAccountId;if(t.extraParameters?.child_client_id&&e.account.id!==t.accountId)this.logger.info("1ub1in",this.correlationId);else if(n!==i&&e.account.id!==t.accountId)throw rs("user_switch");const s=await ji(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,t.authority),a=_i(this.browserStorage,s,n,tt,this.correlationId,o,e.client_info,void 0,o.tid,void 0,e.account.id);e.expires_in=Number(e.expires_in);const c=await this.generateAuthenticationResult(e,t,o,a,s.canonicalAuthority,r);return await this.cacheAccount(a,qr(o)),await this.cacheNativeTokens(e,t,n,o,e.access_token,c.tenantId,r),c}createHomeAccountIdentifier(e,t){return mo(e.client_info||"",0,this.logger,this.browserCrypto,this.correlationId,t)}generateScopes(e,t){return t?wo.fromString(t):wo.fromString(e)}async generatePopAccessToken(e,t){if(t.tokenType===he.POP&&t.signPopToken){if(e.shr)return this.logger.trace("0coqhu",this.correlationId),e.shr;const r=new Ti(this.browserCrypto,this.performanceClient),o={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce,correlationId:this.correlationId};if(!t.keyId)throw n(y);return r.signPopToken(e.access_token,t.keyId,o)}return e.access_token}async generateAuthenticationResult(e,t,r,o,n,i){const s=this.addTelemetryFromNativeResponse(e.properties.MATS),a=this.generateScopes(t.scope,e.scope),c=e.account.properties||{},h=c.UID||r.oid||r.sub||"",l=c.TenantId||r.tid||"",d=uo(po(o),void 0,r,e.id_token);d.nativeAccountId!==e.account.id&&(d.nativeAccountId=e.account.id);const u=await this.generatePopAccessToken(e,t),g=t.tokenType===he.POP?he.POP:he.BEARER;return{authority:n,uniqueId:h,tenantId:l,scopes:a.asArray(),account:d,idToken:e.id_token,idTokenClaims:r,accessToken:u,fromCache:!!s&&this.isResponseFromCache(s),expiresOn:Lr(i+e.expires_in),tokenType:g,correlationId:this.correlationId,state:e.state,fromPlatformBroker:!0}}async cacheAccount(e,t){await this.browserStorage.setAccount(e,this.correlationId,t,this.apiId),this.browserStorage.removeAccountContext(po(e),this.correlationId)}cacheNativeTokens(e,t,r,o,n,i,s){const a=Dr(r,t.authority,e.id_token||"",t.clientId,o.tid||""),c=s+(t.tokenType===he.POP?240:("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0),h=this.generateScopes(e.scope,t.scope),l={idToken:a,accessToken:zr(r,t.authority,n,t.clientId,o.tid||i,h.printScopes(),c,0,tt,void 0,t.tokenType,void 0,t.keyId)};return this.nativeStorageManager.saveCacheRecord(l,this.correlationId,qr(o),this.apiId,t.storeInCache)}getExpiresInValue(e,t){return e===he.POP?240:("string"==typeof t?parseInt(t,10):t)||0}addTelemetryFromNativeResponse(e){const t=this.getMATSFromResponse(e);return t?(this.performanceClient.addFields({extensionId:this.platformAuthProvider.getExtensionId(),extensionVersion:this.platformAuthProvider.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}getMATSFromResponse(e){if(e)try{return JSON.parse(e)}catch(e){this.logger.error("0b3l57",this.correlationId)}return null}isResponseFromCache(e){return void 0===e.is_cached?(this.logger.verbose("1okqev",this.correlationId),!1):!!e.is_cached}async initializeNativeRequest(e){this.logger.trace("04j6wj",this.correlationId);const t=await this.getCanonicalAuthority(e),{scopes:r,...o}=e,n=new wo(r||[]);n.appendScopes(M);const i={...o,accountId:this.accountId,clientId:this.config.auth.clientId,authority:t.urlString,scope:n.printScopes(),redirectUri:Di(e.redirectUri,this.config.auth.redirectUri,this.logger,this.correlationId),prompt:this.getPrompt(e.prompt),correlationId:this.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:{...e.extraParameters},extendedExpiryToken:!1,keyId:e.popKid};if(i.signPopToken&&e.popKid)throw Ne("invalid_pop_token_request");if(this.handleExtraBrokerParams(i),i.extraParameters=i.extraParameters||{},i.extraParameters.telemetry="MATS",e.authenticationScheme===he.POP){const t={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce,correlationId:this.correlationId},r=new Ti(this.browserCrypto,this.performanceClient);let o;if(i.keyId)o=this.browserCrypto.base64UrlEncode(JSON.stringify({kid:i.keyId})),i.signPopToken=!1;else{const e=await Er(r.generateCnf.bind(r),Sr,this.logger,this.performanceClient,this.correlationId)(t,this.logger);o=e.reqCnfString,i.keyId=e.kid,i.signPopToken=!0}i.reqCnf=o}return this.addRequestSKUs(i),i}async getCanonicalAuthority(e){const t=e.authority||this.config.auth.authority,{azureCloudOptions:r,account:o}=e;o&&await ji(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,t,r,void 0,o);const n=new gr(t);return n.validateAsUri(),n}getPrompt(e){switch(this.apiId){case 863:case 61:return this.logger.trace("1hiwaz",this.correlationId),V}if(e)switch(e){case V:case W:case J:return this.logger.trace("1ynje4",this.correlationId),e;default:throw this.logger.trace("0nkr6q",this.correlationId),Ne("native_prompt_not_supported")}else this.logger.trace("1qlu04",this.correlationId)}handleExtraBrokerParams(e){const t=e.extraParameters&&e.extraParameters.hasOwnProperty(wn)&&e.extraParameters.hasOwnProperty(In)&&e.extraParameters.hasOwnProperty(un);if(!e.embeddedClientId&&!t)return;let r="";const o=e.redirectUri;e.embeddedClientId?(e.redirectUri=this.config.auth.redirectUri,r=e.embeddedClientId):e.extraParameters&&(e.redirectUri=e.extraParameters[In],r=e.extraParameters[un]),e.extraParameters={child_client_id:r,child_redirect_uri:o},this.performanceClient?.addFields({embeddedClientId:r,embeddedRedirectUri:o},e.correlationId)}}async function ss(e,t,r,o,n){const i=function(e,t,r,o){const n=t.correlationId,i=new Map;if(Tn(i,t.embeddedClientId||t.extraQueryParameters?.[un]||e.clientId),bn(i,[...t.scopes||[],...t.extraScopesToConsent||[]],!0,e.authority.options.OIDCOptions?.defaultScopes),An(i,t.redirectUri),En(i,n),function(e,t){e.set("response_mode",t||Q)}(i,t.responseMode),Kn(i),t.prompt&&(function(e,t){e.set("prompt",t)}(i,t.prompt),o?.addFields({prompt:t.prompt},n)),t.domainHint&&(function(e,t){e.set("domain_hint",t)}(i,t.domainHint),o?.addFields({domainHintFromRequest:!0},n)),"select_account"!==t.prompt)if(t.sid&&t.prompt===V)r.verbose("1tvqyx",t.correlationId),On(i,t.sid),o?.addFields({sidFromRequest:!0},n);else if(t.account){const e=(s=t.account,s.idTokenClaims?.sid||null);let a=function(e){return e.loginHint||e.idTokenClaims?.login_hint||null}(t.account);if(a&&t.domainHint&&(r.warning("0wkg3v",t.correlationId),a=null),a){r.verbose("1eyfsw",t.correlationId),Sn(i,a),o?.addFields({loginHintFromClaim:!0},n);try{Pn(i,co(t.account.homeAccountId))}catch(e){r.verbose("12ugck",t.correlationId)}}else if(e&&t.prompt===V){r.verbose("1rmd8s",t.correlationId),On(i,e),o?.addFields({sidFromClaim:!0},n);try{Pn(i,co(t.account.homeAccountId))}catch(e){r.verbose("12ugck",t.correlationId)}}else if(t.loginHint)r.verbose("0y3007",t.correlationId),Sn(i,t.loginHint),_n(i,t.loginHint),o?.addFields({loginHintFromRequest:!0},n);else if(t.account.username){r.verbose("02f507",t.correlationId),Sn(i,t.account.username),o?.addFields({loginHintFromUpn:!0},n);try{Pn(i,co(t.account.homeAccountId))}catch(e){r.verbose("12ugck",t.correlationId)}}}else t.loginHint&&(r.verbose("0g01ey",t.correlationId),Sn(i,t.loginHint),_n(i,t.loginHint),o?.addFields({loginHintFromRequest:!0},n));else r.verbose("169k9v",t.correlationId);var s;return t.nonce&&function(e,t){e.set("nonce",t)}(i,t.nonce),t.state&&qn(i,t.state),(t.claims||e.clientCapabilities&&e.clientCapabilities.length>0)&&Rn(i,t.claims,e.clientCapabilities),t.embeddedClientId&&Wn(i,e.clientId,e.redirectUri),!e.instanceAware||t.extraQueryParameters&&Object.keys(t.extraQueryParameters).includes(Cn)||Dn(i),i}({...e.auth,authority:t},r,o,n);if(xn(i,{sku:it,version:ii,os:"",cpu:""}),e.system.protocolMode!==Cr&&Mn(i,e.telemetry.application),r.platformBroker&&(function(e){e.set("nativebroker","1")}(i),r.authenticationScheme===he.POP)){const e=new rr(o,n),t=new Ti(e,n);let s;s=r.popKid?e.encodeKid(r.popKid):(await Er(t.generateCnf.bind(t),Sr,o,n,r.correlationId)(r,o)).reqCnfString,jn(i,s)}return vn(i,r.correlationId,n),i}async function as(e,t,r,o,n){if(!r.codeChallenge)throw sr(lr);const i=await Er(ss,"getStandardParams",o,n,r.correlationId)(e,t,r,o,n);return kn(i,G),Un(i,r.codeChallenge,P),zn(i,{...r.extraQueryParameters,...r.extraParameters}),Xi(t,i)}async function cs(e,t,r,o,n,i){if(!o.earJwk)throw Ne(Le);const s=await ss(t,r,o,n,i);kn(s,"id_token token refresh_token"),function(e,t){e.set("ear_jwk",encodeURIComponent(t)),e.set("ear_jwe_crypto","eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIn0")}(s,o.earJwk),Un(s,o.codeChallenge,P),zn(s,{...o.extraParameters});const a=new Map;return zn(a,o.extraQueryParameters||{}),ls(e,Xi(r,a),s)}async function hs(e,t,r,o,n,i){const s=await ss(t,r,o,n,i);kn(s,G),Un(s,o.codeChallenge,o.codeChallengeMethod||P),zn(s,{...o.extraParameters});const a=new Map;return zn(a,o.extraQueryParameters||{}),ls(e,Xi(r,a),s)}function ls(e,t,r){const o=e.createElement("form");return o.method="post",o.action=t,r.forEach((t,r)=>{const n=e.createElement("input");n.hidden=!0,n.name=r,n.value=t,o.appendChild(n)}),e.body.appendChild(o),o}async function ds(e,t,r,o,n,i,s,a,c,h){if(a.verbose("11qcow",e.correlationId),!h)throw Ne(Xe);const l=new rr(a,c),d=new is(o,n,l,a,s,o.system.navigationClient,r,c,h,t,i,e.correlationId),{userRequestState:u}=sn(l.base64Decode,e.state);return Er(d.acquireToken.bind(d),ge,a,c,e.correlationId)({...e,state:u,prompt:void 0})}async function us(e,t,r,o,n,i,s,a,c,h,l,d){if(Ei.removeThrottle(s,n.auth.clientId,e),t.accountId)return Er(ds,be,h,l,e.correlationId)(e,t.accountId,o,n,s,a,c,h,l,d);const u={...e,code:t.code||"",codeVerifier:r},g=new Zi(i,s,u,h,l);return await Er(g.handleCodeResponse.bind(g),"handleCodeResponse",h,l,e.correlationId)(t,e,o)}async function gs(e,t,r,o,n,i,s,a,c,h,l){if(Ei.removeThrottle(i,o.auth.clientId,e),Yi(t,e.state),!t.ear_jwe)throw Ne("ear_jwe_empty");if(!e.earJwk)throw Ne(Le);const d=JSON.parse(await Er(Wt,"decryptEarResponse",c,h,e.correlationId)(e.earJwk,t.ear_jwe));if(d.accountId)return Er(ds,be,c,h,e.correlationId)(e,d.accountId,r,o,i,s,a,c,h,l);const u=new Si(o.auth.clientId,i,new rr(c,h),c,h,null,null);u.validateTokenResponse(d,e.correlationId);const g={code:"",state:e.state,nonce:e.nonce,client_info:d.client_info,cloud_graph_host_name:d.cloud_graph_host_name,cloud_instance_host_name:d.cloud_instance_host_name,cloud_instance_name:d.cloud_instance_name,msgraph_host:d.msgraph_host};return await Er(u.handleServerTokenResponse.bind(u),_r,c,h,e.correlationId)(d,n,Nr(),e,r,g,void 0,void 0,void 0,void 0)}async function ps(e,t,r){const o=Rr(ms,"generateCodeVerifier",t,e,r)(e,t,r);return{verifier:o,challenge:await Er(fs,"generateCodeChallengeFromVerifier",t,e,r)(o,e,t,r)}}function ms(e,t,r){try{const o=new Uint8Array(32);return Rr(zt,"getRandomValues",t,e,r)(o),Ee(o)}catch(e){throw Ne(He)}}async function fs(e,t,r,o){try{const n=await Er(Dt,"sha256Digest",r,t,o)(e);return Ee(new Uint8Array(n))}catch(e){throw Ne(He)}}const ys={sendGetRequestAsync:()=>Promise.reject(n(w)),sendPostRequestAsync:()=>Promise.reject(n(w))};class ws{navigateInternal(e,t){return ws.defaultNavigateWindow(e,t)}navigateExternal(e,t){return ws.defaultNavigateWindow(e,t)}static defaultNavigateWindow(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise((e,r)=>{setTimeout(()=>{r(Ne(et,"failed_to_redirect"))},t.timeout)})}}class Is{async sendGetRequestAsync(e,t){let r,o={},n=0;const i=Cs(t);try{r=await fetch(e,{method:"GET",headers:i})}catch(e){throw Mi(Ne(window.navigator.onLine?"get_request_failed":We),void 0,void 0,e)}o=vs(r.headers);try{return n=r.status,{headers:o,body:await r.json(),status:n}}catch(e){throw Mi(Ne(Ve),n,o,e)}}async sendPostRequestAsync(e,t){const r=t&&t.body||"",o=Cs(t);let n,i=0,s={};try{n=await fetch(e,{method:"POST",headers:o,body:r})}catch(e){throw Mi(Ne(window.navigator.onLine?"post_request_failed":We),void 0,void 0,e)}s=vs(n.headers);try{return i=n.status,{headers:s,body:await n.json(),status:i}}catch(e){throw Mi(Ne(Ve),i,s,e)}}}function Cs(e){try{const t=new Headers;if(!e||!e.headers)return t;const r=e.headers;return Object.entries(r).forEach(([e,r])=>{t.append(e,r)}),t}catch(e){throw Mi(Ne("failed_to_build_headers"),void 0,void 0,e)}}function vs(e){try{const t={};return e.forEach((e,r)=>{t[r]=e}),t}catch(e){throw Ne("failed_to_parse_headers")}}const ks="unexpected_error";class bs{constructor(e,t,r,o){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=o,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=r,this.handshakeEvent=r.startMeasurement("nativeMessageHandlerHandshake"),this.platformAuthType="PlatformAuthExtensionHandler"}async sendMessage(e){this.logger.trace("0on4p2",e.correlationId);const t={method:"GetToken",request:e},r={channel:st,extensionId:this.extensionId,responseId:Bt(),body:t};this.logger.trace("1qadfi",e.correlationId),this.logger.tracePii("1xm533",e.correlationId),this.messageChannel.port1.postMessage(r);const o=await new Promise((e,t)=>{this.resolvers.set(r.responseId,{resolve:e,reject:t})});return this.validatePlatformBrokerResponse(o)}static async createProvider(e,t,r,o){e.trace("15zfnw",o);try{const n=new bs(e,t,r,at);return await n.sendHandshakeRequest(o),n}catch(n){const i=new bs(e,t,r);return await i.sendHandshakeRequest(o),i}}async sendHandshakeRequest(e){this.logger.trace("1dpg9o",e),window.addEventListener("message",this.windowListener,!1);const t={channel:st,extensionId:this.extensionId,responseId:Bt(),body:{method:ht}};return this.handshakeEvent.add({extensionId:this.extensionId,extensionHandshakeTimeoutMs:this.handshakeTimeoutMs}),this.messageChannel.port1.onmessage=e=>{this.onChannelMessage(e)},window.postMessage(t,window.origin,[this.messageChannel.port2]),new Promise((e,r)=>{this.handshakeResolvers.set(t.responseId,{resolve:e,reject:r}),this.timeoutId=window.setTimeout(()=>{window.removeEventListener("message",this.windowListener,!1),this.messageChannel.port1.close(),this.messageChannel.port2.close(),this.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),r(Ne("native_handshake_timeout")),this.handshakeResolvers.delete(t.responseId)},this.handshakeTimeoutMs)})}onWindowMessage(e){const t=ni();if(this.logger.trace("0jpn5u",t),e.source!==window)return;const r=e.data;if(r.channel&&r.channel===st&&(!r.extensionId||r.extensionId===this.extensionId)&&r.body.method===ht){const e=this.handshakeResolvers.get(r.responseId);if(!e)return void this.logger.trace("07buhm",t);this.logger.verbose(r.extensionId?"0xrkug":"No extension installed",t),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),e.reject(Ne("native_extension_not_installed"))}}onChannelMessage(e){const t=ni();this.logger.trace("1py8yf",t);const o=e.data,n=this.resolvers.get(o.responseId),i=this.handshakeResolvers.get(o.responseId);try{const e=o.body.method;if("Response"===e){if(!n)return;const e=o.body.response;if(this.logger.trace("19hpgm",t),this.logger.tracePii("179a24",t),"Success"!==e.status)n.reject(rs(e.code,e.description,e.ext));else{if(!e.result)throw r(ks,"Event does not contain result.");e.result.code&&e.result.description?n.reject(rs(e.result.code,e.result.description,e.result.ext)):n.resolve(e.result)}this.resolvers.delete(o.responseId)}else if("HandshakeResponse"===e){if(!i)return void this.logger.trace("082qnt",t);clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=o.extensionId,this.extensionVersion=o.body.version,this.logger.verbose("0yf5ib",t),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),i.resolve(),this.handshakeResolvers.delete(o.responseId)}}catch(e){this.logger.error("0xf978",t),this.logger.errorPii("04i99o",t),this.logger.errorPii("0xdvsy",t),n?n.reject(e):i&&i.reject(e)}}validatePlatformBrokerResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw r(ks,"Response missing expected properties.")}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}getExtensionName(){return this.getExtensionId()===at?"chrome":this.getExtensionId()?.length?"unknown":void 0}}class Ts{constructor(e,t,r){this.logger=e,this.performanceClient=t,this.correlationId=r,this.platformAuthType="PlatformAuthDOMHandler"}static async createProvider(e,t,r){if(e.trace("12mj4a",r),window.navigator?.platformAuthentication){const o=await window.navigator.platformAuthentication.getSupportedContracts(ct);if(o?.includes("get-token-and-sign-out"))return e.trace("1h5q1r",r),new Ts(e,t,r)}}getExtensionId(){return ct}getExtensionVersion(){return""}getExtensionName(){return"DOM API"}async sendMessage(e){this.logger.trace("02bcil",e.correlationId);try{const t=this.initializePlatformDOMRequest(e),r=await window.navigator.platformAuthentication.executeGetToken(t);return this.validatePlatformBrokerResponse(r,e.correlationId)}catch(t){throw this.logger.error("11im7g",e.correlationId),t}}initializePlatformDOMRequest(e){this.logger.trace("15d6yv",e.correlationId);const{accountId:t,clientId:r,authority:o,scope:n,redirectUri:i,correlationId:s,state:a,storeInCache:c,embeddedClientId:h,extraParameters:l,...d}=e,u=this.getDOMExtraParams(d);return{accountId:t,brokerId:this.getExtensionId(),authority:o,clientId:r,correlationId:s||this.correlationId,extraParameters:{...l,...u},isSecurityTokenService:!1,redirectUri:i,scope:n,state:a,storeInCache:c,embeddedClientId:h}}validatePlatformBrokerResponse(e,t){if(e.hasOwnProperty("isSuccess")){if(e.hasOwnProperty("accessToken")&&e.hasOwnProperty("idToken")&&e.hasOwnProperty("clientInfo")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scopes")&&e.hasOwnProperty("expiresIn"))return this.logger.trace("0h4vei",t),this.convertToPlatformBrokerResponse(e,t);if(e.hasOwnProperty("error")){const r=e;if(!1===r.isSuccess&&r.error&&r.error.code)throw this.logger.trace("0g92vm",t),rs(r.error.code,r.error.description,{error:parseInt(r.error.errorCode),protocol_error:r.error.protocolError,status:r.error.status,properties:r.error.properties})}}throw r(ks,"Response missing expected properties.")}convertToPlatformBrokerResponse(e,t){return this.logger.trace("14913t",t),{access_token:e.accessToken,id_token:e.idToken,client_info:e.clientInfo,account:e.account,expires_in:e.expiresIn,scope:e.scopes,state:e.state||"",properties:e.properties||{},extendedLifetimeToken:e.extendedLifetimeToken??!1,shr:e.proofOfPossessionPayload}}getDOMExtraParams(e){return{...Object.entries(e).reduce((e,[t,r])=>(e[t]=String(r),e),{})}}}function As(e,t,r,o,n){if(t.trace("0uko3r",r),!e.system.allowPlatformBroker)return t.trace("04hozs",r),!1;if(!o)return t.trace("0kvv1r",r),!1;if(n)switch(n){case he.BEARER:case he.POP:return t.trace("18tev1",r),!0;default:return t.trace("1dd2nh",r),!1}return!0}class Ss extends Vi{constructor(e,t,r,o,n,i,s,a,c,h){super(e,t,r,o,n,i,s,c,h),this.nativeStorage=a,this.eventHandler=n}acquireToken(e,t){let r;try{if(r={popupName:this.generatePopupName(e.scopes||M,e.authority||this.config.auth.authority),popupWindowAttributes:e.popupWindowAttributes||{},popupWindowParent:e.popupWindowParent??window},this.performanceClient.addFields({isAsyncPopup:!this.config.system.navigatePopups},this.correlationId),this.config.system.navigatePopups){const o={...e,httpMethod:Wi(e,this.config.system.protocolMode)};return this.logger.verbose("1f9ok3",this.correlationId),r.popup=this.openSizedPopup("about:blank",r),this.acquireTokenPopupAsync(o,r,t)}return this.logger.verbose("162h4u",this.correlationId),this.acquireTokenPopupAsync(e,r,t)}catch(e){return Promise.reject(e)}}logout(e){try{this.logger.verbose("068rup",this.correlationId);const t=this.initializeLogoutRequest(e),r={popupName:this.generateLogoutPopupName(t),popupWindowAttributes:e?.popupWindowAttributes||{},popupWindowParent:e?.popupWindowParent??window},o=e&&e.authority,n=e&&e.mainWindowRedirectUri;return this.config.system.navigatePopups?(this.logger.verbose("1a28da",this.correlationId),r.popup=this.openSizedPopup("about:blank",r),this.logoutPopupAsync(t,r,o,n)):(this.logger.verbose("1phd8u",this.correlationId),this.logoutPopupAsync(t,r,o,n))}catch(e){return Promise.reject(e)}}async acquireTokenPopupAsync(e,t,r){this.logger.verbose("1g77pg",this.correlationId);const o=await Er(Gi,ve,this.logger,this.performanceClient,this.correlationId)(e,St.Popup,this.config,this.browserCrypto,this.browserStorage,this.logger,this.performanceClient,this.correlationId);t.popup&&oi(o.authority);const n=As(this.config,this.logger,this.correlationId,this.platformAuthProvider,e.authenticationScheme);return o.platformBroker=n,this.config.system.protocolMode===vr?this.executeEarFlow(o,t,r):this.executeCodeFlow(o,t,r)}async executeCodeFlow(e,r,o){const n=e.correlationId,i=zi(Tt,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger),s=o||await Er(ps,Se,this.logger,this.performanceClient,n)(this.performanceClient,this.logger,n),a={...e,codeChallenge:s.challenge};try{const t=await Er(this.createAuthCodeClient.bind(this),Ie,this.logger,this.performanceClient,n)({serverTelemetryManager:i,requestAuthority:a.authority,requestAzureCloudOptions:a.azureCloudOptions,requestExtraQueryParameters:a.extraQueryParameters,account:a.account});if(a.httpMethod===x)return await this.executeCodeFlowWithPost(a,r,t,s.verifier);{const o=await Er(as,Tr,this.logger,this.performanceClient,n)(this.config,t.authority,a,this.logger,this.performanceClient),i=this.initiateAuthRequest(o,r);this.eventHandler.emitEvent(en,St.Popup,{popupWindow:i},null);const c=await Xn(this.config.system.popupBridgeTimeout,this.logger,this.browserCrypto,e),h=Rr(Qi,Ae,this.logger,this.performanceClient,this.correlationId)(c,this.config.auth.OIDCOptions.responseMode,this.logger,this.correlationId);return await Er(us,Te,this.logger,this.performanceClient,n)(e,h,s.verifier,Tt,this.config,t,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}}catch(e){throw r.popup?.close(),e instanceof t&&(e.setCorrelationId(this.correlationId),i.cacheFailedRequest(e)),e}}async executeEarFlow(e,t,r){const{correlationId:o,authority:n,azureCloudOptions:i,extraQueryParameters:s,account:a}=e,c=await Er(ji,ue,this.logger,this.performanceClient,o)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,n,i,s,a),h=await Er(Jt,Oe,this.logger,this.performanceClient,o)(),l=r||await Er(ps,Se,this.logger,this.performanceClient,o)(this.performanceClient,this.logger,o),d={...e,earJwk:h,codeChallenge:l.challenge},u=t.popup||this.openPopup("about:blank",t);(await cs(u.document,this.config,c,d,this.logger,this.performanceClient)).submit();const g=await Er(Xn,we,this.logger,this.performanceClient,o)(this.config.system.popupBridgeTimeout,this.logger,this.browserCrypto,d),p=Rr(Qi,Ae,this.logger,this.performanceClient,this.correlationId)(g,this.config.auth.OIDCOptions.responseMode,this.logger,this.correlationId);if(!p.ear_jwe&&p.code){const t=await Er(this.createAuthCodeClient.bind(this),Ie,this.logger,this.performanceClient,o)({serverTelemetryManager:zi(Tt,this.config.auth.clientId,o,this.browserStorage,this.logger),requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account,authority:c});return Er(us,Te,this.logger,this.performanceClient,o)(d,p,l.verifier,Tt,this.config,t,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}return Er(gs,ke,this.logger,this.performanceClient,o)(d,p,Tt,this.config,c,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async executeCodeFlowWithPost(e,t,r,o){const n=e.correlationId,i=await Er(ji,ue,this.logger,this.performanceClient,n)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger),s=t.popup||this.openPopup("about:blank",t);(await hs(s.document,this.config,i,e,this.logger,this.performanceClient)).submit();const a=await Er(Xn,we,this.logger,this.performanceClient,n)(this.config.system.popupBridgeTimeout,this.logger,this.browserCrypto,e),c=Rr(Qi,Ae,this.logger,this.performanceClient,this.correlationId)(a,this.config.auth.OIDCOptions.responseMode,this.logger,this.correlationId);return Er(us,Te,this.logger,this.performanceClient,n)(e,c,o,Tt,this.config,r,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async logoutPopupAsync(e,r,o,n){this.logger.verbose("0b7yrk",this.correlationId),this.eventHandler.emitEvent(tn,St.Popup,e);const i=zi(962,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger);try{await Bi(this.browserStorage,this.browserCrypto,this.logger,this.correlationId,e.account);const t=await Er(this.createAuthCodeClient.bind(this),Ie,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:i,requestAuthority:o,account:e.account||void 0});try{t.authority.endSessionEndpoint}catch{if(e.account?.homeAccountId&&e.postLogoutRedirectUri&&t.authority.protocolMode===Cr){if(this.eventHandler.emitEvent(rn,St.Popup,e),n){const e={apiId:962,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},t=gr.getAbsoluteUrl(n,Yn());await this.navigationClient.navigateInternal(t,e)}return void r.popup?.close()}}const s=t.getLogoutUri(e);this.eventHandler.emitEvent(rn,St.Popup,e);const a=this.openPopup(s,r);if(this.eventHandler.emitEvent(en,St.Popup,{popupWindow:a},null),await Xn(this.config.system.popupBridgeTimeout,this.logger,this.browserCrypto,e).catch(()=>{}),n){const e={apiId:962,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},t=gr.getAbsoluteUrl(n,Yn());this.logger.verbose("0qcur2",this.correlationId),this.logger.verbosePii("0oj7lk",this.correlationId),await this.navigationClient.navigateInternal(t,e)}else this.logger.verbose("03zgcf",this.correlationId)}catch(e){throw r.popup?.close(),e instanceof t&&(e.setCorrelationId(this.correlationId),i.cacheFailedRequest(e)),this.eventHandler.emitEvent(on,St.Popup,null,e),this.eventHandler.emitEvent(nn,St.Popup),e}this.eventHandler.emitEvent(nn,St.Popup)}initiateAuthRequest(e,t){if(e)return this.logger.infoPii("1kcr9k",this.correlationId),this.openPopup(e,t);throw this.logger.error("1l7hyp",this.correlationId),Ne(Ke)}openPopup(e,t){try{let r;if(t.popup?(r=t.popup,this.logger.verbosePii("0cgeo7",this.correlationId),r.location.assign(e)):void 0===t.popup&&(this.logger.verbosePii("0c2awd",this.correlationId),r=this.openSizedPopup(e,t)),!r)throw Ne("empty_window_error");return r.focus&&r.focus(),this.currentWindow=r,r}catch(e){throw this.logger.error("0dxfb9",this.correlationId),Ne("popup_window_error")}}openSizedPopup(e,{popupName:t,popupWindowAttributes:r,popupWindowParent:o}){const n=o.screenLeft?o.screenLeft:o.screenX,i=o.screenTop?o.screenTop:o.screenY,s=o.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,a=o.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;let c=r.popupSize?.width,h=r.popupSize?.height,l=r.popupPosition?.top,d=r.popupPosition?.left;return(!c||c<0||c>s)&&(this.logger.verbose("08vfmo",this.correlationId),c=483),(!h||h<0||h>a)&&(this.logger.verbose("09cxa0",this.correlationId),h=600),(!l||l<0||l>a)&&(this.logger.verbose("1qh4wo",this.correlationId),l=Math.max(0,a/2-300+i)),(!d||d<0||d>s)&&(this.logger.verbose("1sz3en",this.correlationId),d=Math.max(0,s/2-241.5+n)),o.open(e,t,`width=${c}, height=${h}, top=${l}, left=${d}, scrollbars=yes`)}generatePopupName(e,t){return`${nt}.${this.config.auth.clientId}.${e.join("-")}.${t}.${this.correlationId}`}generateLogoutPopupName(e){const t=e.account&&e.account.homeAccountId;return`${nt}.${this.config.auth.clientId}.${t}.${this.correlationId}`}}class _s extends Vi{constructor(e,t,r,o,n,i,s,a,c,h){super(e,t,r,o,n,i,s,c,h),this.nativeStorage=a}async acquireToken(e){const r=await Er(Gi,ve,this.logger,this.performanceClient,this.correlationId)(e,St.Redirect,this.config,this.browserCrypto,this.browserStorage,this.logger,this.performanceClient,this.correlationId);r.platformBroker=As(this.config,this.logger,this.correlationId,this.platformAuthProvider,e.authenticationScheme);const o=e=>{e.persisted&&(this.logger.verbose("0udvtt",this.correlationId),this.browserStorage.resetRequestCache(this.correlationId),this.eventHandler.emitEvent("msal:restoreFromBFCache",St.Redirect))},n=this.getRedirectStartPage(e.redirectStartPage);this.logger.verbosePii("0zao0a",this.correlationId),this.browserStorage.setTemporaryCache(mt,n,!0),window.addEventListener("pageshow",o);try{this.config.system.protocolMode===vr?await this.executeEarFlow(r):await this.executeCodeFlow(r)}catch(e){throw e instanceof t&&e.setCorrelationId(this.correlationId),window.removeEventListener("pageshow",o),e}}async executeCodeFlow(e){const r=e.correlationId,o=zi(bt,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger),n=await Er(ps,Se,this.logger,this.performanceClient,r)(this.performanceClient,this.logger,r),i={...e,codeChallenge:n.challenge};this.browserStorage.cacheAuthorizeRequest(i,this.correlationId,n.verifier);try{if(i.httpMethod===x)return await this.executeCodeFlowWithPost(i);{const t=await Er(this.createAuthCodeClient.bind(this),Ie,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:o,requestAuthority:i.authority,requestAzureCloudOptions:i.azureCloudOptions,requestExtraQueryParameters:i.extraQueryParameters,account:i.account}),r=await Er(as,Tr,this.logger,this.performanceClient,e.correlationId)(this.config,t.authority,i,this.logger,this.performanceClient);return await this.initiateAuthRequest(r)}}catch(e){throw e instanceof t&&(e.setCorrelationId(this.correlationId),o.cacheFailedRequest(e)),e}}async executeEarFlow(e){const{correlationId:t,authority:r,azureCloudOptions:o,extraQueryParameters:n,account:i}=e,s=await Er(ji,ue,this.logger,this.performanceClient,t)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,r,o,n,i),a=await Er(Jt,Oe,this.logger,this.performanceClient,t)(),c=await Er(ps,Se,this.logger,this.performanceClient,t)(this.performanceClient,this.logger,t),h={...e,earJwk:a,codeChallenge:c.challenge};return this.browserStorage.cacheAuthorizeRequest(h,this.correlationId,c.verifier),(await cs(document,this.config,s,h,this.logger,this.performanceClient)).submit(),new Promise((e,t)=>{setTimeout(()=>{t(Ne(et,"failed_to_redirect"))},this.config.system.redirectNavigationTimeout)})}async executeCodeFlowWithPost(e){const t=e.correlationId,r=await Er(ji,ue,this.logger,this.performanceClient,t)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger);return this.browserStorage.cacheAuthorizeRequest(e,this.correlationId),(await hs(document,this.config,r,e,this.logger,this.performanceClient)).submit(),new Promise((e,t)=>{setTimeout(()=>{t(Ne(et,"failed_to_redirect"))},this.config.system.redirectNavigationTimeout)})}async handleRedirectPromise(e,r,o,n){const i=zi(865,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger),s=n?.navigateToLoginRequestUrl??!0;try{const[t,a]=this.getRedirectResponse(n?.hash||"");if(!t)return this.logger.info("1qmv0q",this.correlationId),this.browserStorage.resetRequestCache(this.correlationId),"back_forward"!==function(){if("undefined"==typeof window||void 0===window.performance||"function"!=typeof window.performance.getEntriesByType)return;const e=window.performance.getEntriesByType("navigation"),t=e.length?e[0]:void 0;return t?.type}()?o.event.errorCode="no_server_response":this.logger.verbose("1eqegq",this.correlationId),null;const c=this.browserStorage.getTemporaryCache(mt,this.correlationId,!0)||"";if(dn(c)===dn(window.location.href)&&s)return this.logger.verbose("11yred",this.correlationId),c.indexOf("#")>-1&&function(e){const t=e.split("#");t.shift(),window.location.hash=t.length>0?t.join("#"):""}(c),await this.handleResponse(t,e,r,i);if(!s)return this.logger.verbose("0v4sdv",this.correlationId),await this.handleResponse(t,e,r,i);if(!Gn()||this.config.system.allowRedirectInIframe){this.browserStorage.setTemporaryCache(ft,a,!0);const o={apiId:865,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0};let n=!0;if(c&&"null"!==c)this.logger.verbose("08jpy1",this.correlationId),n=await this.navigationClient.navigateInternal(c,o);else{const e=function(){const e=new gr(window.location.href).getUrlComponents();return`${e.Protocol}//${e.HostNameAndPort}/`}();this.browserStorage.setTemporaryCache(mt,e,!0),this.logger.warning("1dutq1",this.correlationId),n=await this.navigationClient.navigateInternal(e,o)}if(!n)return await this.handleResponse(t,e,r,i)}return null}catch(e){throw e instanceof t&&(e.setCorrelationId(this.correlationId),i.cacheFailedRequest(e)),e}}getRedirectResponse(e){this.logger.verbose("1c5i8m",this.correlationId);let r=e;r||(r=this.config.auth.OIDCOptions.responseMode===Q?window.location.search:window.location.hash);let o=hn(r);if(o){try{!function(e,t,r){if(!e.state)throw Ne(De);const o=function(e,t){if(!t)return null;try{return sn(e.base64Decode,t).libraryState.meta}catch(e){throw n(c)}}(t,e.state);if(!o)throw Ne(ze);if(o.interactionType!==r)throw Ne("state_interaction_type_mismatch")}(o,this.browserCrypto,St.Redirect)}catch(e){return e instanceof t&&this.logger.error("0bkq6p",this.correlationId),[null,""]}return Vn(window),this.logger.verbose("00uvho",this.correlationId),[o,r]}const i=this.browserStorage.getTemporaryCache(ft,this.correlationId,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey(ft)),i&&(o=hn(i),o)?(this.logger.verbose("001671",this.correlationId),[o,i]):[null,""]}async handleResponse(e,t,r,o){if(!e.state)throw Ne(De);const{authority:n,azureCloudOptions:i,extraQueryParameters:s,account:a}=t;if(e.ear_jwe){const r=await Er(ji,ue,this.logger,this.performanceClient,t.correlationId)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,n,i,s,a);return Er(gs,ke,this.logger,this.performanceClient,t.correlationId)(t,e,bt,this.config,r,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}const c=await Er(this.createAuthCodeClient.bind(this),Ie,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:o,requestAuthority:t.authority});return Er(us,Te,this.logger,this.performanceClient,t.correlationId)(t,e,r,bt,this.config,c,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async initiateAuthRequest(e){if(this.logger.verbose("0yaw2e",this.correlationId),e){this.logger.infoPii("1luf83",this.correlationId);const t={apiId:bt,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},r=this.config.auth.onRedirectNavigate;return"function"==typeof r?(this.logger.verbose("1nehvl",this.correlationId),!1!==r(e)?(this.logger.verbose("1a0jxh",this.correlationId),void await this.navigationClient.navigateExternal(e,t)):void this.logger.verbose("09k5h5",this.correlationId)):(this.logger.verbose("0klwf7",this.correlationId),void await this.navigationClient.navigateExternal(e,t))}throw this.logger.info("0rlh4e",this.correlationId),Ne(Ke)}async logout(e){this.logger.verbose("1rkurh",this.correlationId);const r=this.initializeLogoutRequest(e),o=zi(961,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger);try{this.eventHandler.emitEvent(tn,St.Redirect,e),await Bi(this.browserStorage,this.browserCrypto,this.logger,this.correlationId,r.account);const t={apiId:961,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},n=await Er(this.createAuthCodeClient.bind(this),Ie,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:o,requestAuthority:e&&e.authority,requestExtraQueryParameters:e?.extraQueryParameters,account:e&&e.account||void 0});if(n.authority.protocolMode===Cr)try{n.authority.endSessionEndpoint}catch{if(r.account?.homeAccountId)return void this.eventHandler.emitEvent(rn,St.Redirect,r)}const i=n.getLogoutUri(r);r.account?.homeAccountId&&this.eventHandler.emitEvent(rn,St.Redirect,r);const s=this.config.auth.onRedirectNavigate;if("function"!=typeof s)return this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0,pt),void await this.navigationClient.navigateExternal(i,t);if(!1!==s(i))return this.logger.verbose("06v57e",this.correlationId),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0,pt),void await this.navigationClient.navigateExternal(i,t);this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("0xqes1",this.correlationId)}catch(e){throw e instanceof t&&(e.setCorrelationId(this.correlationId),o.cacheFailedRequest(e)),this.eventHandler.emitEvent(on,St.Redirect,null,e),this.eventHandler.emitEvent(nn,St.Redirect),e}this.eventHandler.emitEvent(nn,St.Redirect)}getRedirectStartPage(e){const t=e||window.location.href;return gr.getAbsoluteUrl(t,Yn())}}async function Ps(e,t,r,o){if(!e)throw r.info("1l7hyp",o),Ne(Ke);return Rr(Es,"silentHandlerLoadFrameSync",r,t,o)(e)}async function Os(e,t,r,o,n){const i=xs();if(!i.contentDocument)throw"No document associated with iframe!";return(await hs(i.contentDocument,e,t,r,o,n)).submit(),i}async function Rs(e,t,r,o,n){const i=xs();if(!i.contentDocument)throw"No document associated with iframe!";return(await cs(i.contentDocument,e,t,r,o,n)).submit(),i}function Es(e){const t=xs();return t.src=e,t}function xs(){const e=document.createElement("iframe");return e.className="msalSilentIframe",e.style.visibility="hidden",e.style.position="absolute",e.style.width=e.style.height="0",e.style.border="0",e.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),e.setAttribute("allow","local-network-access *"),document.body.appendChild(e),e}class Ms extends Vi{constructor(e,t,r,o,n,i,s,a,c,h,l){super(e,t,r,o,n,i,a,h,l),this.apiId=s,this.nativeStorage=c}async acquireToken(e){e.loginHint||e.sid||e.account&&e.account.username||this.logger.warning("1kl318",this.correlationId);const t={...e};t.prompt?t.prompt!==V&&"no_session"!==t.prompt&&(this.logger.warning("0bmctg",this.correlationId),t.prompt=V):t.prompt=V;const r=await Er(Gi,ve,this.logger,this.performanceClient,this.correlationId)(t,St.Silent,this.config,this.browserCrypto,this.browserStorage,this.logger,this.performanceClient,this.correlationId);return r.platformBroker=As(this.config,this.logger,this.correlationId,this.platformAuthProvider,r.authenticationScheme),oi(r.authority),this.config.system.protocolMode===vr?this.executeEarFlow(r):this.executeCodeFlow(r)}async executeCodeFlow(e){let r;const o=zi(this.apiId,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger);try{return r=await Er(this.createAuthCodeClient.bind(this),Ie,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:o,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),await Er(this.silentTokenHelper.bind(this),fe,this.logger,this.performanceClient,e.correlationId)(r,e)}catch(n){if(n instanceof t&&(n.setCorrelationId(this.correlationId),o.cacheFailedRequest(n)),!(r&&n instanceof t&&n.errorCode===ot))throw n;return this.performanceClient.addFields({retryError:n.errorCode},this.correlationId),await Er(this.silentTokenHelper.bind(this),fe,this.logger,this.performanceClient,this.correlationId)(r,e)}}async executeEarFlow(e){const{correlationId:t,authority:r,azureCloudOptions:o,extraQueryParameters:n,account:i}=e,s=await Er(ji,ue,this.logger,this.performanceClient,t)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,r,o,n,i),a=await Er(Jt,Oe,this.logger,this.performanceClient,t)(),c=await Er(ps,Se,this.logger,this.performanceClient,t)(this.performanceClient,this.logger,t),h={...e,earJwk:a,codeChallenge:c.challenge};await Er(Rs,ye,this.logger,this.performanceClient,t)(this.config,s,h,this.logger,this.performanceClient);const l=this.config.auth.OIDCOptions.responseMode,d=await Er(Xn,we,this.logger,this.performanceClient,t)(this.config.system.iframeBridgeTimeout,this.logger,this.browserCrypto,e),u=Rr(Qi,Ae,this.logger,this.performanceClient,t)(d,l,this.logger,this.correlationId);if(!u.ear_jwe&&u.code){const r=await Er(this.createAuthCodeClient.bind(this),Ie,this.logger,this.performanceClient,t)({serverTelemetryManager:zi(this.apiId,this.config.auth.clientId,t,this.browserStorage,this.logger),requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account,authority:s});return Er(us,Te,this.logger,this.performanceClient,t)(h,u,c.verifier,this.apiId,this.config,r,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}return Er(gs,ke,this.logger,this.performanceClient,t)(h,u,this.apiId,this.config,s,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}logout(){return Promise.reject(Ne(Be))}async silentTokenHelper(e,t){const r=t.correlationId,o=await Er(ps,Se,this.logger,this.performanceClient,r)(this.performanceClient,this.logger,r),n={...t,codeChallenge:o.challenge};if(t.httpMethod===x)await Er(Os,ye,this.logger,this.performanceClient,r)(this.config,e.authority,n,this.logger,this.performanceClient);else{const t=await Er(as,Tr,this.logger,this.performanceClient,r)(this.config,e.authority,n,this.logger,this.performanceClient);await Er(Ps,ye,this.logger,this.performanceClient,r)(t,this.performanceClient,this.logger,r)}const i=this.config.auth.OIDCOptions.responseMode,s=await Er(Xn,we,this.logger,this.performanceClient,r)(this.config.system.iframeBridgeTimeout,this.logger,this.browserCrypto,t),a=Rr(Qi,Ae,this.logger,this.performanceClient,r)(s,i,this.logger,this.correlationId);return Er(us,Te,this.logger,this.performanceClient,r)(t,a,o.verifier,this.apiId,this.config,e,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}}class qs{constructor(e,t){this.config=vi(e),this.logger=new di(this.config.loggerOptions,Io,Co),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}async acquireToken(e,t){const r=Nr(),o=await Er(this.executeTokenRequest.bind(this),"refreshTokenClientExecuteTokenRequest",this.logger,this.performanceClient,e.correlationId)(e,this.authority),n=o.headers?.[L],i=new Si(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.performanceClient,this.config.serializableCache,this.config.persistencePlugin);return i.validateTokenResponse(o.body,e.correlationId),Er(i.handleServerTokenResponse.bind(i),_r,this.logger,this.performanceClient,e.correlationId)(o.body,this.authority,r,e,t,void 0,void 0,!0,e.forceCache,n)}async acquireTokenByRefreshToken(e,t){if(!e)throw sr("token_request_empty");if(!e.account)throw n(u);if(this.cacheManager.isAppMetadataFOCI(e.account.environment,e.correlationId))try{return await Er(this.acquireTokenWithCachedRefreshToken.bind(this),br,this.logger,this.performanceClient,e.correlationId)(e,!0,t)}catch(r){const o=r instanceof no&&r.errorCode===Yr,n=r instanceof bi&&"invalid_grant"===r.errorCode&&"client_mismatch"===r.subError;if(o||n)return Er(this.acquireTokenWithCachedRefreshToken.bind(this),br,this.logger,this.performanceClient,e.correlationId)(e,!1,t);throw r}return Er(this.acquireTokenWithCachedRefreshToken.bind(this),br,this.logger,this.performanceClient,e.correlationId)(e,!1,t)}async acquireTokenWithCachedRefreshToken(e,t,r){const o=Rr(this.cacheManager.getRefreshToken.bind(this.cacheManager),"cacheManagerGetRefreshToken",this.logger,this.performanceClient,e.correlationId)(e.account,t,e.correlationId,void 0);if(!o)throw so(Yr);if(o.expiresOn){const t=e.refreshTokenExpirationOffsetSeconds||300;if(this.performanceClient?.addFields({cacheRtExpiresOnSeconds:Number(o.expiresOn),rtOffsetSeconds:t},e.correlationId),Fr(o.expiresOn,t))throw so(Zr)}const n={...e,refreshToken:o.secret,authenticationScheme:e.authenticationScheme||he.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:Pi}};try{return await Er(this.acquireToken.bind(this),"refreshTokenClientAcquireToken",this.logger,this.performanceClient,e.correlationId)(n,r)}catch(t){if(t instanceof no&&t.subError===to){this.logger.verbose("1pg3ap",e.correlationId);const t=this.cacheManager.generateCredentialKey(o);this.cacheManager.removeRefreshToken(t,e.correlationId)}throw t}}async executeTokenRequest(e,t){const r=Ui(e,this.config.authOptions.clientId,this.config.authOptions.redirectUri,this.performanceClient),o=gr.appendQueryString(t.tokenEndpoint,r),n=await Er(this.createTokenRequestBody.bind(this),"refreshTokenClientCreateTokenRequestBody",this.logger,this.performanceClient,e.correlationId)(e),i=qi(this.logger,this.config.systemOptions.preventCorsPreflight,e.ccsCredential),s=fo(this.config.authOptions.clientId,e);return Er(Ni,"refreshTokenClientExecutePostToTokenEndpoint",this.logger,this.performanceClient,e.correlationId)(o,n,i,s,e.correlationId,this.cacheManager,this.networkClient,this.logger,this.performanceClient,this.serverTelemetryManager)}async createTokenRequestBody(e){const t=new Map;if(Tn(t,e.embeddedClientId||e.extraParameters?.[un]||this.config.authOptions.clientId),e.redirectUri&&An(t,e.redirectUri),bn(t,e.scopes,!0,this.config.authOptions.authority.options.OIDCOptions?.defaultScopes),Fn(t,"refresh_token"),Kn(t),xn(t,this.config.libraryInfo),Mn(t,this.config.telemetry.application),Jn(t),this.serverTelemetryManager&&!ki(this.config)&&$n(t,this.serverTelemetryManager),function(e,t){e.set("refresh_token",t)}(t,e.refreshToken),this.config.clientCredentials.clientSecret&&Nn(t,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const r=this.config.clientCredentials.clientAssertion;Hn(t,await Ri(r.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),Ln(t,r.assertionType)}if(e.authenticationScheme===he.POP){const r=new Ti(this.cryptoUtils,this.performanceClient);let o;o=e.popKid?this.cryptoUtils.encodeKid(e.popKid):(await Er(r.generateCnf.bind(r),Sr,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,jn(t,o)}else if(e.authenticationScheme===he.SSH){if(!e.sshJwk)throw sr(ur);Bn(t,e.sshJwk)}if((!ar.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&Rn(t,e.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case Pi:try{Pn(t,co(e.ccsCredential.credential))}catch(t){this.logger.verbose("1qhtee",e.correlationId)}break;case Oi:_n(t,e.ccsCredential.credential)}return e.embeddedClientId&&Wn(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.extraParameters&&zn(t,{...e.extraParameters}),vn(t,e.correlationId,this.performanceClient),ln(t)}}class Us extends Vi{async acquireToken(e){const t=await Er($i,me,this.logger,this.performanceClient,e.correlationId)(e,this.config,this.performanceClient,this.logger,this.correlationId),r={...e,...t};e.redirectUri&&(r.redirectUri=Di(e.redirectUri,this.config.auth.redirectUri,this.logger,this.correlationId));const o=zi(61,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger),n=await this.createRefreshTokenClient({serverTelemetryManager:o,authorityUrl:r.authority,azureCloudOptions:r.azureCloudOptions,account:r.account});return Er(n.acquireTokenByRefreshToken.bind(n),"refreshTokenClientAcquireTokenByRefreshToken",this.logger,this.performanceClient,e.correlationId)(r,61).catch(e=>{throw e.setCorrelationId(this.correlationId),o.cacheFailedRequest(e),e})}logout(){return Promise.reject(Ne(Be))}async createRefreshTokenClient(e){const t=await Er(this.getClientConfiguration.bind(this),Ce,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:e.serverTelemetryManager,requestAuthority:e.authorityUrl,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return new qs(t,this.performanceClient)}}class Ns extends Li{constructor(e,t){super(e,t),this.includeRedirectUri=!1}}class Hs extends Vi{constructor(e,t,r,o,n,i,s,a,c,h){super(e,t,r,o,n,i,a,c,h),this.apiId=s}async acquireToken(e){if(!e.code)throw Ne("auth_code_required");const r=await Er(Gi,ve,this.logger,this.performanceClient,this.correlationId)(e,St.Silent,this.config,this.browserCrypto,this.browserStorage,this.logger,this.performanceClient,this.correlationId),o=zi(this.apiId,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger);try{const t={...r,code:e.code},n=await Er(this.getClientConfiguration.bind(this),Ce,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:o,requestAuthority:r.authority,requestAzureCloudOptions:r.azureCloudOptions,requestExtraQueryParameters:r.extraQueryParameters,account:r.account}),i=new Ns(n,this.performanceClient);this.logger.verbose("1uic5e",this.correlationId);const s=new Zi(i,this.browserStorage,t,this.logger,this.performanceClient);return await Er(s.handleCodeResponseFromServer.bind(s),Ar,this.logger,this.performanceClient,this.correlationId)({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},r,this.apiId,!1)}catch(e){throw e instanceof t&&(e.setCorrelationId(this.correlationId),o.cacheFailedRequest(e)),e}}logout(){return Promise.reject(Ne(Be))}}function Ls(e,t,r){try{ti(e)}catch(e){throw t.end({success:!1},e,r),e}}class Fs{constructor(e){var t,r,o,n;this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new rr(this.logger,this.performanceClient):nr,this.eventHandler=new ui(this.logger),this.browserStorage=this.isBrowserEnvironment?new ai(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler,function(e){const t=e.cloudDiscoveryMetadata;let r;if(t)try{r=JSON.parse(t)}catch(e){throw sr(dr)}return{canonicalAuthority:e.authority?Xr(e.authority):void 0,knownAuthorities:e.knownAuthorities,cloudDiscoveryMetadata:r}}(this.config.auth)):(t=this.config.auth.clientId,r=this.logger,o=this.performanceClient,n=this.eventHandler,new ai(t,{cacheLocation:ut,cacheRetentionDays:5},nr,r,o,n));const i={cacheLocation:ut,cacheRetentionDays:5};this.nativeInternalStorage=new ai(this.config.auth.clientId,i,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this)}static async createController(e,t){const r=new Fs(e);return await r.initialize(t),r}trackPageVisibility(e){e&&(this.logger.info("16v6hv",e),this.performanceClient.incrementFields({visibilityChangeCount:1},e))}async initialize(e){const t=this.getRequestCorrelationId(e);if(this.logger.trace("1f7joy",t),this.initialized)return void this.logger.info("061m5x",t);if(!this.isBrowserEnvironment)return this.logger.info("19fvpi",t),this.initialized=!0,void this.eventHandler.emitEvent(Wo);const r=e?.correlationId||this.getRequestCorrelationId(),o=this.config.system.allowPlatformBroker,n=this.performanceClient.startMeasurement("initializeClientApplication",r);if(this.eventHandler.emitEvent("msal:initializeStart"),this.logMultipleInstances(n,r),await Er(this.browserStorage.initialize.bind(this.browserStorage),"initializeCache",this.logger,this.performanceClient,r)(r),o)try{this.platformAuthProvider=await async function(e,t,r,o){e.trace("134j0v",r);const n=function(){let e;try{return e=window[dt],"true"===e?.getItem(Ro)}catch(e){return!1}}();let i;e.trace("04c81g",r);try{n&&(i=await Ts.createProvider(e,t,r)),i||(e.trace("0l3na8",r),i=await bs.createProvider(e,o||2e3,t,r))}catch(t){e.trace("0icbd7",t)}return i}(this.logger,this.performanceClient,r,this.config.system.nativeBrokerHandshakeTimeout)}catch(e){this.logger.verbose(e,r)}this.config.cache.cacheLocation===lt&&this.eventHandler.subscribeCrossTab(),!this.config.system.navigatePopups&&await this.preGeneratePkceCodes(r),this.initialized=!0,this.eventHandler.emitEvent(Wo),n.end({allowPlatformBroker:o,success:!0})}async handleRedirectPromise(e){if(this.logger.verbose("02l8bm",""),ei(this.initialized),this.isBrowserEnvironment){const t=e?.hash||"";let r=this.redirectResponse.get(t);return void 0===r?(r=this.handleRedirectPromiseInternal(e),this.redirectResponse.set(t,r),this.logger.verbose("1wn9kp","")):this.logger.verbose("0w0gm3",""),r}return this.logger.verbose("12xi63",""),null}async handleRedirectPromiseInternal(e){if(!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("0le6uv",""),null;const t=this.browserStorage.getInteractionInProgress()?.type;if(t===pt)return this.logger.verbose("1ywcv2",""),this.browserStorage.setInteractionInProgress(!1),Promise.resolve(null);const r=this.getAllAccounts(),o=this.browserStorage.getCachedNativeRequest(),n=o&&this.platformAuthProvider&&!e?.hash;let i,s;this.eventHandler.emitEvent("msal:handleRedirectStart",St.Redirect);try{if(n&&this.platformAuthProvider){const e=o?.correlationId||"";i=this.performanceClient.startMeasurement(yo,e),this.logger.trace("12v7is",e);const t=new is(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,865,this.performanceClient,this.platformAuthProvider,o.accountId,this.nativeInternalStorage,o.correlationId);s=Er(t.handleRedirectPromise.bind(t),"handleNativeRedirectPromise",this.logger,this.performanceClient,i.event.correlationId)(this.performanceClient,i.event.correlationId)}else{const[t,r]=this.browserStorage.getCachedRequest(""),o=t.correlationId;i=this.performanceClient.startMeasurement(yo,o),this.logger.trace("0znzs5",o);const n=this.createRedirectClient(o);s=Er(n.handleRedirectPromise.bind(n),"handleRedirectPromise",this.logger,this.performanceClient,i.event.correlationId)(t,r,i,e)}}catch(e){throw this.browserStorage.resetRequestCache(""),e}return s.then(e=>(e?(this.browserStorage.resetRequestCache(e.correlationId),this.eventHandler.emitEvent(Xo,St.Redirect,e),this.logger.verbose("0ui8f5",e.correlationId),r.length<this.getAllAccounts().length&&(this.eventHandler.emitEvent(Go,St.Redirect,e.account),this.logger.verbose("16im3l",e.correlationId)),i.end({success:!0},void 0,e.account)):i.event.errorCode?i.end({success:!1},void 0):i.discard(),this.eventHandler.emitEvent(Zo,St.Redirect),e)).catch(e=>{this.browserStorage.resetRequestCache(i.event.correlationId);const t=e;throw this.eventHandler.emitEvent(Yo,St.Redirect,null,t),this.eventHandler.emitEvent(Zo,St.Redirect),i.end({success:!1},t),e})}async acquireTokenRedirect(e){const t=this.getRequestCorrelationId(e);this.logger.verbose("0os66p",t);const r=this.performanceClient.startMeasurement("acquireTokenPreRedirect",t);r.add({scenarioId:e.scenarioId});const o=this.config.auth.onRedirectNavigate;this.config.auth.onRedirectNavigate=t=>{const n="function"==typeof o?o(t):void 0;return r.add({navigateCallbackResult:!1!==n}),r.event=r.end({success:!0},void 0,e.account)||r.event,n};try{let o;return ri(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0,gt),this.eventHandler.emitEvent(Qo,St.Redirect,e),o=this.platformAuthProvider&&this.canUsePlatformBroker(e)?new is(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,bt,this.performanceClient,this.platformAuthProvider,this.getNativeAccountId(e),this.nativeInternalStorage,t).acquireTokenRedirect(e,r).catch(r=>{if(r instanceof es&&ts(r))return this.platformAuthProvider=void 0,this.createRedirectClient(t).acquireToken(e);if(r instanceof no)return this.logger.verbose("1ipyz4",t),this.createRedirectClient(t).acquireToken(e);throw r}):this.createRedirectClient(t).acquireToken(e),await o}catch(o){throw this.browserStorage.resetRequestCache(t),2===r.event.status?this.performanceClient.startMeasurement(yo,t).end({success:!1},o,e.account):r.end({success:!1},o,e.account),this.eventHandler.emitEvent(Yo,St.Redirect,null,o),o}}acquireTokenPopup(e){const t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement("acquireTokenPopup",t);r.add({scenarioId:e.scenarioId});try{this.logger.verbose("0ch87b",t),Ls(this.initialized,r,e.account),this.browserStorage.setInteractionInProgress(!0,gt,e.overrideInteractionInProgress,t)}catch(e){return Promise.reject(e)}const o=this.getAllAccounts();let n;this.eventHandler.emitEvent(Qo,St.Popup,e);const i=this.getPreGeneratedPkceCodes(t);return n=this.canUsePlatformBroker(e)?this.acquireTokenNative({...e,correlationId:t},Tt).then(e=>(r.end({success:!0,isNativeBroker:!0},void 0,e.account),e)).catch(r=>{if(r instanceof es&&ts(r))return this.platformAuthProvider=void 0,this.createPopupClient(t).acquireToken(e,i);if(r instanceof no)return this.logger.verbose("0yy5fw",t),this.createPopupClient(t).acquireToken(e,i);throw r}):this.createPopupClient(t).acquireToken(e,i),n.then(e=>{const t=o.length<this.getAllAccounts().length;return this.eventHandler.emitEvent(Xo,St.Popup,e),t&&this.eventHandler.emitEvent(Go,St.Popup,e.account),r.end({success:!0,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length},void 0,e.account),e}).catch(t=>(this.eventHandler.emitEvent(Yo,St.Popup,null,t),r.end({success:!1},t,e.account),Promise.reject(t))).finally(async()=>{this.browserStorage.setInteractionInProgress(!1),this.config.system.navigatePopups||await this.preGeneratePkceCodes(t)})}trackPageVisibilityWithMeasurement(){const e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&e.increment({visibilityChangeCount:1})}async ssoSilent(e){const t=this.getRequestCorrelationId(e),r={...e,prompt:e.prompt,correlationId:t};this.ssoSilentMeasurement=this.performanceClient.startMeasurement("ssoSilent",t),this.ssoSilentMeasurement?.add({scenarioId:e.scenarioId}),Ls(this.initialized,this.ssoSilentMeasurement,e.account),this.ssoSilentMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement);const o=this.getAllAccounts();let n;return this.logger.verbose("0w1b45",t),this.eventHandler.emitEvent(Qo,St.Silent,r),n=this.canUsePlatformBroker(r)?this.acquireTokenNative(r,863).catch(e=>{if(e instanceof es&&ts(e))return this.platformAuthProvider=void 0,this.createSilentIframeClient(r.correlationId).acquireToken(r);throw e}):this.createSilentIframeClient(r.correlationId).acquireToken(r),n.then(e=>{const t=o.length<this.getAllAccounts().length;return this.eventHandler.emitEvent(Xo,St.Silent,e),t&&this.eventHandler.emitEvent(Go,St.Silent,e.account),this.ssoSilentMeasurement?.end({success:!0,isNativeBroker:e.fromPlatformBroker,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length},void 0,e.account),e}).catch(t=>{throw this.eventHandler.emitEvent(Yo,St.Silent,null,t),this.ssoSilentMeasurement?.end({success:!1},t,e.account),t}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenByCode(e){const t=this.getRequestCorrelationId(e);this.logger.trace("0ch6ga",t);const r=this.performanceClient.startMeasurement("acquireTokenByCode",t);Ls(this.initialized,r),this.eventHandler.emitEvent(Qo,St.Silent,e),r.add({scenarioId:e.scenarioId});try{if(e.code&&e.nativeAccountId)throw Ne("spa_code_and_nativeAccountId_present");if(e.code){const o=e.code;let n=this.hybridAuthCodeResponses.get(o);return n?(this.logger.verbose("0qgp28",t),r.discard()):(this.logger.verbose("06eh73",t),n=this.acquireTokenByCodeAsync({...e,correlationId:t}).then(e=>(this.eventHandler.emitEvent(Xo,St.Silent,e),this.hybridAuthCodeResponses.delete(o),r.end({success:!0,isNativeBroker:e.fromPlatformBroker,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length},void 0,e.account),e)).catch(e=>{throw this.hybridAuthCodeResponses.delete(o),this.eventHandler.emitEvent(Yo,St.Silent,null,e),r.end({success:!1},e),e}),this.hybridAuthCodeResponses.set(o,n)),await n}if(e.nativeAccountId){if(this.canUsePlatformBroker(e,e.nativeAccountId)){const o=await this.acquireTokenNative({...e,correlationId:t},866,e.nativeAccountId).catch(e=>{throw e instanceof es&&ts(e)&&(this.platformAuthProvider=void 0),e});return r.end({success:!0},void 0,o.account),o}throw Ne("unable_to_acquire_token_from_native_platform")}throw Ne("auth_code_or_nativeAccountId_required")}catch(e){throw this.eventHandler.emitEvent(Yo,St.Silent,null,e),r.end({success:!1},e),e}}async acquireTokenByCodeAsync(e){const t=this.getRequestCorrelationId(e);this.logger.trace("10d9hy",t),this.acquireTokenByCodeAsyncMeasurement=this.performanceClient.startMeasurement("acquireTokenByCodeAsync",t),this.acquireTokenByCodeAsyncMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement);const r=this.createSilentAuthCodeClient(t);return await r.acquireToken(e).then(e=>(this.acquireTokenByCodeAsyncMeasurement?.end({success:!0,fromCache:e.fromCache,isNativeBroker:e.fromPlatformBroker}),e)).catch(e=>{throw this.acquireTokenByCodeAsyncMeasurement?.end({success:!1},e),e}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenFromCache(e,t){switch(t){case 0:case 1:case 2:const t=this.createSilentCacheClient(e.correlationId);return Er(t.acquireToken.bind(t),"silentCacheClientAcquireToken",this.logger,this.performanceClient,e.correlationId)(e);default:throw n(f)}}async acquireTokenByRefreshToken(e,t){switch(t){case 0:case 2:case 3:case 4:const t=this.createSilentRefreshClient(e.correlationId);return Er(t.acquireToken.bind(t),"silentRefreshClientAcquireToken",this.logger,this.performanceClient,e.correlationId)(e);default:throw n(f)}}async acquireTokenBySilentIframe(e){const t=this.createSilentIframeClient(e.correlationId);return Er(t.acquireToken.bind(t),"silentIframeClientAcquireToken",this.logger,this.performanceClient,e.correlationId)(e)}async logoutRedirect(e){const t=this.getRequestCorrelationId(e);return ri(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0,pt),this.createRedirectClient(t).logout(e)}logoutPopup(e){try{const t=this.getRequestCorrelationId(e);return ti(this.initialized),this.browserStorage.setInteractionInProgress(!0,pt),this.createPopupClient(t).logout(e).finally(()=>{this.browserStorage.setInteractionInProgress(!1)})}catch(e){return Promise.reject(e)}}async clearCache(e){if(!this.isBrowserEnvironment)return;const t=this.getRequestCorrelationId(e);return this.createSilentCacheClient(t).logout(e)}getAllAccounts(e){return function(e,t,r,o,n){return e.verbose("1yd030",o),r?t.getAllAccounts(n,o):[]}(this.logger,this.browserStorage,this.isBrowserEnvironment,this.getRequestCorrelationId(),e)}getAccount(e){return function(e,t,r,o){if(t.trace("0u7b90",o),0===Object.keys(e).length)return t.warning("1kz0cu",o),null;const n=r.getAccountInfoFilteredBy(e,o);return n?(t.verbose("0btgll",o),n):(t.verbose("0ltaj5",o),null)}(e,this.logger,this.browserStorage,this.getRequestCorrelationId())}setActiveAccount(e){!function(e,t,r){t.setActiveAccount(e,r)}(e,this.browserStorage,this.getRequestCorrelationId())}getActiveAccount(){return e=this.browserStorage,t=this.getRequestCorrelationId(),e.getActiveAccount(t);var e,t}async hydrateCache(e,t){this.logger.verbose("16jycr",e.correlationId);const r=function(e,t,r){const o=Array.from(e.tenantProfiles?.values()||[]);return 0===o.length&&e.tenantId&&e.localAccountId&&o.push(lo(e.homeAccountId,e.localAccountId,e.tenantId,e.idTokenClaims)),{authorityType:e.authorityType||X,homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,nativeAccountId:e.nativeAccountId,realm:e.tenantId,environment:e.environment,username:e.username,loginHint:e.loginHint,name:e.name,cloudGraphHostName:t,msGraphHost:r,tenantProfiles:o,dataBoundary:e.dataBoundary}}(e.account,e.cloudGraphHostName,e.msGraphHost);return await this.browserStorage.setAccount(r,e.correlationId,qr(e.idTokenClaims),963),e.fromPlatformBroker?(this.logger.verbose("1fxyu8",e.correlationId),this.nativeInternalStorage.hydrateCache(e,t)):this.browserStorage.hydrateCache(e,t)}async acquireTokenNative(e,t,r,o){const n=this.getRequestCorrelationId(e);if(this.logger.trace("0b9y3p",n),!this.platformAuthProvider)throw Ne(Xe);return new is(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,t,this.performanceClient,this.platformAuthProvider,r||this.getNativeAccountId(e),this.nativeInternalStorage,n).acquireToken(e,o)}canUsePlatformBroker(e,t){const r=this.getRequestCorrelationId(e);if(this.logger.trace("1n9lbl",r),!this.platformAuthProvider)return this.logger.trace("0vnu11",r),!1;if(!As(this.config,this.logger,r,this.platformAuthProvider,e.authenticationScheme))return this.logger.trace("1m4bzf",r),!1;if(e.prompt)switch(e.prompt){case V:case W:case J:this.logger.trace("0vdv8e",r);break;default:return this.logger.trace("0pdzw6",r),!1}return!(!t&&!this.getNativeAccountId(e)&&(this.logger.trace("16lbtk",r),1))}getNativeAccountId(e){const t=e.account||this.getAccount({loginHint:e.loginHint,sid:e.sid})||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new Ss(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,e,this.platformAuthProvider)}createRedirectClient(e){return new _s(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,e,this.platformAuthProvider)}createSilentIframeClient(e){return new Ms(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,863,this.performanceClient,this.nativeInternalStorage,e,this.platformAuthProvider)}createSilentCacheClient(e){return new ns(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,e,this.platformAuthProvider)}createSilentRefreshClient(e){return new Us(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,e,this.platformAuthProvider)}createSilentAuthCodeClient(e){return new Hs(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,866,this.performanceClient,e,this.platformAuthProvider)}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return Zn(),this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}isBrowserEnv(){return this.isBrowserEnvironment}getRequestCorrelationId(e){return e?.correlationId?e.correlationId:this.isBrowserEnvironment?Bt():""}async loginRedirect(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("0lz9hf",t),this.acquireTokenRedirect({correlationId:t,...e||_t})}loginPopup(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("0qw7v5",t),this.acquireTokenPopup({correlationId:t,...e||_t})}async acquireTokenSilent(e){const r=this.getRequestCorrelationId(e),o=this.performanceClient.startMeasurement("acquireTokenSilent",r);o.add({cacheLookupPolicy:e.cacheLookupPolicy,scenarioId:e.scenarioId}),Ls(this.initialized,o,e.account),this.logger.verbose("0x1c4s",r);const n=e.account||this.getActiveAccount();if(!n)throw Ne("no_account_error");return this.acquireTokenSilentDeduped(e,n,r).then(t=>(o.end({success:!0,fromCache:t.fromCache,isNativeBroker:t.fromPlatformBroker,accessTokenSize:t.accessToken.length,idTokenSize:t.idToken.length},void 0,t.account),{...t,state:e.state,correlationId:r})).catch(e=>{throw e instanceof t&&e.setCorrelationId(r),o.end({success:!1},e,n),e})}async acquireTokenSilentDeduped(e,t,r){const o=fo(this.config.auth.clientId,{...e,authority:e.authority||this.config.auth.authority,correlationId:r},t.homeAccountId),n=JSON.stringify(o),i=this.activeSilentTokenRequests.get(n);if(void 0===i){this.logger.verbose("0fcjbk",r),this.performanceClient.addFields({deduped:!1},r);const o=Er(this.acquireTokenSilentAsync.bind(this),"acquireTokenSilentAsync",this.logger,this.performanceClient,r)({...e,correlationId:r},t);return this.activeSilentTokenRequests.set(n,o),o.finally(()=>{this.activeSilentTokenRequests.delete(n)})}return this.logger.verbose("1yq7nb",r),this.performanceClient.addFields({deduped:!0},r),i}async acquireTokenSilentAsync(e,t){const r=()=>this.trackPageVisibility(e.correlationId);this.eventHandler.emitEvent(Qo,St.Silent,e),e.correlationId&&this.performanceClient.incrementFields({visibilityChangeCount:0},e.correlationId),document.addEventListener("visibilitychange",r);const o=await Er(Ji,"initializeSilentRequest",this.logger,this.performanceClient,e.correlationId)(e,t,this.config,this.performanceClient,this.logger),n=e.cacheLookupPolicy||0;return this.acquireTokenSilentNoIframe(o,n).catch(async e=>{const t=function(e,t){const r=!(e instanceof no&&e.subError!==to),o=e.errorCode===ot||e.errorCode===f,n=r&&o||e.errorCode===Yr||e.errorCode===Zr,i=Rt.includes(t);return n&&i}(e,n);if(t){if(this.activeIframeRequest){if(5!==n){const[t,r]=this.activeIframeRequest;this.logger.verbose("1w8fso",o.correlationId);const i=this.performanceClient.startMeasurement("awaitConcurrentIframe",o.correlationId);i.add({awaitIframeCorrelationId:r});const s=await t;if(i.end({success:s}),s)return this.logger.verbose("0ywzzi",o.correlationId),this.acquireTokenSilentNoIframe(o,n);throw this.logger.info("17y14q",o.correlationId),e}return this.logger.warning("1bd4p8",o.correlationId),Er(this.acquireTokenBySilentIframe.bind(this),pe,this.logger,this.performanceClient,o.correlationId)(o)}{let e;return this.activeIframeRequest=[new Promise(t=>{e=t}),o.correlationId],this.logger.verbose("0rh08z",o.correlationId),Er(this.acquireTokenBySilentIframe.bind(this),pe,this.logger,this.performanceClient,o.correlationId)(o).then(t=>(e(!0),t)).catch(t=>{throw e(!1),t}).finally(()=>{this.activeIframeRequest=void 0})}}throw e}).then(t=>(this.eventHandler.emitEvent(Xo,St.Silent,t),e.correlationId&&this.performanceClient.addFields({fromCache:t.fromCache,isNativeBroker:t.fromPlatformBroker},e.correlationId),t)).catch(e=>{throw this.eventHandler.emitEvent(Yo,St.Silent,null,e),e}).finally(()=>{document.removeEventListener("visibilitychange",r)})}async acquireTokenSilentNoIframe(e,t){return As(this.config,this.logger,e.correlationId,this.platformAuthProvider,e.authenticationScheme)&&e.account.nativeAccountId?(this.logger.verbose("0sczo4",e.correlationId),this.acquireTokenNative(e,61,e.account.nativeAccountId,t).catch(async t=>{if(t instanceof es&&ts(t))throw this.logger.verbose("07rkmb",e.correlationId),this.platformAuthProvider=void 0,n(f);throw t})):(this.logger.verbose("0ox81t",e.correlationId),1===t&&this.logger.verbose("0fvwxe",e.correlationId),Er(this.acquireTokenFromCache.bind(this),"acquireTokenFromCache",this.logger,this.performanceClient,e.correlationId)(e,t).catch(r=>{if(1===t)throw r;return this.eventHandler.emitEvent("msal:acquireTokenFromNetworkStart",St.Silent,e),Er(this.acquireTokenByRefreshToken.bind(this),"acquireTokenByRefreshToken",this.logger,this.performanceClient,e.correlationId)(e,t)}))}async preGeneratePkceCodes(e){return this.logger.verbose("1x6uj6",e),this.pkceCode=await Er(ps,Se,this.logger,this.performanceClient,e)(this.performanceClient,this.logger,e),Promise.resolve()}getPreGeneratedPkceCodes(e){const t=this.pkceCode?{...this.pkceCode}:void 0;return this.pkceCode=void 0,t?this.logger.verbose("12js1o",e):this.logger.verbose("1oe9ci",e),this.performanceClient.addFields({usePreGeneratedPkce:!!t},e),t}logMultipleInstances(e,t){const r=this.config.auth.clientId;window&&(window.msal=window.msal||{},window.msal.clientIds=window.msal.clientIds||[],window.msal.clientIds.length>0&&this.logger.verbose("1qtz3l",t),window.msal.clientIds.push(r),function(e,t,r,o){const n=window.msal?.clientIds||[],i=n.length,s=n.filter(t=>t===e).length;s>1&&r.warning("1e88vg",o),t.add({msalInstanceCount:i,sameClientIdInstanceCount:s})}(r,e,this.logger,t))}}class Ks{static loggerCallback(e,t){switch(e){case hi.Error:return void console.error(t);case hi.Info:return void console.info(t);case hi.Verbose:return void console.debug(t);case hi.Warning:return void console.warn(t);default:return void console.log(t)}}constructor(e){let t;this.browserEnvironment="undefined"!=typeof window,this.config=function({auth:e,cache:t,system:r,telemetry:o},n){const i={clientId:"",authority:`${v}`,knownAuthorities:[],cloudDiscoveryMetadata:"",authorityMetadata:"",redirectUri:"undefined"!=typeof window&&window.location?window.location.href.split("?")[0].split("#")[0]:"",postLogoutRedirectUri:"",clientCapabilities:[],OIDCOptions:{responseMode:"fragment",defaultScopes:[A,S,_]},azureCloudOptions:{azureCloudInstance:kr,tenant:""},instanceAware:!1},s={cacheLocation:dt,cacheRetentionDays:5},a={loggerCallback:()=>{},logLevel:hi.Info,piiLoggingEnabled:!1},c={...{...pi,loggerOptions:a,networkClient:n?new Is:ys,navigationClient:new ws,popupBridgeTimeout:r?.popupBridgeTimeout||6e4,iframeBridgeTimeout:r?.iframeBridgeTimeout||1e4,redirectNavigationTimeout:3e4,allowRedirectInIframe:!1,navigatePopups:!0,allowPlatformBroker:!1,nativeBrokerHandshakeTimeout:r?.nativeBrokerHandshakeTimeout||2e3,protocolMode:"AAD"},...r,loggerOptions:r?.loggerOptions||a},h={application:{appName:"",appVersion:""},client:new gi};if(r?.protocolMode!==Cr&&e?.OIDCOptions&&new di(c.loggerOptions).warning(JSON.stringify(sr("cannot_set_OIDCOptions")),""),r?.protocolMode&&r.protocolMode===Cr&&c?.allowPlatformBroker)throw sr("cannot_allow_platform_broker");return{auth:{...i,...e,OIDCOptions:{...i.OIDCOptions,...e?.OIDCOptions}},cache:{...s,...t},system:c,telemetry:{...h,...o}}}(e,this.browserEnvironment);try{t=window[dt]}catch(e){}const r=t?.getItem(Po),o=t?.getItem(Oo)?.toLowerCase(),n="true"===o||"false"!==o&&void 0,i={...this.config.system.loggerOptions},s=r&&Object.keys(hi).includes(r)?hi[r]:void 0;s&&(i.loggerCallback=Ks.loggerCallback,i.logLevel=s),void 0!==n&&(i.piiLoggingEnabled=n),this.logger=new di(i,"@azure/msal-browser",ii),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}}class Ds extends Ks{getModuleName(){return Ds.MODULE_NAME}getId(){return Ds.ID}async initialize(e){return this.available="undefined"!=typeof window,this.available}}Ds.MODULE_NAME="",Ds.ID="StandardOperatingContext";class zs{constructor(e,t){this.controller=t||new Fs(new Ds(e))}async initialize(e){return this.controller.initialize(e)}async acquireTokenPopup(e){return this.controller.acquireTokenPopup(e)}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e,t){return this.controller.addEventCallback(e,t)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}getAccount(e){return this.controller.getAccount(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}async hydrateCache(e,t){return this.controller.hydrateCache(e,t)}clearCache(e){return this.controller.clearCache(e)}}const js={auth:{clientId:"aa584c91-54b8-4109-a3ad-635b43cf5478",authority:"https://login.microsoftonline.com/2cd5468c-1faa-4ddc-96ee-1f4a51a21c86",redirectUri:"https://shiori-pope.github.io/word-addin-host/redirect.html",navigateToLoginRequestUrl:!1},cache:{cacheLocation:"sessionStorage",storeAuthStateInCookie:!0}};!async function(){try{console.log(" RedirectMSAL...");const e=new zs(js);await e.initialize(),console.log("  handleRedirectPromise..."),await e.handleRedirectPromise()?(console.log(" popup"),window.opener&&window.close()):(console.log(" popup"),setTimeout(()=>{window.closed||(document.body.innerHTML='\n            <div style="padding: 40px; text-align: center; font-family: \'Segoe UI\', sans-serif;">\n              <h2 style="color: #333;">...</h2>\n              <p style="color: #666;"></p>\n              <button onclick="window.close()" style="\n                margin-top: 20px;\n                padding: 12px 24px;\n                background: #0078d4;\n                color: white;\n                border: none;\n                border-radius: 4px;\n                cursor: pointer;\n                font-size: 14px;\n              "></button>\n            </div>\n          ')},3e3))}catch(e){console.error(" Redirect:",e),document.body.innerHTML=`\n      <div style="padding: 20px; text-align: center; color: #d32f2f; font-family: 'Segoe UI', sans-serif;">\n        <h2></h2>\n        <p>${e.message||e.errorCode||""}</p>\n        <button onclick="window.close()" style="\n          margin-top: 20px;\n          padding: 10px 20px;\n          background: #1976d2;\n          color: white;\n          border: none;\n          border-radius: 4px;\n          cursor: pointer;\n        "></button>\n      </div>\n    `}}()})();